(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2257c3db"],{"1a43":function(e,t,a){},2347:function(e,t,a){"use strict";a("d029")},"3f4e":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("base-dialog",{attrs:{show:e.show,title:"播放样本",width:"600px","close-on-click-modal":!1},on:{close:e.close}},[a("video-player",{ref:"videoPlayer",attrs:{options:e.playerOptions,playsinline:!0}}),e._t("default")],2)},r=[],s={components:{},props:{show:{type:Boolean,default:function(){return!1}},videoUrl:{type:String,default:function(){return""}}},data:function(){return{playerOptions:{height:"360",autoplay:!0,muted:!1,language:"en",fluid:!0,playbackRates:[.7,1,1.5,2],sources:[{type:"video/mp4",src:""}],poster:"https://surmon-china.github.io/vue-quill-editor/static/images/surmon-1.jpg"}}},computed:{},watch:{},created:function(){this.playerOptions.sources[0].src=this.videoUrl},mounted:function(){},methods:{close:function(){this.$emit("close")}}},i=s,o=a("4ac2"),l=Object(o["a"])(i,n,r,!1,null,"43fb27de",null);t["a"]=l.exports},"59d3":function(e,t,a){"use strict";a("f668")},"97e7":function(e,t,a){"use strict";a("1a43")},b794:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"a",(function(){return s}));a("e35a"),a("0d7a"),a("3e54"),a("e18c"),a("8256"),a("ab6e"),a("927c"),a("3c51"),a("db0a"),a("1cc1"),a("ab0f"),a("fc6e"),a("f30b"),a("cfd1"),a("d104"),a("f74a"),a("3598"),a("b497"),a("2909"),a("a7ef"),a("b523"),a("e671"),a("4140"),a("83db"),a("829d"),a("939f"),a("1bb1"),a("c3ba"),a("f4e3"),a("b4fb");var n=a("79dd");function r(e,t){return new n["Promise"]((function(a,n){var r=document.createElement("canvas"),s=document.createElement("video");s.src=e,s.currentTime=t/1e3,s.crossOrigin="Anonymous",s.addEventListener("loadeddata",(function(){r.width=1*s.videoWidth,r.height=1*s.videoHeight,r.getContext("2d").drawImage(s,0,0,r.width,r.height);var e="";try{e=r.toDataURL("image/png"),a(e)}catch(t){n(t)}}))}))}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"file",a=e.split(","),n=a[0].match(/:(.*?);/)[1],r=n.split("/")[1],s=atob(a[1]),i=s.length,o=new Uint8Array(i);while(i--)o[i]=s.charCodeAt(i);return new File([o],"".concat(t,".").concat(r),{type:n})}},b83e:function(e,t,a){"use strict";a("e11d")},d029:function(e,t,a){},e11d:function(e,t,a){},ed08:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return s})),a.d(t,"a",(function(){return i}));var n=a("01d6");a("e35a"),a("5e9f"),a("84c2"),a("1c2e"),a("e18c"),a("898e"),a("0d7a"),a("08ba");function r(e,t){if(0===arguments.length||!e)return null;var a,r=t||"{y}-{m}-{d} {h}:{i}:{s}";"object"===Object(n["a"])(e)?a=e:("string"===typeof e&&(e=/^[0-9]+$/.test(e)?parseInt(e):e.replace(new RegExp(/-/gm),"/")),"number"===typeof e&&10===e.toString().length&&(e*=1e3),a=new Date(e));var s={y:a.getFullYear(),m:a.getMonth()+1,d:a.getDate(),h:a.getHours(),i:a.getMinutes(),s:a.getSeconds(),a:a.getDay()},i=r.replace(/{([ymdhisa])+}/g,(function(e,t){var a=s[t];return"a"===t?["日","一","二","三","四","五","六"][a]:a.toString().padStart(2,"0")}));return i}function s(e,t){if(0===arguments.length||!e)return null;var a,r=t||"{h}:{i}:{s}";"object"===Object(n["a"])(e)?a=e:("string"===typeof e&&(e=/^[0-9]+$/.test(e)?parseInt(e):e.replace(new RegExp(/-/gm),"/")),"number"===typeof e&&10===e.toString().length&&(e*=1e3),a=new Date(e));var s={h:a.getHours(),i:a.getMinutes(),s:a.getSeconds(),a:a.getDay()},i=r.replace(/{([hisa])+}/g,(function(e,t){var a=s[t];return"a"===t?["日","一","二","三","四","五","六"][a]:a.toString().padStart(2,"0")}));return i}function i(e){parseInt(e/864e5);var t=parseInt(e%864e5/36e5),a=parseInt(e%36e5/6e4),n=parseInt(e%6e4/1e3),r=parseInt(e-36e5*t-6e4*a-1e3*n);return{hours:t,minutes:a,seconds:n,ms:r}}},efc5:function(e,t,a){},f668:function(e,t,a){},f701:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"sample-queue"},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"状态"}},[a("el-select",{attrs:{placeholder:"请选择状态",clearable:""},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},e._l(e.sample_status,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("el-form-item",{attrs:{label:"频道名称"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",clearable:"",placeholder:"请选择频道"},model:{value:e.form.channel_id,callback:function(t){e.$set(e.form,"channel_id",t)},expression:"form.channel_id"}},e._l(e.channelData,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"广告名称"}},[a("el-input",{attrs:{placeholder:"请输入广告名称",clearable:""},model:{value:e.form.ad_title,callback:function(t){e.$set(e.form,"ad_title",t)},expression:"form.ad_title"}})],1),a("el-form-item",{attrs:{label:"广告ID"}},[a("el-input",{attrs:{placeholder:"请输入广告名称",clearable:""},model:{value:e.form.ad_id,callback:function(t){e.$set(e.form,"ad_id",t)},expression:"form.ad_id"}})],1),a("el-form-item",{attrs:{label:"更新时间"}},[a("el-date-picker",{attrs:{type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.form.update_time,callback:function(t){e.$set(e.form,"update_time",t)},expression:"form.update_time"}})],1),a("div",{staticClass:"btn-wrap"},[a("base-btn",{on:{click:e.search}},[e._v("查询")]),a("base-btn",{on:{click:e.clear}},[e._v("清除")])],1)],1),a("QueueTable",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"table-data":e.tableData,pag:e.pag},on:{currentChange:e.handleCurrentChange,sizeChange:e.handleSizeChange,update:function(t){return e.getData()}}})],1)},r=[],s=a("1c03"),i=(a("08ba"),a("fe8a"),a("e18c"),a("52c1")),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"queue-table"},[a("p",{staticClass:"table-total"},[e._v("当前条件下共"+e._s(e.pag.total)+"条数据")]),a("el-table",{attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{prop:"status",label:"状态",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.status)+" "),"失败"==t.row.status?a("span",[e._v(":"+e._s(t.row.reason))]):e._e()]}}])}),a("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),a("el-table-column",{attrs:{prop:"channel_name",label:"频道",width:"200"}}),a("el-table-column",{attrs:{prop:"ad_id",label:"广告 ID"}}),a("el-table-column",{attrs:{prop:"title",label:"标题",width:"300"}}),a("el-table-column",{attrs:{prop:"tag",label:"分类",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.tags)+" ")]}}])}),a("el-table-column",{attrs:{prop:"brand",label:"品牌"}}),a("el-table-column",{attrs:{prop:"updated_at",label:"更新时间",width:"180"}}),a("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return["视频转码中"!==t.row.status&&"视频问题"!==t.row.reason||"入库中"==t.row.status?a("base-btn",{attrs:{type:"text"},on:{click:function(a){return e.playSample(t.row)}}},[e._v("播放")]):e._e(),"视频问题"===t.row.reason&&"入库中"!==t.row.status?a("base-btn",{attrs:{type:"text"},on:{click:function(a){return e.reSubmit(t.row)}}},[e._v("重新提交")]):e._e(),"已存在"===t.row.reason&&"待编辑"!==t.row.status?a("base-btn",{attrs:{type:"text"},on:{click:function(a){return e.toAdd(t.row)}}},[e._v("继续添加")]):e._e(),"待编辑"===t.row.status?a("base-btn",{attrs:{type:"text"},on:{click:function(a){return e.updateSample(t.row)}}},[e._v("编辑")]):e._e(),e.showDelBtn(t.row.status)?a("base-btn",{staticClass:"del-btn",attrs:{type:"text"},on:{click:function(a){return e.deleteData(t.row)}}},[e._v("删除")]):e._e()]}}])})],1),a("base-pag",{attrs:{total:e.pag.total,limit:e.pag.limit,page:e.pag.page},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}}),e.showPlayModel?a("PlaySample",{attrs:{show:e.showPlayModel,"video-url":e.modelData.mp4_url},on:{close:e.closePlayModel}},[a("div",{staticClass:"model-text"},[a("p",[e._v("样本 ID ："+e._s(e.modelData.sample_ids))]),a("p",[e._v("标题 ："+e._s(e.modelData.title))]),a("p",[e._v("分类 ："+e._s(e.modelData.tags))]),a("p",[e._v("品牌 ："+e._s(e.modelData.brand))]),a("p",[e._v("样本来源 ："+e._s(e.modelData.channel_name)+" "+e._s(e._f("unixToHms")(e.modelData.start_time))+" - "+e._s(e._f("unixToHms")(e.modelData.end_time)))])])]):e._e(),e.showUpdateModel?a("UpdateSample",{attrs:{show:e.showUpdateModel,"video-url":e.modelData.mp4_url},on:{close:e.closeUpdateModel}},[a("UpdateForm",{attrs:{"model-data":e.modelData,"video-url":e.modelData.mp4_url},on:{close:e.closeUpdateModel,update:e.updateTable}})],1):e._e(),e.showAddModel?a("ContinueAdd",{attrs:{show:e.showAddModel,"model-data":e.modelData},on:{close:e.closeAddModel,update:e.updateTable}}):e._e()],1)},l=[],c=a("3f4e"),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("base-dialog",{attrs:{show:e.show,title:"编辑样本",width:"1100px",height:"200px","close-on-click-modal":!1},on:{close:e.close}},[a("div",{staticClass:"updateSampleModel"},[a("div",{staticClass:"sample-video"},[a("iframe",{ref:"iframe",staticClass:"iframe",attrs:{id:"videoEditiframe",src:"/video-edit/index.html",frameborder:"0"},on:{load:e.inIframe}})]),a("div",{staticClass:"sample-form"},[e._t("default")],2)])])},d=[],m=a("99a5"),p=(a("6a61"),a("b794")),f={components:{},props:{show:{type:Boolean,default:function(){return!1}},videoUrl:{type:String,default:function(){return""}}},data:function(){return{iframe:null,start_ms:"",end_ms:"",playerOptions:{height:"360",autoplay:!0,muted:!1,language:"en",fluid:!0,playbackRates:[.7,1,1.5,2],sources:[{type:"video/mp4",src:""}],src:"",poster:""}}},computed:{},watch:{},beforeDestroy:function(){this.$bus.$off("setCut"),this.$bus.$off("cutVideoImage"),this.$bus.$off("setImageData"),window.removeEventListener("message",this.iframeMsg,!1)},created:function(){this.playerOptions.sources[0].src=this.videoUrl,this.playerOptions.src=this.videoUrl},mounted:function(){var e=this;this.$bus.$on("setCut",(function(t){e.iframe.postMessage({cmd:"setCutTrackDetails",data:t},"*")})),this.$bus.$on("cutVideoImage",(function(){e.iframe.postMessage({cmd:"getVideoEditAllData"},"*")}))},methods:{inIframe:function(){var e=this.$refs.iframe.contentWindow;e.focus(),this.iframe=this.$refs.iframe.contentWindow,e.postMessage({cmd:"setVideoOptions",data:this.playerOptions},"*"),e.postMessage({cmd:"setVideoDurantion",data:6e3},"*"),window.addEventListener("message",this.iframeMsg,!1)},iframeMsg:function(e){e.data.cmd,e.data.data;if("playerLoadeddata"===e.data.cmd);if("exportcutDetails"===e.data.cmd){console.log(e.data.data);var t=e.data.data,a=t.start_ms,n=t.end_ms;this.start_ms=a,this.end_ms=n;var r={start_ms:a,end_ms:n};this.$bus.$emit("setTime",r)}e.data.cmd,e.data.cmd,e.data.cmd,e.data.cmd,e.data.cmd,"exportVideoEditAllData"===e.data.cmd&&this.getImageSrc(e.data.data.videoPlay.current_time_ms)},close:function(){this.$emit("close")},getImageSrc:function(e){var t=this;return Object(m["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(p["b"])(t.videoUrl,e);case 2:n=a.sent,t.$bus.$emit("setImageData",n);case 4:case"end":return a.stop()}}),a)})))()}}},h=f,g=(a("b83e"),a("4ac2")),b=Object(g["a"])(h,u,d,!1,null,null,null),_=b.exports,v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"ruleForm",attrs:{inline:!0,rules:e.rules,model:e.paramsForm,"label-position":"left","label-width":"90px"}},[a("el-form-item",{attrs:{label:"标题",prop:"title"}},[a("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchAsync,placeholder:"请输入标题名称",type:"textarea"},model:{value:e.paramsForm.title,callback:function(t){e.$set(e.paramsForm,"title",t)},expression:"paramsForm.title"}})],1),a("p",{staticClass:"subtitle"},[e._v("基础信息")]),a("el-form-item",{attrs:{label:"商品名称"}},[a("el-select",{attrs:{filterable:"",clearable:"",remote:"","remote-method":function(t){return e.filterData(t,0)}},on:{clear:function(t){return e.filterData("",0)}},model:{value:e.paramsForm.product_id,callback:function(t){e.$set(e.paramsForm,"product_id",t)},expression:"paramsForm.product_id"}},e._l(e.productData,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"品牌名称"}},[a("el-select",{attrs:{filterable:"",clearable:"",remote:"","remote-method":function(t){return e.filterData(t,1)}},on:{clear:function(t){return e.filterData("",1)}},model:{value:e.paramsForm.brand_id,callback:function(t){e.$set(e.paramsForm,"brand_id",t)},expression:"paramsForm.brand_id"}},e._l(e.brandData,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"广告主"}},[a("el-select",{attrs:{filterable:"",clearable:"",remote:"","remote-method":function(t){return e.filterData(t,2)}},on:{clear:function(t){return e.filterData("",2)}},model:{value:e.paramsForm.ader_id,callback:function(t){e.$set(e.paramsForm,"ader_id",t)},expression:"paramsForm.ader_id"}},e._l(e.aderData,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("p",{staticClass:"subtitle"},[e._v("行业分类")]),a("el-form-item",{attrs:{label:"行业大类"}},[a("el-select",{attrs:{filterable:"",clearable:""},on:{change:e.changeIndustryId},model:{value:e.paramsForm.industry_id,callback:function(t){e.$set(e.paramsForm,"industry_id",t)},expression:"paramsForm.industry_id"}},e._l(e.firstIndustry,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"行业中类"}},[a("el-select",{attrs:{filterable:"",clearable:""},on:{change:e.changeSecIndustryId},model:{value:e.paramsForm.sec_industry_id,callback:function(t){e.$set(e.paramsForm,"sec_industry_id",t)},expression:"paramsForm.sec_industry_id"}},e._l(e.secondIndustry,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"行业小类"}},[a("el-select",{attrs:{filterable:"",clearable:""},model:{value:e.paramsForm.thr_industry_id,callback:function(t){e.$set(e.paramsForm,"thr_industry_id",t)},expression:"paramsForm.thr_industry_id"}},e._l(e.thirdIndustry,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("p",{staticClass:"subtitle"},[e._v("广告分类")]),a("el-form-item",{attrs:{label:"一级分类",prop:"tags_id"}},[a("el-select",{attrs:{filterable:"",clearable:""},on:{change:e.changeTagsId},model:{value:e.paramsForm.tags_id,callback:function(t){e.$set(e.paramsForm,"tags_id",t)},expression:"paramsForm.tags_id"}},e._l(e.firstAd,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"二级分类"}},[a("el-select",{attrs:{filterable:"",clearable:""},on:{change:e.changeSecTagsId},model:{value:e.paramsForm.sec_tags_id,callback:function(t){e.$set(e.paramsForm,"sec_tags_id",t)},expression:"paramsForm.sec_tags_id"}},e._l(e.secondAd,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"三级分类"}},[a("el-select",{attrs:{filterable:"",clearable:""},model:{value:e.paramsForm.thr_tags_id,callback:function(t){e.$set(e.paramsForm,"thr_tags_id",t)},expression:"paramsForm.thr_tags_id"}},e._l(e.thirdAd,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("div",{staticClass:"key-image-wrap"},[a("p",{staticClass:"subtitle"},[e._v("关键图")]),a("base-btn",{attrs:{disabled:e.cutDisabled},on:{click:e.cutVideoImage}},[e._v("截取")]),a("div",{staticClass:"key-image-content"},e._l(e.keyImageData,(function(t,n){return a("div",{key:n,staticClass:"key-image-item"},[a("base-image",{attrs:{src:t.url}}),a("i",{staticClass:"el-icon-delete-solid",on:{click:function(t){return e.deleteImage(n)}}})],1)})),0)],1),a("el-form-item",{attrs:{label:"广告代言人"}},[a("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchSpokesman,placeholder:"请输入广告代言人",maxlength:50,type:"textarea"},model:{value:e.paramsForm.spokesman,callback:function(t){e.$set(e.paramsForm,"spokesman",t)},expression:"paramsForm.spokesman"}})],1),a("el-form-item",{attrs:{label:"广告语"}},[a("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchSlogan,placeholder:"请输入广告语",maxlength:50,type:"textarea"},model:{value:e.paramsForm.slogan,callback:function(t){e.$set(e.paramsForm,"slogan",t)},expression:"paramsForm.slogan"}})],1),a("el-form-item",{attrs:{label:"主题分类"}},[a("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchSubject,placeholder:"请输入主题分类",maxlength:50,type:"textarea"},model:{value:e.paramsForm.subject,callback:function(t){e.$set(e.paramsForm,"subject",t)},expression:"paramsForm.subject"}})],1),a("el-form-item",{attrs:{label:"广告系列"}},[a("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchSeries,placeholder:"请输入广告系列",maxlength:50,type:"textarea"},model:{value:e.paramsForm.series,callback:function(t){e.$set(e.paramsForm,"series",t)},expression:"paramsForm.series"}})],1),a("el-form-item",{attrs:{label:"制作机构"}},[a("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchOrganization,placeholder:"请输入制作机构",maxlength:50,type:"textarea"},model:{value:e.paramsForm.organization,callback:function(t){e.$set(e.paramsForm,"organization",t)},expression:"paramsForm.organization"}})],1),a("el-form-item",{attrs:{label:"语言"}},[a("el-select",{model:{value:e.paramsForm.language,callback:function(t){e.$set(e.paramsForm,"language",t)},expression:"paramsForm.language"}},[a("el-option",{attrs:{label:"中文",value:"中文"}}),a("el-option",{attrs:{label:"英文",value:"英文"}}),a("el-option",{attrs:{label:"韩语",value:"韩语"}}),a("el-option",{attrs:{label:"日语",value:"日语"}})],1)],1),a("el-form-item",{staticClass:"formTime",attrs:{label:"开始时间:"}},e._l(e.timeArray,(function(t){return a("el-input",{key:t,attrs:{type:"number",size:"mini"},model:{value:e.form["start"+t],callback:function(a){e.$set(e.form,"start"+t,e._n("string"===typeof a?a.trim():a))},expression:"form['start' + item]"}})})),1),a("el-form-item",{staticClass:"formTime",attrs:{label:"结束时间:"}},e._l(e.timeArray,(function(t){return a("el-input",{key:t,attrs:{type:"number",size:"mini"},model:{value:e.form["end"+t],callback:function(a){e.$set(e.form,"end"+t,e._n("string"===typeof a?a.trim():a))},expression:"form['end' + item]"}})})),1),a("el-button",{attrs:{type:"primary",size:"default"},on:{click:e.setting}},[e._v("设置完成")])],1),a("div",{staticClass:"btn-wrap"},[a("base-btn",{attrs:{disabled:e.disabled},on:{click:function(t){return e.confirm("ruleForm")}}},[e._v("确定")]),a("base-btn",{attrs:{type:"info"},on:{click:e.close}},[e._v("取消")])],1)],1)},y=[],D=(a("4194"),a("053b"),a("ea69"),a("513c"),a("ed08")),w={components:{},props:{modelData:{type:Object,default:function(){return{}}},videoUrl:{type:String,default:function(){return""}}},data:function(){return{videoDurantion:0,categories:["公益广告","商业广告","购物广告","植入广告","赞助广告"],form:{start_time:"",startHour:"",startMinute:"",startSecond:"",startMs:"",endHour:"",endMinute:"",endSecond:"",endMs:"",end_time:"",cut_start:"",cut_end:""},paramsForm:{tags:"",title:"",brand_id:null,product_id:null,tags_id:null,sec_tags_id:null,thr_tags_id:null,industry_id:null,sec_industry_id:null,thr_industry_id:null,ader_id:null,spokesman:"",subject:"",slogan:"",series:"",organization:"",language:"中文"},timeArray:["Hour","Minute","Second","Ms"],date:"",rules:{title:[{required:!0,message:"请输入标题",trigger:"blur"}],tags_id:[{required:!0,message:"请选择一级广告分类",trigger:"change"}]},baseMessage:[{key:"productData",label:"商品"},{key:"brandData",label:"品牌"},{key:"aderData",label:"广告主"}],cateGoryData:[{key:"firstIndustry",label:"行业",level:"一级"},{key:"firstAd",label:"广告",level:"一级"}],productData:[],brandData:[],aderData:[],firstIndustry:[],secondIndustry:[],thirdIndustry:[],firstAd:[],secondAd:[],thirdAd:[],keyImageData:[],disabled:!1,cutDisabled:!1}},computed:{},watch:{},created:function(){var e=this;return Object(m["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getDurantion();case 2:return e.videoDurantion=t.sent,e.baseMessage.forEach((function(t){e.getBaseMessageData(t)})),e.cateGoryData.forEach((function(t){e.getCategoryData(t)})),Object.keys(e.paramsForm).forEach((function(t){e.paramsForm[t]=e.modelData[t]})),e.keyImageData=e.modelData.img_list||[],t.next=9,e.getIndustryData();case 9:return t.next=11,e.getSecIndustryData();case 11:return t.next=13,e.getTagsData();case 13:return t.next=15,e.getSecTagsData();case 15:case"end":return t.stop()}}),t)})))()},mounted:function(){var e=this;this.$bus.$on("setTime",(function(t){e.form.startHour=Object(D["a"])(t.start_ms).hours,e.form.startMinute=Object(D["a"])(t.start_ms).minutes,e.form.startSecond=Object(D["a"])(t.start_ms).seconds,e.form.startMs=Object(D["a"])(t.start_ms).ms,e.form.endHour=Object(D["a"])(t.end_ms).hours,e.form.endMinute=Object(D["a"])(t.end_ms).minutes,e.form.endSecond=Object(D["a"])(t.end_ms).seconds,e.form.endMs=Object(D["a"])(t.end_ms).ms})),this.$bus.$on("setImageData",(function(t){e.keyImageData.push({url:t,path:""}),e.cutDisabled=!1}))},beforeDestroy:function(){this.$bus.$off("setTime"),this.$bus.$off("setImageData")},methods:{cutVideoImage:function(){if(this.cutDisabled=!0,this.keyImageData.length>=10)return this.cutDisabled=!1,void this.$message({type:"warning",message:"截取关键图不能超过10个"});this.$bus.$emit("cutVideoImage")},timeInit:function(e){return Object(D["a"])(e)},querySearchAsync:function(e,t){var a=this;return Object(m["a"])(regeneratorRuntime.mark((function n(){var r,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,a.getTitleList(e);case 2:r=n.sent,s=[],r.forEach((function(e){s.push({id:e.id,value:e.title})})),t(s);case 6:case"end":return n.stop()}}),n)})))()},getSampleData:function(e){var t=this;return e.page=1,e.limit=5e3,new Promise((function(a,n){t.$get("/ad-sample/search",e).then((function(e){a(e.data.list)})).catch((function(e){t.$message(e.msg)}))}))},getSampleShowArr:function(e,t){var a=[];return e.forEach((function(e){e[t]&&a.push({id:e.id,value:e[t]})})),a},querySearchSpokesman:function(e,t){var a=this;return Object(m["a"])(regeneratorRuntime.mark((function n(){var r,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r={spokesman:e},n.next=3,a.getSampleData(r);case 3:s=n.sent,t(a.getSampleShowArr(s,"spokesman"));case 5:case"end":return n.stop()}}),n)})))()},querySearchSlogan:function(e,t){var a=this;return Object(m["a"])(regeneratorRuntime.mark((function n(){var r,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r={slogan:e},n.next=3,a.getSampleData(r);case 3:s=n.sent,t(a.getSampleShowArr(s,"slogan"));case 5:case"end":return n.stop()}}),n)})))()},querySearchSubject:function(e,t){var a=this;return Object(m["a"])(regeneratorRuntime.mark((function n(){var r,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r={subject:e},n.next=3,a.getSampleData(r);case 3:s=n.sent,t(a.getSampleShowArr(s,"subject"));case 5:case"end":return n.stop()}}),n)})))()},querySearchSeries:function(e,t){var a=this;return Object(m["a"])(regeneratorRuntime.mark((function n(){var r,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r={series:e},n.next=3,a.getSampleData(r);case 3:s=n.sent,t(a.getSampleShowArr(s,"series"));case 5:case"end":return n.stop()}}),n)})))()},querySearchOrganization:function(e,t){var a=this;return Object(m["a"])(regeneratorRuntime.mark((function n(){var r,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r={organization:e},n.next=3,a.getSampleData(r);case 3:s=n.sent,t(a.getSampleShowArr(s,"organization"));case 5:case"end":return n.stop()}}),n)})))()},getTitleList:function(e){var t=this,a={channel_id:this.modelData.channel_id,keyword:e};return new Promise((function(e,n){t.$get("/epg-ad/epg-ad-search",a).then((function(t){e(t.data.list)})).catch((function(e){t.$message(e.msg)}))}))},confirm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e||t.checkTime("submit")||t.checkImg())return console.log("error submit!!"),!1;t.disabled=!0,t.changeData()}))},changeData:function(){var e=this;this.$confirm("修改会覆盖原数据，请确定！","提示",{confirmButtonText:"确定修改",cancelButtonText:"取消",type:"warning"}).then((function(){e.changeImg()})).catch((function(){e.disabled=!1,e.$message({type:"info",message:"已取消修改"})}))},close:function(){this.$emit("close")},setting:function(){if(!this.checkTime()){var e={start_ms:this.getTime("start"),end_ms:this.getTime("end"),max_ms:this.getTime("end")-this.getTime("start")};this.$bus.$emit("setCut",e)}},getTime:function(e){var t=this,a=0;return this.timeArray.forEach((function(n){var r=t.form[e+n]||0;"Hour"===n?a+=36e5*r:"Minute"===n?a+=6e4*r:"Second"===n?a+=1e3*r:"Ms"===n&&(a+=1*r)})),a},getDurantion:function(){var e=this;return new Promise((function(t,a){var n=document.createElement("video");n.src=e.videoUrl,n.addEventListener("canplay",(function(){t(1e3*n.duration)})),n.addEventListener("error",(function(){a("视频加载错误")}))}))},checkTime:function(e){var t="",a=this.getTime("start"),n=this.getTime("end");return"submit"!==e&&(n<=0&&(t="请输入结束时间"),a<0&&(t="请输入开始时间")),a>n&&(t="开始时间不能大于或等于结束时间"),n>this.videoDurantion&&(t="结束时间不能大于片段结束时间"),t&&this.$message.error(t),t},checkImg:function(){var e="";return this.keyImageData.length||(e="请截取关键图"),e&&this.$message.error(e),e},getImgList:function(){var e=[];return this.keyImageData.forEach((function(t){e.push(t.path)})),e},submit:function(){var e=this;return Object(m["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a={data_id:e.modelData.id,action:"update",seq:Object(s["a"])({cut_start:e.getTime("start"),cut_end:e.getTime("end"),brand:e.getBrandName(),img_list:e.getImgList()},e.paramsForm)},e.$post("/ad-sample/queue-modify",a).then((function(t){e.$message({type:"success",message:"更新成功"}),e.$emit("update"),e.close()})).catch((function(t){e.$message({type:"warning",message:t.msg})})).finally((function(){e.disabled=!1}));case 2:case"end":return t.stop()}}),t)})))()},getBrandName:function(){var e=this,t=this.brandData.find((function(t){return t.id===e.paramsForm.brand_id}));return t?t.name:""},changeImg:function(){var e=this;return Object(m["a"])(regeneratorRuntime.mark((function t(){var a,n,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:t.prev=0,a=0;case 2:if(!(a<e.keyImageData.length)){t.next=15;break}if(e.keyImageData[a].path){t.next=12;break}return n=(new Date).getTime()+".jpg",t.next=7,Object(p["a"])(e.keyImageData[a].url,n);case 7:return r=t.sent,s=new FormData,s.append("photo",r),t.next=12,e.uploadImg(s,a);case 12:a++,t.next=2;break;case 15:e.submit(),t.next=22;break;case 18:t.prev=18,t.t0=t["catch"](0),e.disabled=!1,alert(t.t0);case 22:case"end":return t.stop()}}),t,null,[[0,18]])})))()},deleteImage:function(e){this.keyImageData.splice(e,1)},uploadImg:function(e,t){var a=this;return new Promise((function(n,r){a.$post("/ad-sample/upload-img",e).then((function(e){a.keyImageData[t].path=e.data.file_path,n()})).catch((function(e){r(e)}))}))},filterData:function(e,t){var a=this.baseMessage[t];a.name=e,this.getBaseMessageData(a)},getBaseMessageData:function(e){var t=this;return Object(m["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n={type:e.label,page:1,limit:20,name:e.name||""},t.$get("/ad-sample/ad-additional/list",n).then((function(a){t.$data[e.key]=a.data.list})).catch((function(e){t.$message.error(e.msg)}));case 2:case"end":return a.stop()}}),a)})))()},getCategoryData:function(e){var t=this;return Object(m["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n={type:e.label,level:e.level,pid:e.pid||null,page:1,limit:5e3},t.$get("/ad-sample/ad-type/list",n).then((function(a){t.$data[e.key]=a.data.list})).catch((function(e){t.$message.error(e.msg)}));case 2:case"end":return a.stop()}}),a)})))()},changeIndustryId:function(){this.paramsForm.sec_industry_id=null,this.paramsForm.thr_industry_id=null,this.getIndustryData()},getIndustryData:function(){if(!this.paramsForm.industry_id)return this.secondIndustry=[],void(this.thirdIndustry=[]);var e={level:"二级",type:"行业",key:"secondIndustry",pid:this.paramsForm.industry_id};this.getCategoryData(e)},changeSecIndustryId:function(){this.paramsForm.thr_industry_id=null,this.getSecIndustryData()},getSecIndustryData:function(){if(this.paramsForm.sec_industry_id){var e={level:"三级",type:"行业",key:"thirdIndustry",pid:this.paramsForm.sec_industry_id};this.getCategoryData(e)}else this.thirdIndustry=[]},changeTagsId:function(e){var t=this.firstAd.find((function(t){return t.id===Number(e)}));this.paramsForm.tags=t?t.name:"",this.paramsForm.sec_tags_id=null,this.paramsForm.thr_tags_id=null,this.getTagsData()},getTagsData:function(){if(!this.paramsForm.tags_id)return this.secondAd=[],void(this.thirdAd=[]);var e={level:"二级",type:"广告",key:"secondAd",pid:this.paramsForm.tags_id};this.getCategoryData(e)},changeSecTagsId:function(){this.paramsForm.thr_tags_id=null,this.getSecTagsData()},getSecTagsData:function(){if(this.paramsForm.sec_tags_id){var e={level:"三级",type:"广告",key:"thirdAd",pid:this.paramsForm.sec_tags_id};this.getCategoryData(e)}else this.thirdAd=[]}}},k=w,$=(a("59d3"),Object(g["a"])(k,v,y,!1,null,"52a8394c",null)),x=$.exports,S=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("base-dialog",{staticClass:"to-add-dialog",attrs:{show:e.show,title:"出现重复样本，请确定是否继续添加！重复样本见下：",width:"800px","close-on-click-modal":!1},on:{close:e.close}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"sample-content"},e._l(e.sampleData,(function(t){return a("div",{key:t.id,staticClass:"sample-wrap"},[a("div",{staticClass:"sample-wrap-left"},[a("video-player",{key:t.id,ref:"videoPlayer",refInFor:!0,attrs:{options:e.getPlayOption(t),playsinline:!0}})],1),a("div",{staticClass:"sample-wrap-right"},[a("p",[e._v("样本 ID："+e._s(t.id))]),a("p",[e._v("标题 ："+e._s(t.title))]),a("p",[e._v("分类 "+e._s(t.tags))]),a("p",[e._v("品牌："+e._s(t.brand))]),a("p",[e._v("样本来源 ："+e._s(t.channel_name)+" "+e._s(t.updated_at))])])])})),0),a("div",{staticClass:"btn-wrap"},[a("base-btn",{on:{click:e.confirm}},[e._v("确定添加")]),a("base-btn",{attrs:{type:"info"},on:{click:e.cancel}},[e._v("取消添加")])],1)])},I=[],F={components:{},props:{show:{type:Boolean,default:function(){return!1}},modelData:{type:Object,default:function(){return{}}}},data:function(){return{playerOptions:{height:"360",autoplay:!0,muted:!1,language:"en",fluid:!0,playbackRates:[.7,1,1.5,2],sources:[{type:"video/mp4",src:""}],poster:"https://surmon-china.github.io/vue-quill-editor/static/images/surmon-1.jpg"},sampleData:[],loading:!0}},computed:{},watch:{},created:function(){this.getSampleData()},mounted:function(){},methods:{close:function(){this.$emit("close")},confirm:function(){var e=this,t={data_id:this.modelData.id,action:"go-on",seq:{title:this.modelData.title,brand:this.modelData.brand,tags:this.modelData.tags}};this.$post("/ad-sample/queue-modify",t).then((function(t){e.$message({type:"success",message:"添加成功"}),e.close(),e.$emit("update")})).catch((function(t){e.$message({type:"warning",message:t.msg})}))},cancel:function(){this.close()},getSampleData:function(){var e=this;this.loading=!0;var t={sample_ids:this.modelData.sample_ids,page:1,limit:30,show_delete:1};this.$get("/ad-sample/search",t).then((function(t){e.sampleData=t.data.list})).catch((function(t){e.$message({type:"error",message:t.msg})})).finally((function(){e.loading=!1}))},getPlayOption:function(e){return{height:"360",autoplay:!1,muted:!1,language:"en",fluid:!0,playbackRates:[.7,1,1.5,2],sources:[{type:"video/mp4",src:e.mp4_url}],poster:"https://surmon-china.github.io/vue-quill-editor/static/images/surmon-1.jpg"}}}},C=F,j=(a("2347"),Object(g["a"])(C,S,I,!1,null,"3e4ed876",null)),M=j.exports,O={components:{PlaySample:c["a"],UpdateSample:_,UpdateForm:x,ContinueAdd:M},props:{tableData:{type:Array,default:function(){return[]}},pag:{type:Object,default:function(){return{}}}},data:function(){return{showPlayModel:!1,showUpdateModel:!1,showAddModel:!1,modelData:{},repeat_id:null}},computed:{},watch:{},created:function(){},mounted:function(){},methods:{handleCurrentChange:function(e){this.$emit("currentChange",e)},handleSizeChange:function(e){this.$emit("sizeChange",e)},updateTable:function(){this.$emit("update")},deleteData:function(e){var t=this;this.$confirm("删除不可逆，请确定！","提示",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then((function(){t.modelData=e,t.deleteSample()})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},showDelBtn:function(e){return"入库中"!==e&&"视频转码中"!==e&&"入库成功"!==e},deleteSample:function(){var e=this,t={data_id:this.modelData.id,action:"delete",seq:{title:this.modelData.title,brand:this.modelData.brand,tags:this.modelData.tags}};this.$post("/ad-sample/queue-modify",t).then((function(t){e.$message({type:"success",message:"删除成功"}),e.$emit("update")})).catch((function(t){e.$message({type:"warning",message:t.msg})}))},playSample:function(e){this.modelData=e,this.showPlayModel=!0},updateSample:function(e){this.showUpdateModel=!0,this.modelData=e},closePlayModel:function(){this.showPlayModel=!1},closeUpdateModel:function(){this.showUpdateModel=!1},closeAddModel:function(){this.showAddModel=!1},reSubmit:function(e){var t=this;this.$confirm("确定重新提交！视频问题导致失败重新提交也可能失败。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.modelData=e,t.submit()})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},submit:function(){var e=this,t={data_id:this.modelData.id,action:"resubmit",seq:{title:this.modelData.title,brand:this.modelData.brand,tags:this.modelData.tags}};this.$post("/ad-sample/queue-modify",t).then((function(t){e.$message({type:"success",message:"提交成功"}),e.$emit("update")})).catch((function(t){e.$message({type:"warning",message:t.msg})}))},toAdd:function(e){this.modelData=e,this.showAddModel=!0}}},T=O,A=(a("fe79"),Object(g["a"])(T,o,l,!1,null,"fdfa931e",null)),R=A.exports,q={components:{QueueTable:R},props:{},data:function(){return{sample_status:["视频转码中","待编辑","入库中","失败","入库成功"],form:{status:"",channel_id:null,ad_title:"",ad_id:null,update_time:[]},pag:{page:1,limit:10,total:0},tableData:[],loading:!0}},computed:Object(s["a"])({},Object(i["b"])(["channelData"])),watch:{},created:function(){this.channelData.length||this.$store.dispatch("channel/getChannelData"),this.getData()},mounted:function(){},methods:{handleCurrentChange:function(e){this.pag.page=e,this.getData()},handleSizeChange:function(e){this.pag.limit=e,this.getData()},search:function(){this.pag.page=1,this.getData()},clear:function(){var e=this;Object.keys(this.form).forEach((function(t){e.form[t]=""})),this.form.update_time=[],this.getData()},getData:function(){var e=this;this.loading=!0;var t={status:this.form.status,channel_id:this.form.channel_id,ad_title:this.form.ad_title,ad_id:this.form.ad_id,updated_at_start:this.form.update_time?this.form.update_time[0]:null,updated_at_end:this.form.update_time?this.form.update_time[1]:null,page:this.pag.page,limit:this.pag.limit};this.$get("/ad-sample/queue-search",t).then((function(t){e.tableData=t.data.list,e.pag.total=t.data.total})).catch((function(e){console.log(e.msg)})).finally((function(){e.loading=!1}))}}},E=q,U=(a("97e7"),Object(g["a"])(E,n,r,!1,null,"98097956",null));t["default"]=U.exports},fe79:function(e,t,a){"use strict";a("efc5")}}]);