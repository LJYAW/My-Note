(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d76806a8"],{"0ebb":function(e,t,a){},8319:function(e,t,a){"use strict";a("0ebb")},b771:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"order-assign"},[a("div",{staticClass:"content-header"},[a("el-form",{attrs:{inline:!0,model:e.form}},[a("el-form-item",{attrs:{label:"工单编号"}},[a("el-input",{attrs:{placeholder:"请输入工单编号"},model:{value:e.form.order_no,callback:function(t){e.$set(e.form,"order_no",t)},expression:"form.order_no"}})],1),a("el-form-item",{attrs:{label:"工单类型"}},[a("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择"},model:{value:e.form.order_type,callback:function(t){e.$set(e.form,"order_type",t)},expression:"form.order_type"}},e._l(e.order_type_list,(function(e){return a("el-option",{key:e.type_name,attrs:{label:e.type_name,value:e.type_name}})})),1)],1),e.form.order_type&&"EPG"!==e.form.order_type?a("el-form-item",{attrs:{label:"加工要求"}},[a("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:e.form.processing_require,callback:function(t){e.$set(e.form,"processing_require",t)},expression:"form.processing_require"}},e._l(e.processingRequire,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1):e._e(),a("el-form-item",{attrs:{label:"频道名称"}},[a("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:e.form.channel_id,callback:function(t){e.$set(e.form,"channel_id",t)},expression:"form.channel_id"}},e._l(e.channelData,(function(e){return a("el-option",{key:"频道名称"+e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"栏目名称"}},[a("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:e.form.item_name,callback:function(t){e.$set(e.form,"item_name",t)},expression:"form.item_name"}},e._l(e.itemData,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.name}})})),1)],1),a("el-form-item",{attrs:{label:"任务等级"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.form.task_level,callback:function(t){e.$set(e.form,"task_level",t)},expression:"form.task_level"}},e._l(e.task_level_list,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("el-form-item",{attrs:{label:"任务周期"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.form.task_cycle,callback:function(t){e.$set(e.form,"task_cycle",t)},expression:"form.task_cycle"}},e._l(e.task_cycle_list,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("el-form-item",{attrs:{label:"加工时效"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.form.processing_efficiency,callback:function(t){e.$set(e.form,"processing_efficiency",t)},expression:"form.processing_efficiency"}},e._l(e.processing_efficiency,(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),a("el-form-item",{attrs:{label:"工单状态"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},e._l(e.order_status,(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),a("base-btn",{staticClass:"search-btn",attrs:{size:"big"},on:{click:e.searchData}},[e._v("搜索")]),a("base-btn",{staticClass:"search-btn create-btn",attrs:{size:"big"},on:{click:e.clearSearch}},[e._v("清除")])],1)],1),a("el-table",{attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{prop:"order_no",width:"80",label:"工单编号"}}),a("el-table-column",{attrs:{prop:"task_cycle",label:"任务周期"}}),a("el-table-column",{attrs:{label:"工单类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.order_type.join("、"))+" ")]}}])}),a("el-table-column",{attrs:{label:"加工要求"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.processing_require.join("、"))+" ")]}}])}),a("el-table-column",{attrs:{prop:"item_name",label:"栏目名称"}}),a("el-table-column",{attrs:{prop:"channel_name",label:"频道名称"}}),a("el-table-column",{attrs:{label:"加工流程"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.processing_flow.join("、"))+" ")]}}])}),a("el-table-column",{attrs:{label:"加工时效"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.processing_efficiency.join("、"))+" ")]}}])}),a("el-table-column",{attrs:{prop:"task_level",label:"任务等级"}}),a("el-table-column",{attrs:{prop:"customers",label:"客户数"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.row.customers.join("、"),placement:"top-start"}},[a("span",[e._v(e._s(t.row.customers.length))])])]}}])}),a("el-table-column",{attrs:{prop:"status",label:"工单状态"}}),a("el-table-column",{attrs:{label:"操作",width:"55"}},[[a("span",[e._v("指派")])]],2),a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-table",{attrs:{data:t.row.time_list,"span-method":e.objectSpanMethod}},[a("el-table-column",{attrs:{prop:"短期播放"==t.row.task_cycle?"date":"week",label:"日期"}}),a("el-table-column",{attrs:{prop:"time",label:"播出时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.start_time)+" - "+e._s(t.row.end_time)+" ")]}}],null,!0)}),a("el-table-column",{attrs:{prop:"processing_require",label:"加工要求"}}),a("el-table-column",{attrs:{label:"操作",width:"500"},scopedSlots:e._u([{key:"default",fn:function(r){return[r.row.isAssign&&!r.row.toUpdate?a("div",[a("span",{staticClass:"text"},[e._v(e._s(r.row.department_name))]),"EPG"!==r.row.processing_require&&"广告"!==r.row.processing_require?a("span",{staticClass:"text"},[e._v(e._s(r.row.executor_name))]):e._e(),a("base-btn",{attrs:{size:"mini",round:""},nativeOn:{click:function(a){return e.updateAssign(t.$index,r.$index)}}},[e._v("修改指派")])],1):a("div",[a("el-select",{attrs:{placeholder:"请选择",size:"mini",clearable:""},on:{change:function(t){return e.handleSelectChange(r.row)}},model:{value:r.row.department_id,callback:function(t){e.$set(r.row,"department_id",t)},expression:"scopes.row.department_id"}},e._l(e.teamData,(function(e){return a("el-option",{key:e.id,attrs:{label:e.department_name,value:e.id}})})),1),"EPG"!==r.row.processing_require&&"广告"!==r.row.processing_require?a("el-select",{attrs:{placeholder:"请选择",clearable:"",size:"mini"},model:{value:r.row.executor_id,callback:function(t){e.$set(r.row,"executor_id",t)},expression:"scopes.row.executor_id"}},e._l(e.userData(r.row.department_id),(function(e){return a("el-option",{key:e.id,attrs:{label:e.nickname,value:e.id}})})),1):e._e(),a("base-btn",{attrs:{size:"mini",round:""},on:{click:function(a){return e.submit(t.$index,r.$index,r.row)}}},[e._v("提交")]),r.row.isAssign?a("base-btn",{attrs:{size:"mini",round:""},on:{click:function(a){return e.cancel(t.$index,r.$index)}}},[e._v("取消")]):e._e()],1)]}}],null,!0)},[a("template",{slot:"header"},[a("div",{staticClass:"table-head"},[a("span",[e._v("操作")]),a("i",{staticClass:"iconfont el-icon-refresh",on:{click:function(a){return e.syncTeam(t.row.time_list)}}})])])],2)],1)]}}])})],1),a("base-pag",{attrs:{total:e.total,limit:e.limit,page:e.page},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)},n=[],i=a("99a5"),l=a("1c03"),s=(a("6a61"),a("dbb3"),a("08ba"),a("e18c"),a("52c1")),o={name:"Assign",components:{},props:{},data:function(){return{loading:!0,form:{order_no:"",order_type:"",task_level:"",task_cycle:"",channel_id:"",item_name:"",status:"",processing_require:"",processing_efficiency:""},total:0,page:1,limit:10,order_type_list:[{type_name:"整档",require_items:["节目整档","新闻整档"]},{type_name:"拆条",require_items:["新闻拆条","节目分段"]},{type_name:"广告",require_items:["商业广告","公益广告","购物广告","植入广告","赞助广告"]},{type_name:"EPG"}],processing_efficiency:["5分钟","10分钟","15分钟","30分钟","50分钟","60分钟","1.5小时","2小时","4小时","1天","3天"],processing_require_data:[],task_level_list:["正常","加急"],task_cycle_list:["周期播放","短期播放"],order_status:{"ORDER_STATUS_执行中":"执行中","ORDER_STATUS_待执行":"待执行","ORDER_STATUS_已失效":"已失效"},tableData:[],userList:[]}},computed:Object(l["a"])({processingRequire:function(){var e=this,t=this.order_type_list.filter((function(t){return t.type_name===e.form.order_type}));return t.length?t[0].require_items:[]}},Object(s["b"])(["channelData","itemData","teamData"])),watch:{"form.channel_id":function(e){e&&this.$store.dispatch("channel/getItemList",{channel_id:e}),this.form.item_name=null},"form.order_type":function(e){this.form.processing_require=""}},created:function(){this.loading=!0,this.channelData.length||this.$store.dispatch("channel/getChannelData"),this.teamData.length||this.$store.dispatch("user/getTeamData",{page:1,limit:1e4}),this.getUser(),this.getTableData()},mounted:function(){},methods:{getTableData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getOrderList();case 2:e.setTableData();case 3:case"end":return t.stop()}}),t)})))()},setFieldValue:function(e,t,a){switch(e){case"整档":return t["video_"+a];case"拆条":return t["cut_video_"+a];case"EPG":return t["epg_"+a];case"广告":return t["ad_"+a]}},setTableData:function(){var e=this;this.tableData.forEach((function(t,a){var r=t.order_type,n=t.time_list,i=[];n.forEach((function(t){r.forEach((function(a){i.push({processing_require:a,order_type:r,department_id:e.setFieldValue(a,t,"department_id"),department_name:e.setFieldValue(a,t,"department_name"),executor_id:"整档"===a?t.video_executor_id:t.cut_video_executor_id,executor_name:"整档"===a?t.video_executor_name:t.cut_video_executor_name,time_id:t.time_id,start_time:t.start_time,end_time:t.end_time,week:t.week,date:t.date})}))})),t.time_list=i,t.time_list.forEach((function(e){e.isAssign=""!==e.department_id,e.department_id&&(e.toUpdate=!1)}))}))},objectSpanMethod:function(e){var t=e.row,a=(e.column,e.rowIndex),r=e.columnIndex;if(t.order_type&&t.order_type.length>1&&(0===r||1===r))return a%2===0?{rowspan:2,colspan:1}:{rowspan:0,colspan:0}},submit:function(e,t,a){var r=this;if(!a.department_id)return this.$message({message:"请选择指派团队",type:"warning"}),!1;var n={time_id:[a.time_id],department_id:a.department_id,executor_id:a.executor_id,order_type:a.processing_require};this.$post("/production/assign-order-time",n).then((function(n){r.$message({message:"指派成功",type:"success"});var i=JSON.parse(JSON.stringify(r.tableData[e].time_list[t]));i.toUpdate=!1,i.isAssign=!0,i.department_name=r.teamData.filter((function(e){return e.id===a.department_id}))[0].department_name,i.executor_name=a.executor_id?r.userList.filter((function(e){return e.id===a.executor_id}))[0].nickname:"",r.$set(r.tableData[e].time_list,t,i)})).catch((function(e){r.$message.error(e.msg)}))},searchData:function(){this.page=1,this.getTableData()},clearSearch:function(){for(var e in this.form)this.form[e]=""},handleSelectChange:function(e){e.executor_id=""},userData:function(e){return this.userList.filter((function(t){return t.department_id===e}))},getUser:function(){var e=this;this.$get("/user/userList",{page:1,limit:1e4}).then((function(t){e.userList=t.data.list}))},getOrderList:function(){var e=this,t=this.form;return t.page=this.page,t.limit=this.limit,new Promise((function(a,r){e.$get("/production/order-list",t).then((function(t){e.tableData=t.data.list,e.total=t.data.total,a(t.data)})).catch((function(e){r(e)}))}))},updateAssign:function(e,t){this.changeTimeListStatus(e,t,!0)},cancel:function(e,t){this.changeTimeListStatus(e,t,!1)},changeTimeListStatus:function(e,t,a,r){var n=JSON.parse(JSON.stringify(this.tableData[e].time_list[t]));n.toUpdate=a,this.$set(this.tableData[e].time_list,t,n)},syncTeam:function(e){var t=this;this.$nextTick((function(){e.forEach((function(a,r){a.department_id=e[0].department_id,a.executor_id=e[0].executor_id,a.isAssign&&r&&(a.toUpdate=!0,t.$set(e,r,a))}))}))},handleCurrentChange:function(e){this.page=e,this.getTableData()},handleSizeChange:function(e){this.limit=e,this.getTableData()}}},c=o,u=(a("8319"),a("4ac2")),m=Object(u["a"])(c,r,n,!1,null,"0bc57b49",null);t["default"]=m.exports}}]);