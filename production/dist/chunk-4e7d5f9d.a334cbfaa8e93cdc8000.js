(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4e7d5f9d"],{"1f19":function(t,e,s){},"387b":function(t,e,s){"use strict";s("7810")},"6a8d":function(t,e,s){"use strict";s("1f19")},"6af6":function(t,e,s){"use strict";s("9ba5")},7810:function(t,e,s){},9302:function(t,e,s){"use strict";var n=s("1c8b"),i=s("692f"),a=s("da10"),c=s("d7e1"),o=[].join,r=i!=Object,l=c("join",",");n({target:"Array",proto:!0,forced:r||!l},{join:function(t){return o.call(a(this),void 0===t?",":t)}})},"9ba5":function(t,e,s){},a242:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"create-program"},[s("channel",{ref:"channel",staticClass:"channel"}),s("div",{staticClass:"btns"},[s("base-btn",{on:{click:function(e){return t.createdItem()}}},[t._v("提交")]),s("base-btn",{attrs:{type:""},on:{click:t.cancel}},[t._v("取消")])],1)],1)},i=[],a=(s("9302"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"ruleForm",attrs:{model:t.form,"label-width":"100px",rules:t.rules}},[s("el-form-item",{attrs:{label:"频道名称",prop:"channel_id"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",filterable:"",clearable:""},model:{value:t.form.channel_id,callback:function(e){t.$set(t.form,"channel_id",e)},expression:"form.channel_id"}},t._l(t.channelData,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),s("el-form-item",{attrs:{label:"栏目名称",prop:"item_name"}},[s("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入栏目名称",maxlength:"50"},model:{value:t.form.item_name,callback:function(e){t.$set(t.form,"item_name","string"===typeof e?e.trim():e)},expression:"form.item_name"}})],1),s("el-form-item",{attrs:{label:"栏目分类",required:""}},[s("base-btn",{nativeOn:{click:function(e){return t.openClassModal(e)}}},[s("i",{staticClass:"iconfont el-icon-edit"}),t._v("编辑分类")]),t.firstCheckList.length?s("div",{staticClass:"column-table"},[s("div",{staticClass:"column-content"},[s("p",{staticClass:"type"},[t._v("一级分类")]),s("p",{staticClass:"flex-1"},[t._v(t._s(t.firstCheckName.join("、")))])]),t.secondCheckList.length?s("div",{staticClass:"column-content column-last"},[s("p",{staticClass:"type"},[t._v("二级分类")]),s("p",{staticClass:"flex-1"},[t._v(t._s(t.secondCheckName.join("、")))])]):t._e()]):t._e(),s("ColumnClassify",{ref:"category",attrs:{"show-cate-dialog":t.showCateDialog},on:{setClassData:t.setClassData,close:t.close}})],1)],1)],1)}),c=[],o=s("99a5"),r=s("1c03"),l=(s("6a61"),s("08ba"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"column-type"},[s("base-dialog",{staticClass:"column-dialog",attrs:{show:t.showCateDialog,"append-to-body":"",width:"70%","destroy-on-close":!0},on:{close:t.close}},[s("div",[t.firstCheckList.length?s("div",{staticClass:"column-list"},[s("p",{staticClass:"column-name"},[t._v("已选分类：")]),s("el-form",{attrs:{"label-width":"80px"}},[s("el-form-item",{attrs:{label:"一级分类"}},[s("div",{staticClass:"box"},t._l(t.firstCheckList,(function(e,n){return s("base-tag",{key:e.first_category_id+"_"+n,attrs:{closable:""},on:{close:function(s){return t.handleClose(1,e)}}},[t._v(t._s(e.first_category_name))])})),1)]),t.secondCheckList.length?s("el-form-item",{attrs:{label:"二级分类"}},t._l(t.secondCheckList,(function(e,n){return s("base-tag",{key:n,attrs:{closable:""},on:{close:function(s){return t.handleClose(2,e)}}},[t._v(t._s(e.second_category_name))])})),1):t._e()],1)],1):t._e(),s("div",{staticClass:"column-list"},[s("p",{staticClass:"column-name"},[t._v("一级分类")]),s("el-checkbox-group",{model:{value:t.firstCheckList,callback:function(e){t.firstCheckList=e},expression:"firstCheckList"}},t._l(t.categoryList,(function(e){return s("el-checkbox",{key:e.first_category_id,attrs:{label:e}},[t._v(t._s(e.first_category_name))])})),1)],1),t.firstCheckList.length?s("div",{staticClass:"column-list"},[s("p",{staticClass:"column-name"},[t._v("二级分类")]),s("div",{staticClass:"flex-1"},t._l(t.secondList,(function(e,n){return s("div",{key:n,ref:"secondCategoryList",refInFor:!0,staticClass:"column-list"},[s("p",{staticClass:"column-name"},[t._v(t._s(e.first_category_name))]),s("el-checkbox-group",{class:[e.isOpen&&"more","column-group"],model:{value:t.secondCheckList,callback:function(e){t.secondCheckList=e},expression:"secondCheckList"}},t._l(e.arr,(function(e){return s("el-checkbox",{key:e.second_category_id,attrs:{label:e}},[t._v(t._s(e.second_category_name))])})),1),e.showMore?s("div",{staticClass:"toggle-btn"},[s("el-button",{attrs:{type:"text",size:"default"},on:{click:function(e){return t.handelClik(n)}}},[e.isOpen?s("span",[t._v("展开")]):s("span",[t._v("收起")])])],1):t._e()],1)})),0)]):t._e()]),s("div",{staticClass:"dialog-footer"},[s("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("确 定")]),s("el-button",{on:{click:t.close}},[t._v("取 消")])],1)])],1)}),h=[],f=(s("4194"),s("dbb3"),s("ea69"),s("513c"),{name:"",components:{},props:{showCateDialog:{type:Boolean,default:!1}},data:function(){return{firstCheckList:[],secondCheckList:[],secondList:[],categoryList:[]}},computed:{},watch:{firstCheckList:function(t){this.handleChange(t),this.showMoreBtn()}},created:function(){this.categoryList.length||this.getcategoryList()},mounted:function(){},methods:{getcategoryList:function(){var t=this;this.$get("/epg-task/category-list",{}).then((function(e){console.log("🚀 ~ file: ColumnClassify.vue ~ line 126 ~ this.$get ~ res",e),t.categoryList=e.data})).catch((function(e){t.$message.error(e.msg)}))},submit:function(){this.$emit("setClassData")},close:function(){this.$emit("close")},handleClose:function(t,e){var s=this;if(1===t){var n=this.firstCheckList.find((function(t){return t.first_category_name===e.first_category_name})),i=n.second_category_list;i.forEach((function(t){s.secondCheckList=s.secondCheckList.filter((function(e){return e.second_category_id!==t.second_category_id}))})),this.firstCheckList.splice(this.firstCheckList.indexOf(e),1)}2===t&&this.secondCheckList.splice(this.secondCheckList.indexOf(e),1)},handelClik:function(t){this.$set(this.secondList[t],"isOpen",!this.secondList[t].isOpen)},handleChange:function(t){var e=this;this.secondList=[],this.categoryList.forEach((function(t){return e.firstCheckList.find((function(s){t.first_category_name===s.first_category_name&&e.secondList.push({arr:t.second_category_list,showMore:!1,isOpen:!1,first_category_name:t.first_category_name})}))}))},showMoreBtn:function(){var t=this;this.$nextTick((function(){t.secondList.forEach((function(e,s){if(t.$refs.secondCategoryList){var n=t.$refs.secondCategoryList[s].clientHeight/40;n>2&&(t.$set(t.secondList[s],"showMore",!0),t.$set(t.secondList[s],"isOpen",!0))}}))}))},setDefalutData:function(){var t=arguments,e=this;return Object(o["a"])(regeneratorRuntime.mark((function s(){var n,i;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(n=t.length>0&&void 0!==t[0]?t[0]:[],i=t.length>1&&void 0!==t[1]?t[1]:[],e.categoryList.length){s.next=5;break}return s.next=5,e.$store.dispatch("orderBase/getCategoryList");case 5:e.firstCheckList=[],e.secondCheckList=[],e.categoryList.forEach((function(t){n.forEach((function(s){t.first_category_id===Number(s)&&(e.firstCheckList.push(t),e.handleChange(e.firstCheckList))}))})),e.firstCheckList.forEach((function(t){for(var s=function(s){var n=t.second_category_list[s],a=n.second_category_id;i.forEach((function(t){a===Number(t)&&e.secondCheckList.push(n)}))},n=0;n<t.second_category_list.length;n++)s(n)}));case 9:case"end":return s.stop()}}),s)})))()}}}),u=f,d=(s("387b"),s("4ac2")),m=Object(d["a"])(u,l,h,!1,null,"75e711df",null),g=m.exports,_=s("52c1"),C={channel_id:[{required:!0,message:"请选择频道信息",trigger:"change"}],item_name:[{required:!0,message:"请输入栏目名称",trigger:"blur"}]},k=s("d1ed"),p=s.n(k),v={components:{ColumnClassify:g},props:{defaultData:{type:Object,default:function(){return{channelId:null,itemName:"",firstCheckList:[],secondCheckList:[]}}}},data:function(){return{form:{channel_id:"",item_name:""},loading:!0,rules:C,showCateDialog:!1,firstCheckList:[],secondCheckList:[]}},computed:Object(r["a"])(Object(r["a"])({},Object(_["b"])(["channelData"])),{},{firstCheckName:function(){var t=[];return this.firstCheckList.forEach((function(e){t.push(e.first_category_name)})),t},firstCheckId:function(){var t=[];return this.firstCheckList.forEach((function(e){t.push(e.first_category_id)})),t},secondCheckName:function(){var t=[];return this.secondCheckList.forEach((function(e){t.push(e.second_category_name)})),t},secondCheckId:function(){var t=[];return this.secondCheckList.forEach((function(e){t.push(e.second_category_id)})),t}}),watch:{defaultData:{handler:function(t){t&&this.setDefalutData(t)},deep:!0,immediate:!0}},created:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.channelData){e.next=3;break}return e.next=3,t.$store.dispatch("channel/getChannelData");case 3:t.loading=!1;case 4:case"end":return e.stop()}}),e)})))()},mounted:function(){this.setDefalutData()},methods:{openClassModal:function(){this.showCateDialog=!0,this.setDefalutData(this.defaultData)},setClassData:function(){this.firstCheckList=this.$refs.category.firstCheckList,this.secondCheckList=this.$refs.category.secondCheckList,this.close()},close:function(){this.showCateDialog=!1},setDefalutData:function(t){var e=this,s=t;s&&!s.itemName||p()(s)&&(this.form.channel_id=s.channelId,this.form.item_name=s.itemName,this.$nextTick((function(){e.$refs.category.setDefalutData(s.firstCheckList,s.secondCheckList),e.firstCheckList=e.$refs.category.firstCheckList,e.secondCheckList=e.$refs.category.secondCheckList})))},checkClass:function(){return this.firstCheckList.length<1?(this.$message({message:"请选择一级分类",type:"warning"}),!1):!(this.secondCheckList.length<1)||(this.$message({message:"请选择二级分类",type:"warning"}),!1)},checkFrom:function(t){var e=this;this.$refs["ruleForm"].validate((function(s){if(!s||!e.checkClass())return console.log("error submit!!"),!1;"function"===typeof t&&t()}))},resetForm:function(){this.$refs["ruleForm"].resetFields()}}},y=v,b=(s("6af6"),Object(d["a"])(y,a,c,!1,null,"17b255c6",null)),L=b.exports;s("28de"),s("5f87");function w(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{var e=t;new QWebChannel(qt.webChannelTransport,(function(t){window.TaskEditor=t.objects.TaskEditor,window.TaskEditor.onServerAddEPGItemNotify(e)}))}catch(s){alert(s.message)}}var $={name:"CreateProgram",components:{channel:L},props:{},data:function(){return{active_id:null,ruleForm:{channel_name:"",column_name:"",column_type:""}}},computed:{},watch:{},created:function(){},mounted:function(){},methods:{createdItem:function(){this.$refs.channel.checkFrom(this.submit)},submit:function(t){var e=this,s=this.$refs.channel.secondCheckId.join(),n=this.$refs.channel.firstCheckId.join(),i={channel_id:this.$refs.channel.form.channel_id,item_name:this.$refs.channel.form.item_name,first_category_ids:n,second_category_ids:s};this.$post("/epg-task/item-add",i).then((function(t){e.active_id=t.data.item_id,e.$message({message:"创建成功!",type:"success"}),w(!0)})).catch((function(t){e.$message({message:t.msg,type:"warning"}),w(!1)}))},cancel:function(){w(!1)}}},x=$,D=(s("6a8d"),Object(d["a"])(x,n,i,!1,null,"31c78564",null));e["default"]=D.exports}}]);