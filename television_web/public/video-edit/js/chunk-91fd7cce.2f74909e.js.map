{"version":3,"sources":["webpack:///./src/pages/edit_main/track_header/masaike_index.vue?0057","webpack:///src/pages/edit_main/track_header/masaike_index.vue","webpack:///./src/pages/edit_main/track_header/masaike_index.vue?bd38","webpack:///./src/pages/edit_main/track_header/masaike_index.vue","webpack:///./src/pages/edit_main/track_header/masaike_index.vue?6e95"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","on","$event","exportVideo","_v","staticRenderFns","props","data","track_s","mixins","setTrackData","computed","PER_PX_MS","$store","state","duration","videoPlay","decorate_active_id","active_track","list","find","cutDetails","cut_details","watch","methods","addCutTrakOfMobile","some","x","y","w","width","h","height","id","active","type","trackLeft","resizable","trackWidth","maxWidth","addTrackData","activeBtnList","event","cmd","forEach","left","top","item","start_ms","end_ms","setMs","setMaxMs","addDecorate","current_time_ms","addCutTrak","exportArr","push","obj","window","parent","postMessage","videoWidth","videoHeight","decorateList","videoSize","exportcutDetails","deleteDecorate","deleteTrackData","components","created","mounted","addEventListener","component"],"mappings":"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","file":"js/chunk-91fd7cce.2f74909e.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"trackHeader\"},[_c('ul',{staticClass:\"btn-list\"},[_c('li',{staticClass:\"export-btn\"},[_c('div',{on:{\"click\":function($event){return _vm.exportVideo()}}},[_vm._v(\"导出视频\")])])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<!--\n * @Author: zzx\n * @Date: 2020-09-24 17:32:26\n * @LastEditTime: 2021-04-19 17:09:27\n * @FilePath: /video_edit/src/pages/edit_main/track_header/masaike_index.vue\n-->\n<template>\n  <div class=\"trackHeader\">\n    <ul class=\"btn-list\">\n      <!-- <li>\n        <a @click=\"addCutTrak()\">\n          <i class=\"iconfont icon-ziyuan\"></i>\n        </a>\n      </li> -->\n      <!-- <li>\n        <a @click=\"addCutTrakOfMobile()\">\n          <i class=\"iconfont icon-ziyuan\"></i>\n        </a>\n      </li> -->\n      <!-- <li>\n        <a @click=\"addDecorate()\">\n          <i class=\"iconfont icon-masaike1\"></i>\n        </a>\n      </li> -->\n      <!-- <li>\n        <a @click=\"deleteDecorate()\">\n          <i class=\"iconfont icon-shanchu\"></i>\n        </a>\n      </li> -->\n      <!-- <li class=\"track-btn-ul\">\n        <span class=\"text\" @click.stop>设置秒数</span>\n        <input type=\"number\" v-model=\"track_s\" min=\"0\" />\n        <a class=\"text\" @click.stop=\"setMaxMs()\">max</a>\n        <a class=\"text\" @click.stop=\"setMs()\">确认</a>\n      </li> -->\n      <li class=\"export-btn\">\n        <div @click=\"exportVideo()\">导出视频</div>\n      </li>\n    </ul>\n  </div>\n</template>\n\n<script>\nimport setTrackData from '@/utils/setTrackData.js'\nimport guid from '@/utils/guid.js'\n\nexport default {\n  props: {},\n  data() {\n    return {\n      track_s: 0\n    }\n  },\n  mixins: [setTrackData],\n  computed: {\n    PER_PX_MS() {\n      return this.$store.state.PER_PX_MS\n    },\n    duration() {\n      // 视频总毫秒数\n      return this.$store.state.videoPlay.duration\n    },\n    decorate_active_id() {\n      return this.$store.state.decorate_active_id\n    },\n    active_track() {\n      let list = this.$store.state.decorate_list\n      return list.find(item => item.id == this.decorate_active_id)\n    },\n    cutDetails() {\n      return this.$store.state.cut_details\n    }\n  },\n  watch: {},\n  methods: {\n    // 设置9/16 裁剪框\n    addCutTrakOfMobile() {\n      // 添加装饰轨道\n      let current_time_ms = parseInt(this.$store.state.videoPlay.current_time_ms)\n      let PER_PX_MS = parseInt(this.$store.state.PER_PX_MS)\n      const canvas = document.getElementById('videoCanvas')\n\n      // 添加裁剪轨道\n      let list = this.$store.state.decorate_list\n      let maxWidth = this.duration / this.PER_PX_MS\n      if (list.some(item => item.type == '裁剪')) return\n\n      let height = canvas.height\n      let width = height * (9 / 16)\n      let x = canvas.width / 2 - width / 2\n      // list.some(item => item.type == '裁剪')\n      // 添加装饰轨道 位于视频的位置信息 x轴y轴 选框的宽高 类型，轨道的left和width\n      let data = {\n        x: x,\n        y: 0,\n        w: width,\n        h: height,\n        id: 'decorate_' + guid(),\n        active: true,\n        type: '裁剪', // 装饰类型\n        trackLeft: 0,\n        resizable: false, // 是否可以 改变选框大小\n        trackWidth: maxWidth\n      }\n\n      this.addTrackData(data)\n    },\n    // 计算马赛克位置\n    activeBtnList(event) {\n      if (event.data.cmd == 'setMosaicList') {\n        let list = event.data.data\n\n        let canvas = document.getElementById('videoCanvas')\n        let canvasWidth = canvas.width\n        let canvasHeight = canvas.height\n\n        let player = document.getElementById('myVideo')\n        let videoWidth = player.videoWidth\n        let videoHeight = player.videoHeight\n\n        list.forEach(item => {\n          let top = (item.y / videoHeight) * canvasHeight\n          let left = (item.x / videoWidth) * canvasWidth\n          let width = (item.width / videoWidth) * canvasWidth\n          let height = (item.height / videoHeight) * canvasHeight\n\n          let obj = {\n            active: false,\n            w: width,\n            x: left,\n            y: top,\n            h: height,\n            id: 'decorate_' + guid(),\n            trackLeft: item.start_ms / this.PER_PX_MS,\n            trackWidth: (item.end_ms - item.start_ms) / this.PER_PX_MS,\n            type: item.type || '马赛克'\n          }\n          this.addTrackData(obj)\n        })\n      }\n    },\n    setMs() {\n      if (!this.active_track) return\n      let maxWidth = this.duration / this.PER_PX_MS\n      let widht = (this.track_s * 1000) / this.PER_PX_MS\n      let w = Math.min(maxWidth, widht)\n      this.setTrackData({ trackWidth: w }, this.decorate_active_id)\n    },\n    setMaxMs() {\n      if (!this.active_track) return\n      let maxWidth = this.duration / this.PER_PX_MS\n      let w = maxWidth - this.active_track.trackLeft\n      this.setTrackData({ trackWidth: w }, this.decorate_active_id)\n    },\n    addDecorate() {\n      // 添加装饰轨道\n      let current_time_ms = parseInt(this.$store.state.videoPlay.current_time_ms)\n      let PER_PX_MS = parseInt(this.$store.state.PER_PX_MS)\n\n      // 添加装饰轨道 位于视频的位置信息 x轴y轴 选框的宽高 类型，轨道的left和width\n      let data = {\n        x: 10,\n        y: 10,\n        w: 100,\n        h: 50,\n        id: 'decorate_' + guid(),\n        active: false,\n        type: '马赛克', // 装饰类型\n        trackLeft: (current_time_ms - PER_PX_MS) / PER_PX_MS,\n        trackWidth: 100\n      }\n\n      this.addTrackData(data)\n    },\n    addCutTrak() {\n      // 添加裁剪轨道\n      let list = this.$store.state.decorate_list\n      let maxWidth = this.duration / this.PER_PX_MS\n      if (list.some(item => item.type == '裁剪')) return\n      // list.some(item => item.type == '裁剪')\n      // 添加装饰轨道 位于视频的位置信息 x轴y轴 选框的宽高 类型，轨道的left和width\n      let data = {\n        x: 10,\n        y: 10,\n        w: 400,\n        h: 300,\n        id: 'decorate_' + guid(),\n        active: true,\n        type: '裁剪', // 装饰类型\n        trackLeft: 0,\n        trackWidth: maxWidth\n      }\n\n      this.addTrackData(data)\n    },\n    exportVideo() {\n      /// 发送消息窗口的源（协议+主机+端口号） [也可以设置'*']指向当前的父窗口\n      let list = this.$store.state.decorate_list\n      let exportArr = []\n      // 计算开始时间结束时间\n      let PER_PX_MS = this.$store.state.PER_PX_MS\n      let player = document.getElementById('myVideo')\n      let videoWidth = player.videoWidth\n      let videoHeight = player.videoHeight\n\n      let canvas = document.getElementById('videoCanvas')\n      let canvasWidth = canvas.width\n      let canvasHeight = canvas.height\n\n      list.forEach(item => {\n        let top = (item.y / canvasHeight) * videoHeight\n        let left = (item.x / canvasWidth) * videoWidth\n        let width = (item.w / canvasWidth) * videoWidth\n        let height = (item.h / canvasHeight) * videoHeight\n        let start_ms = item.trackLeft * PER_PX_MS\n\n        let obj = {\n          start_ms: start_ms < 500 ? 0 : start_ms,\n          end_ms: (item.trackLeft + item.trackWidth) * PER_PX_MS,\n          y: top,\n          x: left,\n          width: width,\n          height: height,\n          type: item.type\n        }\n        exportArr.push(obj)\n      })\n\n      window.parent.postMessage({ cmd: 'exportArr', data: exportArr }, '*')\n      let cutDetails = this.exportcutDetails()\n\n      let videoSize = {\n        width: videoWidth,\n        height: videoHeight\n      }\n\n      // 传输 cut 数据以及 装饰数据\n      window.parent.postMessage({\n        cmd: 'exportAllData',\n        data: {\n          cutDetails: cutDetails,\n          decorateList: exportArr,\n          videoSize: videoSize\n        }\n      }, '*')\n    },\n    exportcutDetails() {\n      /// 发送消息窗口的源（协议+主机+端口号） [也可以设置'*']指向当前的父窗口\n      let start_ms = this.cutDetails.trackLeft * this.PER_PX_MS\n      let end_ms = (this.cutDetails.trackLeft + this.cutDetails.trackWidth) * this.PER_PX_MS\n\n      let obj = {\n        start_ms: start_ms < 500 ? 0 : start_ms,\n        end_ms: this.duration - end_ms < 500 ? this.duration : end_ms\n      }\n      return obj\n    },\n    deleteDecorate() {\n      this.deleteTrackData(this.$store.state.decorate_active_id)\n    }\n  },\n  components: {},\n  created() {},\n  mounted() {\n    // 设置互动视频按钮\n    window.addEventListener('message', this.activeBtnList, false)\n  }\n}\n</script>\n\n<style scoped lang=\"scss\">\n.trackHeader {\n  height: 35px;\n  padding-left: 75px;\n  padding-right: 25px;\n  position: relative;\n  box-shadow: 0 5px 10px -5px rgba(0, 0, 0, 0.2);\n  z-index: 99;\n  .track-btn-ul {\n    font-size: 12px;\n    .text {\n      margin: 0 10px;\n      cursor: pointer;\n    }\n  }\n  .btn-list {\n    color: #000;\n    height: 100%;\n    margin: 0;\n    display: flex;\n    align-items: center;\n    li {\n      margin: 0 20px;\n    }\n    .iconfont {\n      color: #232323;\n    }\n    .export-btn {\n      width: 80px;\n      height: 22px;\n      line-height: 22px;\n      border-radius: 100px;\n      background-color: rgba(182, 47, 38, 100);\n      color: rgba(255, 255, 255, 100);\n      font-size: 12px;\n      font-weight: 350;\n      text-align: center;\n      margin-left: auto;\n      cursor: pointer;\n      transition: all 0.3s;\n      &:hover {\n        background-color: mix(white, #b62f26, 20%);\n      }\n    }\n  }\n}\n</style>\n","import mod from \"-!../../../../node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/_thread-loader@2.1.3@thread-loader/dist/cjs.js!../../../../node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js!../../../../node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/_vue-loader@15.9.4@vue-loader/lib/index.js??vue-loader-options!./masaike_index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/_thread-loader@2.1.3@thread-loader/dist/cjs.js!../../../../node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js!../../../../node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/_vue-loader@15.9.4@vue-loader/lib/index.js??vue-loader-options!./masaike_index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./masaike_index.vue?vue&type=template&id=e424d87e&scoped=true&\"\nimport script from \"./masaike_index.vue?vue&type=script&lang=js&\"\nexport * from \"./masaike_index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./masaike_index.vue?vue&type=style&index=0&id=e424d87e&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/_vue-loader@15.9.4@vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"e424d87e\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../../node_modules/_mini-css-extract-plugin@0.9.0@mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/_css-loader@3.6.0@css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/_vue-loader@15.9.4@vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/_postcss-loader@3.0.0@postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/_sass-loader@8.0.2@sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/_vue-loader@15.9.4@vue-loader/lib/index.js??vue-loader-options!./masaike_index.vue?vue&type=style&index=0&id=e424d87e&scoped=true&lang=scss&\""],"sourceRoot":""}