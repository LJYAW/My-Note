(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-20cd4e96","chunk-8a251c4c"],{2:function(e,t){},3:function(e,t){},4:function(e,t){},4787:function(e,t,r){},5:function(e,t){},6:function(e,t){},7:function(e,t){},a885:function(e,t,r){"use strict";r("4787")},cf3c:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("base-dialog",{staticClass:"new-fragment-model",attrs:{show:e.show,title:"新增片段",width:"600px","close-on-click-modal":!1},on:{close:e.close}},[r("el-form",{ref:"ruleForm",attrs:{inline:!0,rules:e.rules,model:e.form,"label-width":"110px","label-position":"left"}},[r("el-form-item",{attrs:{label:"频道:",prop:"channel_id"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择频道",clearable:""},on:{change:e.changeChannelId},model:{value:e.form.channel_id,callback:function(t){e.$set(e.form,"channel_id",t)},expression:"form.channel_id"}},e._l(e.channelData,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),r("el-form-item",{attrs:{label:"类型:"}},[r("el-radio-group",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[r("el-radio",{attrs:{label:"广告"}},[e._v("广告")]),r("el-radio",{attrs:{label:"正片"}},[e._v("正片")])],1)],1),"正片"===e.form.type?r("div",[r("el-form-item",{staticClass:"title-item",attrs:{label:"标题名称:",prop:"title"}},[r("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchAsync,placeholder:"请输入标题名称",type:"textarea"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),r("el-form-item",{attrs:{label:"栏目名称:"}},[r("el-select",{ref:"searchData",attrs:{placeholder:"请选择栏目名称",clearable:"",filterable:""},on:{change:e.changeItemId},nativeOn:{input:function(t){return e.filterData(t)}},model:{value:e.form.item_id,callback:function(t){e.$set(e.form,"item_id",t)},expression:"form.item_id"}},e._l(e.itemList,(function(e){return r("el-option",{key:e.item_id,attrs:{label:e.name,value:e.item_id}})})),1)],1),r("el-form-item",{attrs:{label:"客户定制分类:"}},[r("el-select",{attrs:{placeholder:"一级分类",clearable:"",filterable:""},model:{value:e.form.firstCategory,callback:function(t){e.$set(e.form,"firstCategory",t)},expression:"form.firstCategory"}},e._l(e.firstCustomCategory,(function(e){return r("el-option",{key:e.category_id,attrs:{label:e.category_name,value:e.category_id}})})),1),r("el-select",{attrs:{placeholder:"二级分类",clearable:"",filterable:""},model:{value:e.form.secondCategory,callback:function(t){e.$set(e.form,"secondCategory",t)},expression:"form.secondCategory"}},e._l(e.secondCustomCategory,(function(e){return r("el-option",{key:e.category_id,attrs:{label:e.category_name,value:e.category_id}})})),1)],1)],1):e._e(),r("el-form-item",{staticClass:"formTime",attrs:{prop:"start_date",label:"开始时间:"}},[r("el-date-picker",{attrs:{type:"date",placeholder:"选择开始日期","value-format":"yyyy-MM-dd","picker-options":e.pickerOptions},model:{value:e.form.start_date,callback:function(t){e.$set(e.form,"start_date",t)},expression:"form.start_date"}}),e._l(e.timeArray,(function(t){return r("el-autocomplete",{key:t,staticClass:"inline-input time-input",attrs:{type:"number","fetch-suggestions":function(r,n){return e.querySearch(t,r,n)}},model:{value:e.form["start"+t],callback:function(r){e.$set(e.form,"start"+t,"string"===typeof r?r.trim():r)},expression:"form['start'+item]"}})}))],2),r("el-form-item",{staticClass:"formTime",attrs:{prop:"end_date",label:"结束时间:"}},[r("el-date-picker",{attrs:{type:"date",placeholder:"选择结束日期","value-format":"yyyy-MM-dd","picker-options":e.pickerOptions},model:{value:e.form.end_date,callback:function(t){e.$set(e.form,"end_date",t)},expression:"form.end_date"}}),e._l(e.timeArray,(function(t){return r("el-autocomplete",{key:t,staticClass:"inline-input time-input",attrs:{type:"number","fetch-suggestions":function(r,n){return e.querySearch(t,r,n)}},model:{value:e.form["end"+t],callback:function(r){e.$set(e.form,"end"+t,"string"===typeof r?r.trim():r)},expression:"form['end'+item]"}})}))],2)],1),r("div",{staticClass:"dialog-footer"},[r("base-btn",{staticClass:"submit-btn",on:{click:function(t){return e.submit("ruleForm")}}},[e._v("提交")]),r("base-btn",{attrs:{type:"info"},on:{click:e.cancel}},[e._v("取消")])],1)],1)},a=[],i=r("99a5"),s=r("1c03"),o=(r("6a61"),r("513c"),r("08ba"),r("e18c"),r("fe8a"),r("dbb3"),r("52c1")),c=(r("e70a"),{components:{},props:{show:{type:Boolean,default:function(){return!1}},channelId:{type:Number,default:function(){return 0}}},data:function(){return{itemList:[],firstCustomCategory:[],secondCustomCategory:[],form:{channel_id:null,title:"",type:"广告",start_date:null,end_date:null,startHour:"",startMinute:"",startSecond:"",startMs:"",endHour:"",endMinute:"",endSecond:"",endMs:"",item_id:null,firstCategory:"",secondCategory:""},start_time:null,end_time:null,rules:{channel_id:[{required:!0,message:"请选择频道",trigger:"change"}],title:[{required:!0,message:"请输入标题名称",trigger:"blur"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}]},timeArray:["Hour","Minute","Second","Ms"],pickerOptions:{disabledDate:function(e){var t=new Date;return e.getTime()>new Date(t).getTime()}}}},computed:Object(s["a"])({},Object(o["b"])(["channelData"])),watch:{},created:function(){this.form.channel_id=this.channelId||null,this.getItemList(),this.getCustomCategory()},mounted:function(){},methods:{querySearchAsync:function(e,t){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,r.getTitleList(e);case 2:a=n.sent,i=[],a.forEach((function(e){i.push({id:e.id,value:e.title})})),t(i);case 6:case"end":return n.stop()}}),n)})))()},getTitleList:function(e){var t=this,r={channel_id:this.form.channel_id,keyword:e};return new Promise((function(e,n){t.$get("/epg-ad/epg-ad-search",r).then((function(t){e(t.data.list)})).catch((function(e){n(e),t.$message(e.msg)}))}))},close:function(){this.$emit("close")},getItemList:function(e){var t=this,r={channel_id:this.form.channel_id||null,keyword:e||""};this.$get("/production/itemList",r).then((function(e){t.itemList=e.data})).catch((function(e){t.$message.error(e.msg)}))},getCustomCategory:function(){var e=this;this.$get("/epg-task/customer-category-list").then((function(t){e.firstCustomCategory=t.data.first_category,e.secondCustomCategory=t.data.second_category})).catch((function(t){e.$message.error(t.msg)}))},changeChannelId:function(e){this.getItemList(),this.form.item_id=null},checkTime:function(){for(var e=0;e<this.timeArray.length;e++){if(!String(this.form["start"+this.timeArray[e]]))return this.$message("请输入开始时间"),!1;if(!String(this.form["end"+this.timeArray[e]]))return this.$message("请输入结束时间"),!1}var t=this.form,r=t.start_date,n=t.startHour,a=t.startMinute,i=t.startSecond,s=t.startMs,o=this.form,c=o.end_date,l=o.endHour,u=o.endMinute,m=o.endSecond,f=o.endMs;this.startTime=r+" "+n+":"+a+":"+i+"."+s,this.endTime=c+" "+l+":"+u+":"+m+"."+f;var d=new Date(this.startTime).getTime(),h=new Date(this.endTime).getTime();return!(h<d)||(this.$message("开始时间不能大于结束时间"),!1)},submit:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;t.checkTime()&&t.saveData()}))},saveData:function(){var e=this,t={seq:{channel_id:this.form.channel_id,item_id:this.form.item_id,day:this.form.end_date,title:this.form.title||"广告",type:this.form.type,start_time:new Date(this.startTime).getTime(),end_time:new Date(this.endTime).getTime(),first_customer_category_ids:this.form.firstCategory?[this.form.firstCategory]:[],second_customer_category_ids:this.form.secondCategory?[this.form.secondCategory]:[]}};this.$post("/epg/new-add",t).then((function(t){e.$emit("submit"),e.cancel()})).catch((function(t){e.$message(t.msg)}))},resetForm:function(){var e=this;Object.keys(this.form).forEach((function(t){e.form[t]=null})),this.form.type="广告"},cancel:function(){this.close(),this.resetForm()},filterData:window.lodash.debounce((function(){var e=this.$refs.searchData.$data.selectedLabel;this.getItemList(e)}),1e3),setCustomCate:function(e,t){this.form[t+"Category"]=e.length?e[0].id:""},changeItemId:function(e){var t=this.itemList.filter((function(t){return t.item_id===e}));this.setCustomCate(t[0].first_customer_categories,"first"),this.setCustomCate(t[0].second_customer_categories,"second")},querySearch:function(e,t,r){for(var n=this.getNum(e),a=[],i=0;i<n;i++)a.push({value:String(i)});var s=t?a.filter((function(e){return-1!==String(e.value).indexOf(t)})):a;r(s)},getNum:function(e){var t=0;switch(e){case"Hour":t=24;break;case"Minute":t=60;break;case"Second":t=60;break;case"Ms":t=1e3;break}return t}}}),l=c,u=(r("a885"),r("4ac2")),m=Object(u["a"])(l,n,a,!1,null,null,null);t["default"]=m.exports},e70a:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",e._l(e.numPages,(function(t){return r("pdf",{key:t,attrs:{src:e.pdfUrl,page:t},on:{"num-pages":function(t){e.pageCount=t}}})})),1)},a=[],i=r("99a5"),s=(r("6a61"),r("053b"),r("b4dc")),o={components:{pdf:s["a"]},props:{},data:function(){return{currentPage:0,pageCount:0,numPages:0,pdfUrl:""}},computed:{pdfName:function(){return this.$route.query.name||"lanmu"}},watch:{},created:function(){},mounted:function(){this.loadPdfHandler()},methods:{loadPdfHandler:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r="/static/pdf/".concat(e.pdfName,".pdf"),e.pdfUrl=s["a"].createLoadingTask(r),e.pdfUrl.promise&&e.pdfUrl.promise.then((function(t){e.numPages=t.numPages}));case 3:case"end":return t.stop()}}),t)})))()}}},c=o,l=r("4ac2"),u=Object(l["a"])(c,n,a,!1,null,"72894052",null);t["default"]=u.exports}}]);