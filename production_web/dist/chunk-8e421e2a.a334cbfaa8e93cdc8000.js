(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8e421e2a"],{1177:function(t,e,a){"use strict";a("43dc")},"43dc":function(t,e,a){},9352:function(t,e,a){"use strict";a("a206")},a206:function(t,e,a){},fbe3:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"nums-list"},t._l(t.numData,(function(e,s){return a("div",{key:s,staticClass:"item-nums"},[a("span",[t._v(t._s(e.label)+":")]),a("div",[t._v(t._s(e.value))])])})),0)},n=[],i={name:"NumsList",components:{},props:{numData:{type:Array,default:function(){return[]}}},computed:{},watch:{},mounted:function(){},created:function(){},methods:{}},l=i,o=(a("9352"),a("4ac2")),r=Object(o["a"])(l,s,n,!1,null,"95421840",null);e["a"]=r.exports},fd20:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"task-met"},[a("div",{staticClass:"numBox"},[a("numsList",{attrs:{"num-data":t.numData}})],1),a("div",{staticClass:"search-top"},[a("div",[a("div",{staticClass:"search-list"},[a("div",{staticClass:"item-serach"},[a("span",{staticClass:"item-label"},[t._v("频道:")]),a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",clearable:"",placeholder:"请选择频道"},model:{value:t.form.channel_id,callback:function(e){t.$set(t.form,"channel_id",e)},expression:"form.channel_id"}},t._l(t.channelData,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),a("div",{staticClass:"item-serach"},[a("span",{staticClass:"item-label"},[t._v("状态:")]),a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",clearable:"",placeholder:"请选择状态"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},t._l(t.status_options,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t.isShow()?a("div",{staticClass:"item-serach"},[a("span",{staticClass:"item-label"},[t._v("执行团队:")]),a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",clearable:"",placeholder:"请选择执行团队"},model:{value:t.form.team,callback:function(e){t.$set(t.form,"team",e)},expression:"form.team"}},t._l(t.teamData,(function(t){return a("el-option",{key:t.id,attrs:{label:t.department_name,value:t.id}})})),1)],1):t._e(),t.isShow()?a("div",{staticClass:"item-serach"},[a("span",{staticClass:"item-label"},[t._v("执行人:")]),a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",clearable:"",placeholder:"请选择状态"},model:{value:t.form.executor_id,callback:function(e){t.$set(t.form,"executor_id",e)},expression:"form.executor_id"}},t._l(t.userData(),(function(t){return a("el-option",{key:t.id,attrs:{label:t.nickname,value:t.id}})})),1)],1):t._e(),a("div",{staticClass:"date-search"},[a("span",{staticClass:"item-label"},[t._v("任务日期:")]),a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1),a("div",{staticClass:"item-serach checked"},[a("el-checkbox",{staticClass:"is_unassigned",model:{value:t.form.is_unassigned,callback:function(e){t.$set(t.form,"is_unassigned",e)},expression:"form.is_unassigned"}},[t._v("未派发任务")]),a("base-btn",{attrs:{size:"small"},on:{click:function(e){return t.search()}}},[t._v("搜索")]),a("base-btn",{attrs:{size:"small"},on:{click:function(e){return t.exportData()}}},[t._v("导出")])],1)]),a("p",{staticClass:"count"},[t._v("当前条件下共"+t._s(t.total)+"条数据")])])]),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],staticClass:"table-list",attrs:{data:t.tableData,border:""},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{prop:"channel_name",label:"频道",width:"150"}}),a("el-table-column",{attrs:{prop:"date",label:"任务日期",width:"120"}}),a("el-table-column",{attrs:{prop:"start_time",label:"任务时间",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.start_time))]),a("span",[t._v("-")]),a("span",[t._v(t._s(e.row.end_time))])]}}])}),a("el-table-column",{attrs:{prop:"status",label:"任务状态"},scopedSlots:t._u([{key:"default",fn:function(e){return["挂起中"==e.row.status?a("div",[a("span",[t._v(t._s(e.row.status))]),a("el-tooltip",{staticClass:"item tooltip-item",attrs:{effect:"light",placement:"top"}},[a("a",{staticClass:"el-icon-warning warning-icon"}),a("div",{attrs:{slot:"content"},slot:"content"},t._l(JSON.parse(e.row.hang_up_reason),(function(e,s){return a("div",{key:s},[a("div",[t._v(t._s(s+1)+". "+t._s(e.name))]),a("div",[t._v(t._s(e.desc))])])})),0)])],1):a("span",[t._v(t._s(e.row.status))])]}}])}),a("el-table-column",{attrs:{prop:"num",label:"片段数"}}),a("el-table-column",{attrs:{prop:"department_name",label:"团队",width:"180"}}),a("el-table-column",{attrs:{prop:"executor_name",label:"执行人"}}),a("el-table-column",{attrs:{prop:"updated_at",label:"更新时间",width:"200px"}}),a("el-table-column",{attrs:{prop:"",label:"操作",width:"260px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("base-btn",{attrs:{type:"text"},nativeOn:{click:function(a){return t.details(e)}}},[t._v("查看详情")]),"已完成"!==e.row.status&&t.$store.state.user.userInfo.is_superman?a("span",["挂起中"==e.row.status||"已关闭"==e.row.status?a("base-btn",{attrs:{type:"text"},on:{click:function(a){return t.startTask(e)}}},[t._v("开启任务")]):a("base-btn",{staticClass:"end-task",attrs:{type:"text"},on:{click:function(a){return t.resetTask(e)}}},[t._v("关闭任务")])],1):t._e()]}}])})],1)],1),a("div",{staticClass:"pagination-list"},[a("base-pag",{attrs:{total:t.total,limit:t.limit,page:t.page},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1)])},n=[],i=a("1c03"),l=(a("b130"),a("90aa"),a("dbb3"),a("e18c"),a("96db"),a("af86"),a("f1a9"),a("08ba"),a("52c1")),o=a("fbe3"),r=a("28de"),c={components:{numsList:o["a"]},data:function(){return{form:{channel_id:null,status:null,team:null,executor_id:null,is_unassigned:!1},numData:[],status_options:[{label:"挂起中",value:"挂起中"},{label:"已完成",value:"已完成"},{label:"进行中",value:"进行中"},{label:"待分配",value:"待分配"},{label:"等待中",value:"等待中"},{label:"已关闭",value:"已关闭"}],tableData:[],limit:10,total:null,page:1,list:[{key:"hang_up_num",value:"挂起任务数"},{key:"incomplete_num",value:"未完成任务数"},{key:"on_going_num",value:"进行中任务数"},{key:"today_complete_num",value:"今天已完成任务"}],userList:[],date:[],tableLoading:!1}},computed:Object(i["a"])({},Object(l["b"])(["channelData","teamData","roles"])),watch:{"form.team":function(t){this.form.executor_id=null}},created:function(){this.$store.dispatch("channel/getChannelData"),this.$store.dispatch("user/getTeamData",{page:1,limit:1e4}),this.getTjNum(),this.getList(),this.getUser()},mounted:function(){},methods:{isShow:function(){return this.roles.includes("superman")||this.roles.includes("广告审核")||this.roles.includes("广告审核管理员")},getUser:function(){var t=this;this.$get("/user/userList",{page:1,limit:1e4}).then((function(e){t.userList=e.data.list}))},userData:function(t){var e=this;return this.form.team?this.userList.filter((function(t){return t.department_id===e.form.team})):[]},details:function(t){this.$router.push({path:"/advertisement/detail-system",query:{status:"detail",tid:t.row.id}})},handleSelectionChange:function(t){},search:function(){this.page=1,this.getList()},getList:function(){var t=this;this.tableLoading=!0;var e={channel_id:this.form.channel_id||null,status:this.form.status||null,department_id:this.form.team||null,is_unassigned:this.form.is_unassigned,executor_id:this.form.executor_id,start_date:this.date?this.date[0]:"",end_date:this.date?this.date[1]:"",page:this.page,limit:this.limit};this.$get("/ads-task/detail-list",e).then((function(e){t.tableData=e.data.list,t.total=e.data.total,t.tableLoading=!1})).catch((function(e){t.$message.error(e.msg)}))},exportData:function(){var t=this;Object(r["a"])({method:"get",url:"/ads-task/detail-list",headers:{token:this.token},params:{channel_id:this.form.channel_id||null,status:this.form.status||null,department_id:this.form.team||null,is_unassigned:this.form.is_unassigned,executor_id:this.form.executor_id,start_date:this.date?this.date[0]:"",end_date:this.date?this.date[1]:"",page:1,is_export:!0,limit:1e4},responseType:"blob"}).then((function(e){if(e.data.type){var a=new Blob([e.data],{type:"application/vnd.ms-excel"}),s=document.createElement("a");s.href=URL.createObjectURL(a),s.setAttribute("download","广告任务详情表.xlsx"),s.click(),s=null,t.$message.success("导出成功")}else t.$message.warning(e.data.msg)})).catch((function(t){console.log(t)}))},upsStatus:function(t,e){var a=this,s={id:t,status:e};this.$post("/epg-task/up-status",s).then((function(t){a.$message({showClose:!0,message:1===e?"开启任务成功":"关闭任务成功",type:"success"}),a.getList()})).catch((function(t){a.$message({showClose:!0,message:1===e?"开启任务失败":"关闭任务失败",type:"error"})}))},startTask:window.lodash.throttle((function(t){this.upsStatus(t.row.id,1)}),2e3),resetTask:window.lodash.throttle((function(t){this.upsStatus(t.row.id,-1)}),2e3),handleCurrentChange:function(t){this.page=t,this.getList()},handleSizeChange:function(t){this.limit=t,this.getList()},getTjNum:function(){var t=this;this.$get("/ads-task/administer-tj").then((function(e){t.list.forEach((function(a,s){t.numData.push({label:a.value,value:e.data[a.key]})}))})).catch((function(e){t.$message.error(e.msg)}))}}},u=c,d=(a("1177"),a("4ac2")),m=Object(d["a"])(u,s,n,!1,null,"ccd0146a",null);e["default"]=m.exports}}]);