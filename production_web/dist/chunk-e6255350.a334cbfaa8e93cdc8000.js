(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e6255350"],{"204c":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"task-met"},[a("div",{staticClass:"search-top"},[a("div",[a("div",{staticClass:"search-list"},[a("div",{staticClass:"item-serach"},[a("span",{staticClass:"item-label"},[t._v("全频道:")]),a("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择频道"},model:{value:t.form.channel_id,callback:function(e){t.$set(t.form,"channel_id",e)},expression:"form.channel_id"}},t._l(t.channelData,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),a("div",{staticClass:"item-serach"},[a("span",{staticClass:"item-label"},[t._v("栏目:")]),a("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择栏目","filter-method":t.dataFilter},on:{clear:t.clearData,blur:t.blur},model:{value:t.form.item_id,callback:function(e){t.$set(t.form,"item_id",e)},expression:"form.item_id"}},t._l(t.itemData,(function(t){return a("el-option",{key:t.item_id,attrs:{label:t.name,value:t.item_id}})})),1)],1),a("div",{staticClass:"item-serach"},[a("span",{staticClass:"item-label"},[t._v("状态:")]),a("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择状态"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},t._l(t.status_options,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("div",{staticClass:"item-serach"},[a("span",{staticClass:"item-label"},[t._v("任务显示:")]),a("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择状态"},model:{value:t.form.assign_status,callback:function(e){t.$set(t.form,"assign_status",e)},expression:"form.assign_status"}},t._l(t.task_options,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("div",{staticClass:"item-serach"},[a("span",{staticClass:"item-label"},[t._v("团队:")]),a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",clearable:"",placeholder:"请选择执行团队"},on:{clear:t.clearDepartment},model:{value:t.form.department_id,callback:function(e){t.$set(t.form,"department_id",e)},expression:"form.department_id"}},t._l(t.teamData,(function(t){return a("el-option",{key:t.id,attrs:{label:t.department_name,value:t.id}})})),1)],1),a("div",{staticClass:"item-serach"},[a("span",{staticClass:"item-label"},[t._v("执行人:")]),a("el-select",{attrs:{placeholder:"请选择执行人",clearable:"",filterable:""},model:{value:t.form.executor_id,callback:function(e){t.$set(t.form,"executor_id",e)},expression:"form.executor_id"}},t._l(t.person_options,(function(t){return a("el-option",{key:t.id,attrs:{label:t.nickname,value:t.id}})})),1)],1),a("div",{staticClass:"item-serach"},[a("span",{staticClass:"item-label"},[t._v("播出日期:")]),a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:t.form.daterange,callback:function(e){t.$set(t.form,"daterange",e)},expression:"form.daterange"}})],1),a("div",{staticClass:"item-serach"},[a("span",{staticClass:"item-label"},[t._v("加工方式:")]),a("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择加工方式"},model:{value:t.form.processing_require,callback:function(e){t.$set(t.form,"processing_require",e)},expression:"form.processing_require"}},t._l(t.processingOption,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("div",{staticClass:"item-serach"},[a("span",{staticClass:"item-label"},[t._v("更新时间:")]),a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:t.form.updateDate,callback:function(e){t.$set(t.form,"updateDate",e)},expression:"form.updateDate"}})],1),a("div",{staticClass:"item-serach btns"},[a("base-btn",{attrs:{size:"big"},on:{click:function(e){return t.search()}}},[t._v("搜索")]),a("base-btn",{attrs:{size:"big",disabled:t.task_ids.length<=0},on:{click:function(e){return t.assign()}}},[t._v("批量指派任务")]),a("base-btn",{attrs:{size:"big"},on:{click:t.exportData}},[t._v("导出")])],1)])])]),a("div",{staticStyle:{"margin-top":"36px"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticClass:"table-list",attrs:{data:t.tempTableData,border:""},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{prop:"",label:"",type:"selection"}}),a("el-table-column",{attrs:{prop:"task_id",label:"TID"}}),a("el-table-column",{attrs:{prop:"channel_name",label:"频道"}}),a("el-table-column",{attrs:{prop:"item_name",label:"栏目",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"hang_up_reason"},[a("span",[t._v(t._s(e.row.item_name))]),"挂起中"===e.row.status&&e.row.hang_up_reason?a("div",{staticStyle:{"margin-left":"10px"}},[a("div",[a("el-tooltip",{staticClass:"item",attrs:{effect:"light",placement:"top"}},[a("a",{staticClass:"el-icon-warning warning-icon"}),a("div",{attrs:{slot:"content"},slot:"content"},t._l(e.row.hang_up_reason,(function(e,s){return a("div",{key:s},[a("div",[t._v(t._s(s+1)+". "+t._s(e.name))]),a("div",[t._v(t._s(e.desc))])])})),0)])],1)]):t._e()])]}}])}),a("el-table-column",{attrs:{prop:"status",label:"任务状态"}}),a("el-table-column",{attrs:{prop:"processing_require",label:"加工方式"}}),a("el-table-column",{attrs:{prop:"date",label:"播出日期",width:"110px"}}),a("el-table-column",{attrs:{prop:"start_time",label:"播出时间",width:"160px"},scopedSlots:t._u([{key:"default",fn:function(e){return["待分配"!==e.row.status&&"等待中"!==e.row.status||!t.roles.some((function(t){return"superman"===t}))?a("div",[a("span",[t._v(t._s(e.row.start_time))]),a("span",[t._v("-")]),a("span",[t._v(t._s(e.row.end_time))])]):a("el-popover",{key:e.row.task_id,ref:"popover",attrs:{trigger:"click",placement:"top"},model:{value:e.row.visible,callback:function(a){t.$set(e.row,"visible",a)},expression:"scope.row.visible"}},[a("div",[a("el-time-picker",{staticStyle:{width:"120px"},attrs:{"value-format":"HH:mm:ss",placeholder:"开始时间"},model:{value:e.row.start_time_play,callback:function(a){t.$set(e.row,"start_time_play",a)},expression:"scope.row.start_time_play"}}),a("span",{staticStyle:{"margin-left":"10px","margin-right":"10px"}},[t._v("至")]),a("el-time-picker",{staticStyle:{width:"120px"},attrs:{"value-format":"HH:mm:ss",placeholder:"结束时间"},model:{value:e.row.end_time_play,callback:function(a){t.$set(e.row,"end_time_play",a)},expression:"scope.row.end_time_play"}})],1),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.row.visible=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return t.editTime(e.row)}}},[t._v("确定")])],1),a("div",{staticClass:"text customers-hover",attrs:{slot:"reference"},slot:"reference"},[a("span",[t._v(t._s(e.row.start_time))]),a("span",[t._v("-")]),a("span",[t._v(t._s(e.row.end_time))]),a("i",{staticClass:"el-icon-edit"})])])]}}])}),a("el-table-column",{attrs:{prop:"complete",label:"完成数"}}),a("el-table-column",{attrs:{prop:"transcode_fail_num",label:"转码失败数"}}),a("el-table-column",{attrs:{prop:"push_customer_wait_num",label:"待推送数"}}),a("el-table-column",{attrs:{prop:"push_customer_fail_num",label:"推送失败数"}}),a("el-table-column",{attrs:{prop:"department",label:"团队"}}),a("el-table-column",{attrs:{prop:"executor",label:"执行人"}}),a("el-table-column",{attrs:{prop:"updated_at",label:"更新时间"}}),a("el-table-column",{attrs:{prop:"",label:"操作",width:"280px"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.is_assign?a("a",{staticClass:"start-task",on:{click:function(a){return t.reset(e)}}},[t._v("释放任务")]):a("a",{staticClass:"start-task",on:{click:function(a){return t.singleAssgin(e)}}},[t._v("指派")]),a("base-open-qt",{staticClass:"start-task",attrs:{"task-id":e.row.task_id,"btn-name":"查看详情"}}),a("a",{staticClass:"start-task",on:{click:function(a){return t.see(e)}}},[t._v("查看成品")]),"挂起中"==e.row.status?a("a",{staticClass:"start-task",on:{click:function(a){return t.hangUp(e)}}},[t._v("释放挂起")]):t._e(),a("a",{staticClass:"end-task",on:{click:function(a){return t.deletes(e)}}},[t._v("删除")])]}}])})],1)],1),a("div",{staticClass:"pagination-list"},[a("base-pag",{attrs:{total:t.total,limit:t.limit,page:t.page},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1),a("assignTask",{ref:"assignTask",attrs:{"task-arr":t.task_ids},on:{clearSelection:t.clearSelection}})],1)},i=[],n=a("99a5"),r=a("1c03"),l=(a("6a61"),a("08ba"),a("e18c"),a("96db"),a("af86"),a("f1a9"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("base-dialog",{attrs:{show:t.show,title:t.dialogsObj.title,width:t.dialogsObj.width,center:t.dialogsObj.center},on:{close:t.close}},[a("div",[a("div",{staticClass:"assign-task"},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"120px"}},[t.roles.some((function(t){return"superman"===t}))?a("el-form-item",{attrs:{label:"请选择工作组",prop:"department_id"}},[a("el-select",{attrs:{placeholder:"请选择工作组"},model:{value:t.ruleForm.department_id,callback:function(e){t.$set(t.ruleForm,"department_id",e)},expression:"ruleForm.department_id"}},t._l(t.tempteamData,(function(t){return a("el-option",{key:t.id,attrs:{label:t.department_name,value:t.id}})})),1)],1):t._e(),a("el-form-item",{attrs:{label:"请选择执行人",prop:"executor_id"}},[a("el-select",{attrs:{placeholder:"请选择执行人"},model:{value:t.ruleForm.executor_id,callback:function(e){t.$set(t.ruleForm,"executor_id",e)},expression:"ruleForm.executor_id"}},t._l(t.person_options,(function(t){return a("el-option",{key:t.id,attrs:{label:t.nickname,value:t.id}})})),1)],1),a("el-form-item",{staticClass:"btns"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm("ruleForm")}}},[t._v("保存")])],1)],1)],1)])])}),o=[],c=a("52c1"),u={name:"AssignTask",components:{},props:{taskArr:{type:Array,default:function(){return[]}}},data:function(){return{show:!1,person_options:[],tempteamData:[],dialogsObj:{width:"400px",title:"指派执行人",center:!0},ruleForm:{executor_id:"",department_id:""}}},computed:Object(r["a"])(Object(r["a"])({},Object(c["b"])(["teamData","roles","userInfo"])),{},{tempTaskArr:function(){var t=[];return this.taskArr.forEach((function(e){t.push(e.task_id)})),t},rules:function(){return{executor_id:[{required:!this.roles.some((function(t){return"superman"===t})),message:"请选择执行人",trigger:"change"}],department_id:[{required:!0,message:"请选择工作组",trigger:"change"}]}}}),watch:{"ruleForm.department_id":function(t){t&&(this.getUserList(),this.ruleForm.executor_id="")},teamData:function(t){0!==t.length&&(this.roles.some((function(t){return"superman"===t}))?this.tempteamData=JSON.parse(JSON.stringify(t)):(this.tempteamData=[],this.ruleForm.department_id=this.userInfo.department_id))}},created:function(){},mounted:function(){},methods:{getUserList:function(){var t=this,e={department_id:this.ruleForm.department_id,keyword:""};this.$get("/user/team-user-list",e).then((function(e){var a=e.data;t.person_options=a})).catch((function(t){console.log(t)}))},open:function(){this.show=!0},close:function(){this.show=!1,this.ruleForm.department_id="",this.ruleForm.executor_id="",this.$emit("clearSelection")},submitForm:function(t){var e=this,a={executor_id:this.ruleForm.executor_id,department_id:this.ruleForm.department_id,task_ids:this.tempTaskArr};this.$refs[t].validate((function(t){if(!t)return!1;e.$post("/production/assign-task",a).then((function(t){e.$message({showClose:!0,message:"指派成功",type:"success"}),e.close(),e.$parent.getList()})).catch((function(t){e.$message({showClose:!0,message:"指派失败",type:"error"})}))}))}}},d=u,m=(a("bdf9"),a("4ac2")),p=Object(m["a"])(d,l,o,!1,null,"8961aa78",null),f=p.exports,_=a("28de"),h={components:{assignTask:f},data:function(){return{keywords:"",form:{channel_id:null,item_id:null,status:null,task:null,assign_status:null,daterange:"",department_id:null,executor_id:null,updateDate:["",""],processing_require:null},loading:!1,total:null,page:1,limit:10,task_ids:[],processingOption:[{label:"新闻整档",value:"新闻整档"},{label:"节目整档",value:"节目整档"}],person_options:[],task_options:[{label:"仅显示派发任务",value:"派发任务"},{label:"仅显示公共任务",value:"公共任务"}],column_options:[],status_options:[{label:"待分配",value:"待分配"},{label:"等待中",value:"等待中"},{label:"进行中",value:"进行中"},{label:"挂起中",value:"挂起中"},{label:"已完成",value:"已完成"}],channel_all:[],tableData:[]}},computed:Object(r["a"])(Object(r["a"])({},Object(c["b"])(["channelData","itemData","teamData","roles"])),{},{tempTableData:function(){var t=JSON.parse(JSON.stringify(this.tableData));return 0!==t.length&&t.forEach((function(t,e){t.start_time_play=t.start_time,t.end_time_play=t.end_time,t.visible=!1})),t}}),watch:{"form.channel_id":function(t){this.getItemList(),this.form.item_id=""},"form.department_id":function(t){t&&(this.geTexecutor(),this.form.executor_id="")}},created:function(){this.channelData.length||this.$store.dispatch("channel/getChannelData"),this.$store.dispatch("user/getTeamData",{page:1,limit:1e4}),this.getItemList(),this.getList()},mounted:function(){},methods:{editTime:function(t){var e=this,a={task_id:t.task_id,start_time:t.start_time_play,end_time:t.end_time_play};this.$post("/production/change-task-time",a).then((function(t){e.$message({type:"success",message:"修改成功"}),e.getList()})).catch((function(t){e.$message.error(t.msg)}))},clearDepartment:function(){this.person_options=[],this.form.executor_id=null},geTexecutor:function(){var t=this,e={department_id:this.form.department_id,keyword:""};this.$get("/user/team-user-list",e).then((function(e){var a=e.data;t.person_options=a})).catch((function(t){console.log(t)}))},blur:function(){0===this.itemData.length&&(this.keywords="",this.getItemList())},clearData:function(){this.keywords="",this.getItemList()},getItemList:function(){this.$store.dispatch("channel/getItemList",{channel_id:this.form.channel_id,keyword:this.keywords})},dataFilter:function(t){this.keywords=t,this.getItemList()},see:function(t){this.$router.push({path:"/split-tasks/video-list",query:{task_id:t.row.task_id}})},singleAssgin:function(t){this.$refs.multipleTable.toggleRowSelection(t.row),this.$refs.assignTask.open()},clearSelection:function(){this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(t){this.task_ids=t},search:function(){this.page=1,this.getList()},getList:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a,s,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,a={channel_id:t.form.channel_id||null,item_id:t.form.item_id||null,status:t.form.status||null,page:t.page,limit:t.limit,assign_status:t.form.assign_status||null,start_date:null===t.form.daterange?"":t.form.daterange[0],end_date:null===t.form.daterange?"":t.form.daterange[1],department_id:t.form.department_id,executor_id:t.form.executor_id,update_start_date:null===t.form.updateDate?"":t.form.updateDate[0],update_end_date:null===t.form.updateDate?"":t.form.updateDate[1],processing_require:t.form.processing_require||null},s="/production/splitTaskControl",e.next=5,t.$get(s,a);case 5:i=e.sent,n=i.data,n&&(t.loading=!1),t.tableData=n.list,t.total=n.total;case 10:case"end":return e.stop()}}),e)})))()},exportData:function(){var t=this;this.form.daterange?Object(_["a"])({method:"get",url:"/production/splitTaskControlExport",headers:{token:this.token},params:{channel_id:this.form.channel_id||null,item_id:this.form.item_id||null,status:this.form.status||null,assign_status:this.form.assign_status||null,start_date:null===this.form.daterange?"":this.form.daterange[0],end_date:null===this.form.daterange?"":this.form.daterange[1],department_id:this.form.department_id,executor_id:this.form.executor_id,update_start_date:null===this.form.updateDate?"":this.form.updateDate[0],update_end_date:null===this.form.updateDate?"":this.form.updateDate[1],processing_require:this.form.processing_require||null},responseType:"blob"}).then((function(e){if(e.data.type){var a=new Blob([e.data],{type:"application/vnd.ms-excel"}),s=document.createElement("a");s.href=URL.createObjectURL(a),s.setAttribute("download","拆条任务列表.xlsx"),s.click(),s=null,t.$message.success("导出成功")}else t.$message.warning(e.data.msg)})).catch((function(t){console.log(t)})):this.$message({type:"warning",message:"请选择播出日期"})},assign:function(){this.$refs.assignTask.open()},handleCurrentChange:function(t){this.page=t,this.getList()},handleSizeChange:function(t){this.limit=t,this.getList()},hangUp:function(t){var e=this,a={task_id:t.row.task_id};this.$post("/production/release-hang",a).then((function(t){e.$message({showClose:!0,message:"操作成功",type:"success"}),e.getList()})).catch((function(t){e.$message({showClose:!0,message:"操作失败",type:"error"})}))},reset:function(t){var e=this,a={task_id:t.row.task_id};this.$post("/production/release-task",a).then((function(t){e.$message({showClose:!0,message:"释放成功",type:"success"}),e.getList()})).catch((function(t){e.$message({showClose:!0,message:"释放失败",type:"error"})}))},deletes:function(t){var e=this,a={task_id:t.row.task_id};this.$confirm("确定要删除此任务吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$post("/production/task-delete",a).then((function(t){e.$message({showClose:!0,message:"删除成功",type:"success"}),e.getList()})).catch((function(t){e.$message.error(t.msg)}))}))}}},g=h,b=(a("81df"),Object(m["a"])(g,s,i,!1,null,"6335bafe",null));e["default"]=b.exports},"246f":function(t,e,a){},"81df":function(t,e,a){"use strict";a("8560")},8560:function(t,e,a){},bdf9:function(t,e,a){"use strict";a("246f")}}]);