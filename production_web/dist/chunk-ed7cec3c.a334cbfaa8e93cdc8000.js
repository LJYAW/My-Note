(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ed7cec3c"],{"15b0":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("keep-alive",[a("div",{staticClass:"examine-task"},[a("div",{staticClass:"search-top"},[a("div",[a("div",{staticClass:"search-list"},[a("div",{staticClass:"item-serach"},[a("span",{staticClass:"item-label"},[t._v("频道:")]),a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择频道"},model:{value:t.form.channel_id,callback:function(e){t.$set(t.form,"channel_id",e)},expression:"form.channel_id"}},t._l(t.channelData,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),a("div",{staticClass:"item-serach"},[a("span",{staticClass:"item-label"},[t._v("播出日期:")]),a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"yyyy-MM-dd",clearable:!1},model:{value:t.form.date,callback:function(e){t.$set(t.form,"date",e)},expression:"form.date"}})],1),a("div",{staticClass:"item-serach"},[a("span",{staticClass:"item-label"},[t._v("状态:")]),a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",clearable:"",placeholder:"请选择状态"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},t._l(t.status_options,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1)]),a("div",{staticClass:"search-duration"},[a("div",{staticClass:"duration-list"},[a("div",{staticClass:"item-serach"},[a("span",[t._v("频道总时长：")]),a("div",[t._v(t._s(t.getTime(t.channel_total_duration)||0))])]),a("div",{staticClass:"item-serach"},[a("span",[t._v("正片总净时长：")]),a("div",[t._v(t._s(t.getTime(t.zp_total_duration)||0))])]),a("div",{staticClass:"item-serach"},[a("span",[t._v("广告总时长：")]),a("div",[t._v(t._s(t.getTime(t.ad_total_duration)||0))])])]),a("div",{staticClass:"checked"},[a("el-radio",{attrs:{label:1},model:{value:t.ad_show,callback:function(e){t.ad_show=e},expression:"ad_show"}},[t._v("显示全部")]),a("el-radio",{attrs:{label:2},model:{value:t.ad_show,callback:function(e){t.ad_show=e},expression:"ad_show"}},[t._v("只展示广告")]),a("el-radio",{attrs:{label:3},model:{value:t.ad_show,callback:function(e){t.ad_show=e},expression:"ad_show"}},[t._v("不展示广告")])],1),a("div",{staticClass:"btns"},[a("base-btn",{on:{click:function(e){return t.getApprovedList()}}},[t._v("查询")]),a("base-btn",{on:{click:t.showAddModel}},[t._v("新增片段")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.exportData("channel")}}},[t._v("导出品控表")]),a("base-btn",{on:{click:function(e){return t.exportData("all")}}},[t._v("导出全部EPG数据")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.batchAudit}},[t._v("批量审核通过")])],1)])])]),a("div",{staticClass:"table-list"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,"tooltip-effect":"dark",border:"border","row-class-name":t.tableRowClassName},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection","min-width":"55",selectable:t.selectEnable}}),a("el-table-column",{attrs:{prop:"type",label:"类型","min-width":"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{class:["广告"===e.row.type&&"advt-tag","正片"===e.row.type&&"advt-bg","type-tag"]},[t._v(t._s(e.row.type))])]}}])}),a("el-table-column",{attrs:{prop:"id",label:"id","min-width":"110"}}),a("el-table-column",{attrs:{prop:"source",label:"片段来源","min-width":"100"}}),a("el-table-column",{attrs:{prop:"name",label:"时间","min-width":"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[a("span",[t._v(t._s(t.getDateTime(e.row.start_time)))]),a("span",[t._v("-")]),a("span",[t._v(t._s(t.getDateTime(e.row.end_time)))])])]}}])}),a("el-table-column",{attrs:{prop:"title",label:"标题","min-width":"250"},scopedSlots:t._u([{key:"default",fn:function(e){return["正片"==e.row.type?a("span",[t._v(t._s(e.row.title))]):t._e()]}}])}),a("el-table-column",{attrs:{label:"净时长","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.getTime(e.row.duration-e.row.ad_duration).split(".")[0])+" ")]}}])}),a("el-table-column",{attrs:{prop:"ad_duration",label:"含广告时长","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return["正片"==e.row.type?a("span",[t._v(" "+t._s(t.getTime(e.row.ad_duration).split(".")[0])+" ")]):t._e()]}}])}),a("el-table-column",{attrs:{label:"一级分类","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return["正片"==e.row.type?a("span",[t._v(" "+t._s(t.getCategory(e.row,"first").join("、"))+" ")]):t._e()]}}])}),a("el-table-column",{attrs:{prop:"name",label:"二级分类","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return["正片"==e.row.type?a("span",[t._v(" "+t._s(t.getCategory(e.row,"second").join("、"))+" ")]):t._e()]}}])}),a("el-table-column",{attrs:{prop:"updated_at",label:"更新时间","min-width":"180"}}),a("el-table-column",{attrs:{prop:"taskStatus",label:"任务状态","min-width":"100"}}),a("el-table-column",{attrs:{prop:"status",label:"审核状态","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[["空白"!==e.row.type?a("div",["待审核"===e.row.status?a("el-button",{attrs:{size:"mini",type:"primary",disabled:"未完成"===e.row.taskStatus&&"审核录入"!==e.row.source},on:{click:function(a){return t.approved(e.row)}}},[t._v("审核通过")]):a("a",[t._v(t._s(e.row.status))])],1):t._e()]]}}])}),a("el-table-column",{attrs:{prop:"name",label:"操作","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[a("base-btn",{staticClass:"start-task",attrs:{type:"text",disabled:"未完成"===e.row.taskStatus&&"审核录入"!==e.row.source},on:{click:function(a){return t.update(e.row,e.$index)}}},[t._v("修改")]),a("base-btn",{staticClass:"end-task",attrs:{type:"text",disabled:"未完成"===e.row.taskStatus},on:{click:function(a){return t.deleteTask(e.row.id)}}},[t._v("删除")])],1)]}}])})],1)],1),t.modelShow?a("ExamineModel",{ref:"examineModel",attrs:{"model-data":t.tableData,"current-index":t.currentIndex},on:{submit:function(e){return t.getApprovedList()},close:t.close}}):t._e(),t.showAddDialog?a("AddModel",{attrs:{show:t.showAddDialog,"channel-id":t.form.channel_id},on:{close:t.closeAddModel,submit:function(e){return t.getApprovedList()}}}):t._e()],1)])},n=[],s=a("99a5"),r=a("1c03"),o=(a("6a61"),a("e18c"),a("96db"),a("af86"),a("dbb3"),a("053b"),a("513c"),a("3466"),a("08ba"),a("f1a9"),a("52c1")),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("base-dialog",{attrs:{show:t.show,title:t.dialogsObj.title,width:t.dialogsObj.width,center:t.dialogsObj.center},on:{close:t.close}},t._l(t.approvedData,(function(e,i){return a(e.componentName||"tableList",{key:i,ref:e.componentName||"tableList",refInFor:!0,tag:"component",attrs:{"prop-data":t.approvedData[i]},on:{close:t.close,submit:t.submit}})})),1)},c=[];a("77ad"),a("ea69");function u(t,e){var a=JSON.parse(JSON.stringify(t[e]));a.curStatus="修改中",t[e].componentName="ApprovedDetail";var i=e-2<0?0:e-2,n=e+2>t.length?t.length:e+2,s=t.slice(i,n+1),r=s.findIndex((function(t){return"ApprovedDetail"===t.componentName}));return s.splice(r,0,a),s}var d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-table",{class:["正片"===t.propData.type?"zp_bg":"ad_bg"],attrs:{data:[t.propData]}},[a("el-table-column",{attrs:{prop:"type",label:"类型",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.curStatus?a("span",[t._v("("+t._s(e.row.curStatus)+")")]):t._e(),t._v(t._s(e.row.type)+" ")]}}])}),a("el-table-column",{attrs:{prop:"type",label:"时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.getDateTime(e.row.start_time))+"-"+t._s(t.getDateTime(e.row.end_time))+" ")]}}])}),a("el-table-column",{attrs:{prop:"title",label:"标题"},scopedSlots:t._u([{key:"default",fn:function(e){return["正片"==e.row.type?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.row.title,placement:"top-start"}},[a("base-btn",{attrs:{type:"text"}},[t._v(" "+t._s(e.row.title)+" ")])],1):t._e()]}}])}),a("el-table-column",{attrs:{label:"净时长",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.getTime(e.row.duration).split(".")[0])+" ")]}}])}),a("el-table-column",{attrs:{label:"含广告时长",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return["正片"==t.propData.type?a("div",[t._v(" "+t._s(t.getTime(e.row.ad_duration).split(".")[0])+" ")]):t._e()]}}])}),a("el-table-column",{attrs:{label:"一级分类",width:"100"}},[["正片"==t.propData.type?a("div",[t._v(" "+t._s(t.getCategory(t.propData,"first").join("、"))+" ")]):t._e()]],2),a("el-table-column",{attrs:{label:"二级分类",width:"100"}},[["正片"==t.propData.type?a("div",[t._v(" "+t._s(t.getCategory(t.propData,"second").join("、"))+" ")]):t._e()]],2),a("el-table-column",{attrs:{label:"更新时间",prop:"updated_at"}})],1)},f=[],p=a("a59a"),m=a("ed08"),h={components:{},props:{propData:{type:Object,default:function(){return{}}}},data:function(){return{}},computed:{},watch:{},created:function(){},mounted:function(){},methods:{getTime:function(t){return Object(p["c"])(t)},getDateTime:function(t){return Object(m["c"])(t)},getCategory:function(t,e){var a=[],i=t[e+"_customer_categories"];return i&&i.length?(i.forEach((function(t){a.push(t.name)})),a):["无"]}}},_=h,g=(a("c9da"),a("4ac2")),v=Object(g["a"])(_,d,f,!1,null,"0a959292",null),b=v.exports,y=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content mt-10px d-flex dialog-content"},[a("div",{staticClass:"row-video"},[a("div",{staticClass:"row-video-content"},[a("div",{staticClass:"border-shadow video-wrap"},[t.status_loading?t._e():a("VideoHls",{key:t.playerOptions.src,ref:"videoPlay",staticClass:"videoPaly",attrs:{"video-offset-ms":t.videoOffsetMs,"player-options":t.playerOptions,"cross-origin":"anonymous"}}),a("p",{staticClass:"cur-time"},[t._v("视频当前时间:"),a("br"),a("span",{staticClass:"time"},[t._v(t._s(t.msToSecond(t.current_time_ms)))])]),a("p",{staticClass:"cur-time"},[a("base-btn",{staticClass:"start-btn",attrs:{size:"mini"},on:{click:function(e){return t.setTime("start")}}},[t._v("标开始点")]),a("base-btn",{staticClass:"end-btn",attrs:{size:"mini"},on:{click:function(e){return t.setTime("end")}}},[t._v("标结束点")])],1)],1),a("div",{staticClass:"d-flex row-btn"},["空白"!==t.propData.type?a("base-btn",{class:1===t.activeIndex&&"activeClass",attrs:{size:"mini",disabled:"空白"===t.propData.type},on:{click:function(e){t.activeIndex=1}}},[t._v("修改本条")]):t._e(),"审核录入"!==t.propData.source&&"正片"!==t.propData.type?a("base-btn",{class:2===t.activeIndex&&"activeClass",attrs:{size:"mini",disabled:"审核录入"==t.propData.source},on:{click:function(e){t.activeIndex=2}}},[t._v("插入节目")]):t._e(),"审核录入"!==t.propData.source&&"广告"!==t.propData.type?a("base-btn",{class:3===t.activeIndex&&"activeClass",attrs:{size:"mini",disabled:"审核录入"==t.propData.source},on:{click:function(e){t.activeIndex=3}}},[t._v("插入广告")]):t._e()],1)])]),a("div",{staticClass:"border-shadow row-form"},[a("el-form",{ref:"ruleForm",staticClass:"d-flex flex-1",attrs:{inline:!0,rules:t.rules,model:t.form,"label-width":"90px","label-position":"left"}},[3!==t.activeIndex?a("div",{staticClass:"border-right d-flex"},[a("div",[a("el-form-item",{attrs:{label:"标题名称:",prop:"title"}},[a("el-autocomplete",{attrs:{"fetch-suggestions":t.querySearchAsync,placeholder:"请输入标题名称",type:"textarea"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),a("el-form-item",{staticClass:"cateFormItem",attrs:{label:"分类:"}},[a("el-select",{attrs:{size:"mini",placeholder:"一级分类",clearable:"",filterable:"",disabled:t.isDisabled},model:{value:t.form.firstCategory,callback:function(e){t.$set(t.form,"firstCategory",e)},expression:"form.firstCategory"}},t._l(t.firstCustomCategory,(function(t){return a("el-option",{key:t.category_id,attrs:{label:t.category_name,value:t.category_id}})})),1),a("el-form-item",{attrs:{inline:!0}},[a("el-select",{attrs:{size:"mini",placeholder:"二级分类",clearable:"",filterable:"",disabled:t.isDisabled},model:{value:t.form.secondCategory,callback:function(e){t.$set(t.form,"secondCategory",e)},expression:"form.secondCategory"}},t._l(t.secondCustomCategory,(function(t){return a("el-option",{key:t.category_id,attrs:{label:t.category_name,value:t.category_id}})})),1)],1)],1),a("el-form-item",{attrs:{label:"栏目名称:"}},[a("el-select",{ref:"searchData",attrs:{size:"mini",placeholder:"请选择栏目名称",clearable:"",filterable:"",disabled:t.isDisabled},on:{clear:t.getItemList},nativeOn:{input:function(e){return t.filterData(e)}},model:{value:t.form.item_id,callback:function(e){t.$set(t.form,"item_id",e)},expression:"form.item_id"}},t._l(t.itemList,(function(t){return a("el-option",{key:t.item_id,attrs:{label:t.name,value:t.item_id}})})),1)],1)],1)]):t._e(),a("div",{staticClass:"d-flex"},[a("div",[a("el-form-item",{staticClass:"formTime",attrs:{label:"开始时间:"}},t._l(t.timeArray,(function(e){return a("el-input",{key:e,attrs:{type:"number",size:"mini"},model:{value:t.form["start"+e],callback:function(a){t.$set(t.form,"start"+e,t._n("string"===typeof a?a.trim():a))},expression:"form['start'+item]"}})})),1),a("el-form-item",{staticClass:"formTime",attrs:{label:"结束时间:"}},t._l(t.timeArray,(function(e){return a("el-input",{key:e,attrs:{type:"number",size:"mini"},model:{value:t.form["end"+e],callback:function(a){t.$set(t.form,"end"+e,t._n("string"===typeof a?a.trim():a))},expression:"form['end'+item]"}})})),1),a("el-form-item",{staticClass:"dialog-footer"},[a("base-btn",{on:{click:t.close}},[t._v("关闭")]),a("base-btn",{on:{click:function(e){return t.submitForm("ruleForm")}}},[t._v("提交")])],1)],1)])])],1)])},w=[],D=(a("e35a"),a("0d7a"),a("deac")),C=a("cadb"),x={components:{VideoHls:D["a"]},props:{propData:{type:Object,default:function(){return{}}}},data:function(){return{playerOptions:{width:"100%",autoplay:!0,muted:!1,language:"en",playbackRates:[.7,1,1.5,2],sources:[{type:"application/x-mpegURL",src:""}],src:"",poster:"https://surmon-china.github.io/vue-quill-editor/static/images/surmon-1.jpg",fluid:!0},activeIndex:1,form:{start_time:"",startHour:"",startMinute:"",startSecond:"",startMs:"",endHour:"",endMinute:"",endSecond:"",endMs:"",end_time:"",title:"",firstCategory:[],secondCategory:[],item_id:""},titleList:[],rules:{title:[{required:!0,message:"请输入标题名称",trigger:"blur"}]},timeArray:["Hour","Minute","Second","Ms"],firstCategoryName:"",secondCategoryName:"",itemList:[],firstCustomCategory:[],secondCustomCategory:[],startDate:"",endDate:"",start_time_dvalue:null,videoOffsetMs:{start_ms:1e3,end_ms:3e3},status_loading:!0}},computed:{current_time_ms:function(){return this.$store.state.videoPlay.current_time_ms},isDisabled:function(){var t=this.propData;return!!(t&&"广告"===t.type&&1===this.activeIndex||3===this.activeIndex)}},watch:{activeIndex:function(t){var e=this;1!==t&&(this.form.title="",this.form.item_id=null,this.form.firstCategory=null,this.form.secondCategory=null,this.firstCategoryName=null,this.secondCategoryName=null,this.timeArray.forEach((function(t,a){e.form["start"+t]="",e.form["end"+t]=""})))}},created:function(){var t=this.propData.item_info?this.propData.item_info.item_name:"";this.getItemList(t),this.getCustomCategory(),"空白"===this.propData.type&&(this.activeIndex=2);var e=C["a"].convert(this.propData.start_time,"y-m-d h:m:s");this.setUpdateTime(e,"start");var a=C["a"].convert(this.propData.end_time,"y-m-d h:m:s");this.setUpdateTime(a,"end")},mounted:function(){var t=this;this.$bus.$on("getChannelId",(function(e){t.getTitleList(e),t.getTimeDifference()}))},beforeDestroy:function(){this.$bus.$off("getChannelId")},methods:{querySearchAsync:function(t,e){var a=this;return Object(s["a"])(regeneratorRuntime.mark((function i(){var n,s;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,a.getTitleList(t);case 2:n=i.sent,s=[],n.forEach((function(t){s.push({id:t.id,value:t.title})})),e(s);case 6:case"end":return i.stop()}}),i)})))()},getTimeDifference:function(){var t=this;this.status_loading=!0;var e={channel_en_name:this.propData.channel_en_name,start_time:this.propData.start_time-1e4,end_time:this.propData.end_time+1e4};this.$get("/epg/m3u8-dvalue",e).then((function(e){var a=e.data;t.videoOffsetMs.start_ms=1e3*a.start_time_dvalue,t.videoOffsetMs.end_ms=t.propData.end_time-t.propData.start_time+1e3*a.start_time_dvalue,t.setFormData(),t.status_loading=!1})).catch((function(t){console.log(t)}))},msToSecond:function(t,e){String(t).split(".")[1];var a=this.propData.start_time+t-1e3*this.start_time_dvalue,i=String(a).split(".")[0].substring(10),n=C["a"].convert(a,"yyyy-MM-dd hh:mm:ss")+"."+i;return e&&(this.$data[e+"Date"]=n.split(" ")[0]),n},getTitleList:function(t){var e=this,a={channel_id:this.propData.channel_id,keyword:t};return new Promise((function(t,i){e.$get("/epg/epg-search",a).then((function(e){t(e.data.list)})).catch((function(t){e.$message(t.msg)}))}))},setTime:function(t){var e=this.msToSecond(this.current_time_ms,t);this.setUpdateTime(e,t)},setUpdateTime:function(t,e){var a=this;this.$data[e+"Date"]=t.split(" ")[0];var i=t.split(" ")[1],n=i.split(":");this.timeArray.forEach((function(t,i){a.form[e+t]=n[i],2!==i&&3!==i||(a.form[e+t]=n[2].split(".")[i-2]||a.propData[e+"_time"]%1e3)}))},getCustomCategory:function(){var t=this;this.$get("/epg-task/customer-category-list").then((function(e){t.firstCustomCategory=e.data.first_category,t.secondCustomCategory=e.data.second_category})).catch((function(e){t.$message.error(e.msg)}))},setFormData:function(){this.form.title=this.propData.title,this.form.item_id=this.propData.item_info?this.propData.item_info.item_id:"";var t=this.propData.first_customer_categories,e=this.propData.second_customer_categories;this.form.firstCategory=this.getFormCategory(t,"id")[0],this.form.secondCategory=this.getFormCategory(e,"id")[0],this.playerOptions.sources[0].src=this.propData.m3u8_vod_url,this.playerOptions.src=this.propData.m3u8_vod_url},getItemList:function(t){var e=this,a={channel_id:this.propData.channel_id,keyword:t};this.$get("/production/itemList",a).then((function(t){e.itemList=t.data})).catch((function(t){e.$message.error(t.msg)}))},getFormCategory:function(t,e){var a=[];return t&&t.length?(t.forEach((function(t){a.push(t[e])})),a):a},getParamsType:function(){return 1===this.activeIndex?this.propData.type:2===this.activeIndex?"正片":"广告"},close:function(){this.$emit("close")},getTime:function(t){var e=this,a=this.$data[t+"Date"]+" ",i=":";return this.timeArray.forEach((function(n,s){3===s&&(i=""),a=a+e.form[t+n]+i})),new Date(a).getTime()},checkTime:function(){return this.getTime("start")?this.getTime("end")?this.getTime("start")<this.propData.start_time?(this.$message("开始时间不能小于片段开始时间"),!1):this.getTime("end")>this.propData.end_time?(this.$message("结束时间不能大于片段结束时间"),!1):!(this.getTime("end")<this.getTime("start"))||(this.$message("开始时间不能大于结束时间"),!1):(this.$message("请输入结束时间"),!1):(this.$message("请输入开始时间"),!1)},submitForm:function(t){var e=this;if(this.checkTime()){var a=this.getParamsType(),i={epg_id:this.propData.id,action:1===this.activeIndex?"update":"insert",from:this.propData.type,point:{channel_id:this.propData.channel_id,channel_name:this.propData.channel_name,order_id:this.propData.order_id,day:this.propData.day,item_id:this.form.item_id||0,title:3===this.activeIndex?"广告":this.form.title,start_time:this.getTime("start"),end_time:this.getTime("end"),type:a,first_customer_category_ids:this.form.firstCategory?[this.form.firstCategory]:[],second_customer_category_ids:this.form.secondCategory?[this.form.secondCategory]:[]}};this.$refs[t].validate((function(t){if(!t)return console.log("error submit!!"),!1;e.$post("/epg/epg-modify",i).then((function(t){e.$message({type:"success",message:"提交成功"}),e.$emit("submit"),e.close()})).catch((function(t){e.$message.error(t.msg)}))}))}},filterData:window.lodash.debounce((function(){var t=this.$refs.searchData.$data.selectedLabel;this.getItemList(t)}),800)}},k=x,T=(a("16f4"),Object(g["a"])(k,y,w,!1,null,null,null)),S=T.exports,$={name:"Test",components:{TableList:b,ApprovedDetail:S},props:{modelData:{type:Array,default:function(){return[]}},currentIndex:{type:Number,default:function(){return 0}}},data:function(){return{show:!1,dialogsObj:{width:"80%",title:"审核修改",center:!0},approvedData:[]}},computed:{},watch:{currentIndexl:{handler:function(){this.setApprovedData()},immediate:!0}},created:function(){},mounted:function(){},methods:{open:function(){this.show=!0},close:function(){this.show=!1,this.$emit("close")},submit:function(){this.$emit("submit")},setApprovedData:function(){this.approvedData=u(JSON.parse(JSON.stringify(this.modelData)),this.currentIndex)}}},O=$,I=(a("dea2"),Object(g["a"])(O,l,c,!1,null,"470d2380",null)),A=I.exports,M=a("28de"),j={name:"ExamineTask",components:{ExamineModel:A,AddModel:function(){return Promise.all([a.e("chunk-98663c10"),a.e("chunk-20cd4e96")]).then(a.bind(null,"cf3c"))}},props:{},data:function(){return{form:{channel_id:"",date:"",status:"",title:"",firstCategory:"",secondCategory:""},modelShow:!1,page:1,limit:500,loading:!1,ad_show:3,status_options:["全部","已审核","待审核","审核中"],currentStatus:"",tableData:[],ad_total_duration:0,channel_total_duration:0,zp_total_duration:0,modelData:[],multipleSelection:[],currentIndex:null,showAddDialog:!1}},computed:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["categoryData","channelData","token"])),{},{channelName:function(){var t=this,e=this.channelData.filter((function(e){return e.id===t.form.channel_id}));return e[0].name}}),watch:{ad_show:function(){this.getApprovedList()}},mounted:function(){},created:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.channelData.length){e.next=3;break}return e.next=3,t.$store.dispatch("channel/getChannelData");case 3:t.form.channel_id=Number(t.$route.query.id)||t.channelData[0].id,t.form.date=t.$route.query.date||t.getNowFormatDate(),t.getApprovedList();case 6:case"end":return e.stop()}}),e)})))()},methods:{scrollToActive:function(){var t=this;this.ad_show=1,this.$nextTick((function(){var e=parseInt(t.$route.query.tid),a=40*t.tableData.findIndex((function(t){return t.id===e}));t.$refs.multipleTable.bodyWrapper.scrollTop=a}))},handleSelectionChange:function(t){var e=this;this.multipleSelection=[],t.forEach((function(t){e.multipleSelection.push(t.id)}))},update:function(t,e){var a=this;this.currentStatus=t.status,this.currentIndex=e,t.status="审核中",this.modelData=JSON.parse(JSON.stringify(this.tableData)),this.modelShow=!0,this.$nextTick((function(){a.$refs.examineModel.open(),a.$refs.examineModel.$nextTick((function(){a.$bus.$emit("getChannelId",a.form.channel_id)}))}))},approved:function(t){var e=this,a={status:"已审核",epg_ids:[t.id]};this.$post("/epg/epg-status",a).then((function(t){e.$message({type:"success",message:t.msg}),e.getApprovedList()})).catch((function(t){e.$message.error(t.msg)}))},getTime:function(t){return Object(p["c"])(t)},getDateTime:function(t){return Object(m["c"])(t)},getApprovedList:function(){var t=this;this.loading=!0;var e={channel_id:this.form.channel_id,status:"全部"===this.form.status?"":this.form.status,day:this.form.date,page:this.page,limit:this.limit,keyword:"",ad_show:1,type:null};this.$get("/epg/epg-list",e).then((function(e){var a=e.data.list;2===t.ad_show&&(a=a.filter((function(t){return"广告"===t.type}))),3===t.ad_show&&(a=a.filter((function(t){return"广告"!==t.type}))),t.tableData=a,t.loading=!1,t.ad_total_duration=e.data.ad_total_duration,t.channel_total_duration=e.data.channel_total_duration,t.zp_total_duration=e.data.zp_total_duration,t.$route.query.tid&&t.scrollToActive()})).catch((function(e){t.loading=!1,console.log(e)}))},handleCurrentChange:function(t){this.page=t},handleSizeChange:function(t){this.limit=t},getCategory:function(t,e){var a=[],i=t[e+"_customer_categories"];return i&&i.length?(i.forEach((function(t){a.push(t.name)})),a):["无"]},getNowFormatDate:function(){var t=new Date,e="-",a=t.getFullYear(),i=t.getMonth()+1,n=t.getDate();i>=1&&i<=9&&(i="0"+i),n>=0&&n<=9&&(n="0"+n);var s=a+e+i+e+n;return s},batchAudit:window.lodash.throttle((function(){var t=this,e={status:"已审核",epg_ids:this.multipleSelection};this.multipleSelection.length?this.$post("/epg/epg-status",e).then((function(e){t.$message({type:"success",message:e.msg}),t.getApprovedList()})).catch((function(e){t.$message.error(e.msg)})):this.$message("请选择审核任务")}),2e3),exportData:function(t){var e=this,a="all"===t?null:this.form.channel_id,i="all"===t?"全部":this.channelName,n="全部"===this.form.status||""===this.form.status?null:this.form.status;Object(M["a"])({method:"get",url:"/epg/epg-export",headers:{token:this.token},params:{channel_id:a,day:this.form.date,status:n},responseType:"blob"}).then((function(t){if(t.data.type){var a=new Blob([t.data],{type:"application/vnd.ms-excel"}),n=document.createElement("a");n.href=URL.createObjectURL(a),n.setAttribute("download",i+"_"+e.form.date+"-EPG业务品控表.xlsx"),n.click(),n=null,e.$message.success("导出成功")}else e.$message.warning(t.data.msg)})).catch((function(t){console.log(t)}))},selectEnable:function(t,e){return"已完成"===t.taskStatus&&"空白"!==t.type},deleteTask:function(t){var e=this,a={epg_id:t,action:"delete"};this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$post("/epg/epg-modify",a).then((function(t){e.$message({type:"success",message:"删除成功"}),e.getApprovedList()})).catch((function(t){e.$message.error(t.msg)}))})).catch((function(){e.$message({type:"info",message:"已取消删除"})}))},close:function(){this.tableData[this.currentIndex].status=this.currentStatus,this.modelShow=!1,this.currentIndex=null},closeAddModel:function(){this.showAddDialog=!1},showAddModel:function(){this.showAddDialog=!0},tableRowClassName:function(t){var e=t.row;t.rowIndex;if(e.id===Number(this.$route.query.tid))return"row-active"}}},E=j,L=(a("c9e5"),Object(g["a"])(E,i,n,!1,null,"57ecc086",null));e["default"]=L.exports},"16f4":function(t,e,a){"use strict";a("4c9e")},"1f1b":function(t,e,a){},3466:function(t,e,a){"use strict";var i=a("1c8b"),n=a("5dfd").findIndex,s=a("258f"),r=a("ff9c"),o="findIndex",l=!0,c=r(o);o in[]&&Array(1)[o]((function(){l=!1})),i({target:"Array",proto:!0,forced:l||!c},{findIndex:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),s(o)},"476d":function(t,e,a){},"4c9e":function(t,e,a){},"73c3":function(t,e,a){var i=a("4fda");t.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(i)},"7ba9":function(t,e,a){},8980:function(t,e,a){var i=a("d88d"),n=a("c7e6"),s=a("2732"),r=Math.ceil,o=function(t){return function(e,a,o){var l,c,u=String(s(e)),d=u.length,f=void 0===o?" ":String(o),p=i(a);return p<=d||""==f?u:(l=p-d,c=n.call(f,r(l/f.length)),c.length>l&&(c=c.slice(0,l)),t?u+c:c+u)}};t.exports={start:o(!1),end:o(!0)}},"898e":function(t,e,a){"use strict";var i=a("1c8b"),n=a("8980").start,s=a("73c3");i({target:"String",proto:!0,forced:s},{padStart:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}})},a59a:function(t,e,a){"use strict";a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){return n})),a.d(e,"b",(function(){return s}));a("e35a"),a("5e9f"),a("0d7a"),a("513c");function i(t){var e,a=parseInt(t%864e5/36e5),i=parseInt(t%36e5/6e4),n=t%6e4/1e3;return e=(a<10?"0"+a:a)+":"+(i<10?"0"+i:i)+":"+(n<10?"0"+n:n),e}function n(t){if(!isNaN(t))var e=new Date(t);var a=e.getFullYear(),i=e.getMonth()+1+"",n=e.getDate()+"";return i=i.replace(/\b\d\b/g,"0$&"),n=n.replace(/\b\d\b/g,"0$&"),a+"-"+i+"-"+n}function s(t){var e=t.split(":"),a=36e5*Number(e[0]),i=6e4*Number(e[1]),n=1e3*Number(e[2]);return Math.floor((a+i+n)/60)}},c9da:function(t,e,a){"use strict";a("7ba9")},c9e5:function(t,e,a){"use strict";a("476d")},dea2:function(t,e,a){"use strict";a("1f1b")},deac:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"video-hls-wrap"},[a("video-player",{ref:"videoPlayer",staticClass:"vjs-custom-skin",attrs:{options:t.options},on:{ready:t.playerReadied,timeupdate:function(e){return t.onPlayerTimeupdate(e)},loadeddata:function(e){return t.onPlayerLoadeddata(e)}}})],1)},n=[],s=a("6767"),r=a.n(s),o={},l=r.a.registerPlugin||r.a.plugin,c=function t(){var e=this,a=this.currentTime();a<0&&(this.currentTime(0),this.play()),this._offsetEnd>0&&a>this._offsetEnd-this._offsetStart&&(this.off("timeupdate",t),this.pause(),this.trigger("ended"),this.one("play",(function(){e.on("timeupdate",t)})),this._restartBeginning?(this.trigger("loadstart"),this.currentTime(0)):this.currentTime(this._offsetEnd-this._offsetStart))},u=function(t,e){t.one("play",(function(){t.on("timeupdate",c)}))},d=function(t){var e=this;t=t||{};var a=this.constructor;this._offsetStart=parseFloat(t.start||"0"),this._offsetEnd=parseFloat(t.end||"0"),this._restartBeginning=t.restart_beginning||!1,a.__super__&&a.__super__.__offsetInit||(a.__super__={__offsetInit:!0,duration:a.prototype.duration,currentTime:a.prototype.currentTime,bufferedPercent:a.prototype.bufferedPercent,remainingTime:a.prototype.remainingTime,buffered:a.prototype.buffered},a.prototype.duration=function(){return void 0!==this._offsetEnd&&void 0!==this._offsetStart?this._offsetEnd>0?this._offsetEnd-this._offsetStart:a.__super__.duration.apply(this,arguments)-this._offsetStart:a.__super__.duration.apply(this,arguments)},a.prototype.currentTime=function(t){if(void 0!==t)return void 0!==this._offsetStart?a.__super__.currentTime.call(this,t+this._offsetStart):a.__super__.currentTime.call(this,t);if(void 0!==this._offsetStart){var e=a.__super__.currentTime.apply(this)-this._offsetStart;return this.getCache().currentTime=e,e}return a.__super__.currentTime.apply(this)},a.prototype.remainingTime=function(){return this.duration()-this.currentTime()},a.prototype.startOffset=function(){return this._offsetStart},a.prototype.endOffset=function(){return this._offsetEnd>0?this._offsetEnd:this.duration()},a.prototype.buffered=function(){for(var t=a.__super__.buffered.call(this),e=[],i=0;i<t.length;i++)e[i]=[Math.max(0,t.start(i)-this._offsetStart),Math.min(Math.max(0,t.end(i)-this._offsetStart),this.duration())];return r.a.createTimeRanges(e)}),this.ready((function(){u(e,r.a.mergeOptions(o,t))}))};l("offset",d);window.videojs=r.a,a("956c");var f={name:"VideoHls",components:{},props:{videoOffsetMs:{type:Object,default:function(){return{start_ms:0,end_ms:0}}},playerOptions:{type:Object,default:function(){return{}}}},data:function(){return{options:{height:"360",sources:[{withCredentials:!1,type:"application/x-mpegURL",src:""}],controlBar:{timeDivider:!1,durationDisplay:!1},flash:{hls:{withCredentials:!1}},html5:{hls:{withCredentials:!1}}},canPlay:!1}},computed:{player:function(){return this.$refs.videoPlayer.player}},watch:{},created:function(){this.options=Object.assign(this.playerOptions,this.options),this.options.sources[0].src=this.playerOptions.src},mounted:function(){},methods:{onPlayerLoadeddata:function(t){},playerReadied:function(t){t.tech({IWillNotUseThisInPlugins:!0}).hls;t.tech_.hls.xhr.beforeRequest=function(t){return t},this.videoOffset(t,this.videoOffsetMs)},onPlayerTimeupdate:function(t){this.$store.commit("setVideoCurrentTime",1e3*t.currentTime())},videoOffset:function(t,e){if(t){var a=this.videoOffsetMs.start_ms/1e3,i=this.videoOffsetMs.end_ms/1e3;t.offset({start:a||0,end:i||0,restart_beginning:!0})}}}},p=f,m=a("4ac2"),h=Object(m["a"])(p,i,n,!1,null,"97be1b68",null);e["a"]=h.exports},ed08:function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return s})),a.d(e,"a",(function(){return r}));var i=a("01d6");a("e35a"),a("5e9f"),a("84c2"),a("1c2e"),a("e18c"),a("898e"),a("0d7a"),a("08ba");function n(t,e){if(0===arguments.length||!t)return null;var a,n=e||"{y}-{m}-{d} {h}:{i}:{s}";"object"===Object(i["a"])(t)?a=t:("string"===typeof t&&(t=/^[0-9]+$/.test(t)?parseInt(t):t.replace(new RegExp(/-/gm),"/")),"number"===typeof t&&10===t.toString().length&&(t*=1e3),a=new Date(t));var s={y:a.getFullYear(),m:a.getMonth()+1,d:a.getDate(),h:a.getHours(),i:a.getMinutes(),s:a.getSeconds(),a:a.getDay()},r=n.replace(/{([ymdhisa])+}/g,(function(t,e){var a=s[e];return"a"===e?["日","一","二","三","四","五","六"][a]:a.toString().padStart(2,"0")}));return r}function s(t,e){if(0===arguments.length||!t)return null;var a,n=e||"{h}:{i}:{s}";"object"===Object(i["a"])(t)?a=t:("string"===typeof t&&(t=/^[0-9]+$/.test(t)?parseInt(t):t.replace(new RegExp(/-/gm),"/")),"number"===typeof t&&10===t.toString().length&&(t*=1e3),a=new Date(t));var s={h:a.getHours(),i:a.getMinutes(),s:a.getSeconds(),a:a.getDay()},r=n.replace(/{([hisa])+}/g,(function(t,e){var a=s[e];return"a"===e?["日","一","二","三","四","五","六"][a]:a.toString().padStart(2,"0")}));return r}function r(t){parseInt(t/864e5);var e=parseInt(t%864e5/36e5),a=parseInt(t%36e5/6e4),i=parseInt(t%6e4/1e3),n=parseInt(t-36e5*e-6e4*a-1e3*i);return{hours:e,minutes:a,seconds:i,ms:n}}}}]);