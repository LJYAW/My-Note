(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-61e7b6d6"],{"0c62":function(e,t,a){},3466:function(e,t,a){"use strict";var n=a("1c8b"),r=a("5dfd").findIndex,s=a("258f"),o=a("ff9c"),i="findIndex",l=!0,c=o(i);i in[]&&Array(1)[i]((function(){l=!1})),n({target:"Array",proto:!0,forced:l||!c},{findIndex:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),s(i)},"52af":function(e,t,a){},8934:function(e,t,a){"use strict";a("0c62")},9302:function(e,t,a){"use strict";var n=a("1c8b"),r=a("692f"),s=a("da10"),o=a("d7e1"),i=[].join,l=r!=Object,c=o("join",",");n({target:"Array",proto:!0,forced:l||!c},{join:function(e){return i.call(s(this),void 0===e?",":e)}})},9717:function(e,t,a){"use strict";a("9ed6")},"9ed6":function(e,t,a){},c4b2:function(e,t,a){"use strict";a("52af")},d6a5:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"user-mgt"},[a("div",{staticClass:"user-head"},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"手机号"}},[a("el-input",{attrs:{placeholder:"请输入手机号",clearable:""},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),a("el-form-item",{attrs:{label:"姓名"}},[a("el-input",{attrs:{placeholder:"请输入姓名",clearable:""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:"团队"}},[a("el-select",{attrs:{placeholder:"请选择团队",filterable:"",clearable:""},model:{value:e.form.teamId,callback:function(t){e.$set(e.form,"teamId",t)},expression:"form.teamId"}},e._l(e.teamData,(function(e){return a("el-option",{key:e.id,attrs:{label:e.department_name,value:e.id}})})),1)],1),a("base-btn",{attrs:{size:"big"},nativeOn:{click:function(t){return e.search(t)}}},[e._v("搜索")]),a("base-btn",{attrs:{size:"big"},nativeOn:{click:function(t){return e.clear(t)}}},[e._v("清除")])],1),a("div",[a("base-btn",{attrs:{size:"big"},nativeOn:{click:function(t){return e.addUser(t)}}},[e._v("新建用户")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.userData,border:""}},[a("el-table-column",{attrs:{prop:"phone",label:"手机号"}}),a("el-table-column",{attrs:{prop:"nickname",label:"姓名"}}),a("el-table-column",{attrs:{prop:"department",label:"团队"}}),a("el-table-column",{attrs:{prop:"role",label:"角色"}}),a("el-table-column",{attrs:{prop:"status",label:"状态"}}),a("el-table-column",{attrs:{prop:"work",label:"业务"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.work.split(" ").join("、"))+" ")]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("base-btn",{attrs:{type:"text"},nativeOn:{click:function(a){return e.updateUser(t.row)}}},[e._v("编辑")]),"正常"==t.row.status?a("base-btn",{attrs:{type:"text"},nativeOn:{click:function(a){return e.deleteUser(t.row.id,-1)}}},[e._v("禁用")]):a("base-btn",{attrs:{type:"text"},nativeOn:{click:function(a){return e.deleteUser(t.row.id,1)}}},[e._v("恢复")])]}}])})],1),a("base-pag",{attrs:{total:e.total,limit:e.pageSize,page:e.currentPage},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}}),a("add",{ref:"add",attrs:{show:e.showAddModel},on:{close:e.close}})],1)},r=[],s=a("1c03"),o=(a("053b"),a("08ba"),a("fe8a"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("base-dialog",{attrs:{show:e.show,title:e.dialogsObj.title,width:e.dialogsObj.width,center:e.dialogsObj.center},on:{close:e.close}},[a("div",[a("div",{staticClass:"add-person"},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"90px","label-position":"left"}},[a("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[a("el-input",{attrs:{placeholder:"请输入手机号"},model:{value:e.ruleForm.phone,callback:function(t){e.$set(e.ruleForm,"phone",t)},expression:"ruleForm.phone"}})],1),a("el-form-item",{attrs:{label:"姓名",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入姓名"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),a("el-form-item",{attrs:{label:"团队名称",prop:"team_id"}},[a("el-select",{attrs:{placeholder:"请选择团队名称",clearable:"",filterable:""},model:{value:e.ruleForm.team_id,callback:function(t){e.$set(e.ruleForm,"team_id",t)},expression:"ruleForm.team_id"}},e._l(e.teamData,(function(e){return a("el-option",{key:e.id,attrs:{label:e.department_name,value:e.id}})})),1),a("base-btn",{staticClass:"newBtn",nativeOn:{click:function(t){e.showAddTeam=!0}}},[e._v("新增团队")])],1),a("el-form-item",{attrs:{label:"密码",prop:e.rowData.id?"":"password"}},[a("el-input",{attrs:{placeholder:"请输入密码",autocomplete:"new-password",type:"password"},model:{value:e.ruleForm.password,callback:function(t){e.$set(e.ruleForm,"password",t)},expression:"ruleForm.password"}})],1),a("el-form-item",{attrs:{label:"业务",prop:"work"}},e._l(e.businessList,(function(t,n){return a("el-checkbox-group",{key:n,model:{value:e.ruleForm.work,callback:function(t){e.$set(e.ruleForm,"work",t)},expression:"ruleForm.work"}},e._l(t,(function(t,n){return a("el-checkbox",{key:n,attrs:{label:t.id,name:t.name,disabled:e.isDisabled(t)}},[e._v(e._s(t.name))])})),1)})),1),e.ruleForm.work.includes("广告审核")?a("el-form-item",{attrs:{label:"频道"}},[e.tagData.length?a("div",{staticClass:"tag-wrap"},[e._l(e.tagData,(function(t,n){return a("el-tag",{key:t.name,staticClass:"tag-item",attrs:{closable:"",type:t.type},on:{close:function(t){return e.deleteTag(n)}}},[e._v(" "+e._s(t.name)+" ")])})),a("base-btn",{attrs:{type:"text"},on:{click:function(t){e.tagData=[]}}},[e._v("清空")])],2):e._e(),a("div",{staticClass:"all-btn"},[a("el-input",{attrs:{placeholder:"请输入内容"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.channel_name,callback:function(t){e.channel_name=t},expression:"channel_name"}},[a("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:e.search},slot:"suffix"})]),a("base-btn",{on:{click:e.selectAll}},[e._v("全选")])],1),a("div",{staticClass:"channel-wrap"},e._l(e.filterChannelData,(function(t){return a("span",{key:t.id,class:[e.isChoose(t.id)&&"active","channel-item"],on:{click:function(a){return e.addChannel(t)}}},[e._v(e._s(t.name))])})),0)]):e._e(),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("确定")]),a("el-button",{on:{click:function(t){return e.close("ruleForm")}}},[e._v("取消")])],1)],1)],1)]),a("base-dialog",{attrs:{title:"新建团队",show:e.showAddTeam,"append-to-body":!0},on:{close:e.closeCreateModel}},[a("CreateModel",{on:{close:e.closeCreateModel}})],1)],1)}),i=[],l=a("99a5"),c=(a("6a61"),a("e35a"),a("0d7a"),a("dbb3"),a("b130"),a("90aa"),a("3466"),a("ea69"),a("9302"),{phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3456789]\d{9}$/,message:"目前只支持中国大陆的手机号码",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],team_id:[{required:!0,message:"请选择团队名称",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],work:[{required:!0,message:"请选择业务",trigger:"blur"}]}),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,inline:!0}},[a("el-form-item",{attrs:{prop:"team_name",label:"团队名称","label-width":"auto"}},[a("el-input",{attrs:{placeholder:"请输入团队名称"},model:{value:e.form.team_name,callback:function(t){e.$set(e.form,"team_name",t)},expression:"form.team_name"}})],1)],1),a("div",{staticClass:"dialog_footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("确定")]),a("el-button",{on:{click:function(t){return e.close("ruleForm")}}},[e._v("取消")])],1)],1)},d=[],m={components:{},props:{},data:function(){return{form:{team_name:""},rules:{team_name:[{required:!0,message:"请输入团队名称",trigger:"blur"}]}}},computed:{},watch:{},created:function(){this.form.team_name=""},mounted:function(){},methods:{submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;t.$post("/user/teamAdd",{name:t.form.team_name}).then((function(e){t.$message({message:"创建团队成功",type:"success"}),t.close()})).catch((function(e){t.$message.error(e.msg)}))}))},close:function(){this.$emit("close")}}},f=m,h=(a("8934"),a("4ac2")),p=Object(h["a"])(f,u,d,!1,null,"c5ae2d5a",null),b=p.exports,g=a("52c1"),w=a("7394"),v=a.n(w),k=[[{id:"整档编辑",name:"整档编辑"},{id:"整档编辑管理员",name:"整档编辑管理员"}],[{id:"拆条编辑",name:"拆条编辑"},{id:"拆条编辑管理员",name:"拆条编辑管理员"}],[{id:"EPG编辑",name:"EPG编辑",mutex:["EPG审核","EPG审核管理员"]},{id:"EPG编辑管理员",name:"EPG编辑管理员",mutex:["EPG审核","EPG审核管理员"]},{id:"EPG审核",name:"EPG审核",mutex:["EPG编辑","EPG编辑管理员"]},{id:"EPG审核管理员",name:"EPG审核管理员",mutex:["EPG编辑","EPG编辑管理员"]}],[{id:"广告编辑",name:"广告编辑",mutex:["广告审核","广告审核管理员"]},{id:"广告编辑管理员",name:"广告编辑管理员",mutex:["广告审核","广告审核管理员"]},{id:"广告审核",name:"广告审核",mutex:["广告编辑","广告编辑管理员"]},{id:"广告审核管理员",name:"广告审核管理员",mutex:["广告编辑","广告编辑管理员"]}]],_={name:"AssignTask",components:{CreateModel:b},props:{show:{type:Boolean,default:!1}},data:function(){return{dialogsObj:{width:"8 00px",title:"新增用户",center:!0},rules:c,ruleForm:{phone:"",name:"",team_id:"",password:"",work:[]},channel_id:null,channel_name:null,filterChannelData:[],tagData:[],rowData:{},showAddTeam:!1,businessList:k}},computed:Object(s["a"])({},Object(g["b"])(["teamData","channelData"])),watch:{rowData:function(e){var t=this;if(e.id){this.dialogsObj.title="编辑用户",this.ruleForm.id=e.id,this.ruleForm.name=e.nickname,this.ruleForm.phone=e.phone,this.ruleForm.team_id=e.department_id,e.work?this.ruleForm.work=e.work.split(","):this.ruleForm.work=[];var a=e.ad_channel_ids.split(",");this.tagData=this.filterChannelData.filter((function(e){return a.includes(String(e.id))}))}else this.dialogsObj.title="新增用户",Object.keys(this.ruleForm).forEach((function(e){t.ruleForm[e]=""})),this.ruleForm.work=[]}},created:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.$store.dispatch("user/getTeamData",{page:1,limit:1e4}),e.channelData.length){t.next=4;break}return t.next=4,e.$store.dispatch("channel/getChannelData");case 4:e.filterChannelData=JSON.parse(JSON.stringify(e.channelData));case 5:case"end":return t.stop()}}),t)})))()},mounted:function(){},methods:{open:function(){this.show=!0},close:function(){this.$emit("close")},search:function(){var e=this,t={keyword:this.channel_name};this.$get("/production/channelList",t).then((function(t){e.filterChannelData=t.data.list}))},isChoose:function(e){var t=this.tagData.findIndex((function(t){return t.id===e}));return-1!==t},addChannel:function(e){var t=this.tagData.findIndex((function(t){return t.id===e.id}));-1===t&&this.tagData.push(e)},selectAll:function(){this.tagData=JSON.parse(JSON.stringify(this.filterChannelData))},deleteTag:function(e){this.tagData.splice(e,1)},closeCreateModel:function(){this.showAddTeam=!1,this.$store.dispatch("user/getTeamData",{page:1,limit:1e4})},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;var a=JSON.parse(JSON.stringify(t.ruleForm));a.ad_channel_ids=a.work.includes("广告审核")?t.getChannelIds():"",a.work=a.work.join(","),a.password?a.password=v()(a.password):delete a["password"],t.userAdd(a)}))},getChannelIds:function(){var e=[];return this.tagData.forEach((function(t){e.push(t.id)})),e.join(",")},isDisabled:function(e){if(!e.mutex)return!1;for(var t=0;t<e.mutex.length;t++)if(-1!==this.ruleForm.work.indexOf(e.mutex[t]))return!0},userAdd:function(e){var t=this;this.$post("/user/userAdd",e).then((function(e){t.rowData.id?t.$message({message:"编辑用户成功",type:"success"}):t.$message({message:"新建用户成功",type:"success"}),t.close()})).catch((function(e){t.$message.error(e.msg)}))}}},x=_,y=(a("9717"),Object(h["a"])(x,o,i,!1,null,"3bcc4e6e",null)),F=y.exports,D={components:{add:F},data:function(){return{showAddModel:!1,form:{name:"",phone:"",teamId:""},pageSize:10,currentPage:1,total:0,userData:[],loading:!1}},computed:Object(s["a"])({},Object(g["b"])(["teamData"])),watch:{},created:function(){this.getUserList(),this.$store.dispatch("user/getTeamData",{page:1,limit:1e4})},mounted:function(){},methods:{handleCurrentChange:function(e){this.currentPage=e,this.getUserList()},handleSizeChange:function(e){this.pageSize=e,this.getUserList()},search:function(){this.currentPage=1,this.getUserList()},getUserList:function(){var e=this;this.loading=!0;var t={page:this.currentPage,limit:this.pageSize,keyword:this.form.name,phone:this.form.phone,team_id:this.form.teamId};this.$get("/user/userList",t).then((function(t){e.userData=t.data.list,e.total=t.data.total,e.loading=!1})).catch((function(t){e.$message.error(t.msg),e.loading=!1}))},close:function(){this.showAddModel=!1,this.getUserList()},updateUser:function(e){this.showAddModel=!0,this.$refs.add.rowData=e},addUser:function(){this.showAddModel=!0,this.$refs.add.rowData={}},deleteUser:function(e,t){var a=this;this.$confirm("确定要禁用此用户吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.$post("/user/change-status",{id:e,status:t}).then((function(e){a.$message({type:"success",message:"删除成功!"}),a.getUserList()})).catch((function(e){a.$message.error(e.msg)}))}))},clear:function(){var e=this;Object.keys(this.form).forEach((function(t){e.form[t]=""})),this.getUserList()}}},$=D,C=(a("c4b2"),Object(h["a"])($,n,r,!1,null,"fe6950c2",null));t["default"]=C.exports}}]);