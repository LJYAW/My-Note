(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-17c40636"],{"0a91":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"header-swiper"},[a("div",{staticClass:"conteniner"},[a("div",{staticClass:"edit-box banner-edit-wrap"},[a("BaseTitle",{staticClass:"base-title",attrs:{title:"Banner内容配置"}}),a("span",[e._v(" Banner "+e._s(e.baseHeaderBanner.length)+"/"+e._s(e.MAX_LENGTH))]),e._l(e.baseHeaderBanner,(function(t,n){return a("div",{key:n,staticClass:"data-list"},[1!==e.baseHeaderBanner.length?a("svg-icon",{staticClass:"del-icon",attrs:{"icon-class":"delete"},on:{click:function(t){return e.deleteBannerData(n)}}}):e._e(),a("div",{staticClass:"wrap"},[a("div",{staticClass:"banner-title"},[a("span",{staticClass:"name"},[e._v("Banner背景图")]),a("span",{staticClass:"size"},[e._v("尺寸： "+e._s(t.bannerSize.width)+"*"+e._s(t.bannerSize.height)+"px")])]),a("div",{staticClass:"btn-card"},[t.bannerFileName?a("div",{staticClass:"group-info-wrap"},[a("div",{staticClass:"banner-name"},[e._v(e._s(t.bannerFileName))]),a("el-button",{staticClass:"delete-btn",attrs:{type:"text"},on:{click:function(t){return e.deleteBanner("banner",n)}}},[e._v("删除")])],1):a("UpImg",{staticClass:"btn",attrs:{size:t.bannerSize},on:{getFileDetails:function(t){return e.getFileDetails(arguments,n,"banner")}}})],1)]),a("div",{staticClass:"wrap"},[a("div",{staticClass:"banner-title"},[a("span",{staticClass:"name"},[e._v("Banner合成图")]),a("span",{staticClass:"size"},[e._v("尺寸： "+e._s(t.subBannerSize.width)+"*"+e._s(t.subBannerSize.height)+"px")])]),a("div",{staticClass:"btn-card"},[t.subBannerFileName?a("div",{staticClass:"group-info-wrap"},[a("div",{staticClass:"banner-name"},[e._v(e._s(t.subBannerFileName))]),a("el-button",{staticClass:"delete-btn",attrs:{type:"text"},on:{click:function(t){return e.deleteBanner("subBanner",n)}}},[e._v("删除")])],1):a("UpImg",{staticClass:"btn",attrs:{size:t.subBannerSize},on:{getFileDetails:function(t){return e.getFileDetails(arguments,n,"subBanner")}}})],1)]),a("div",{staticClass:"wrap"},[e._m(0,!0),a("div",{staticClass:"btn-card"},[t.group.name||t.calssData.name?a("div",{staticClass:"group-info-wrap"},[a("GroupInfo",{attrs:{group:t.group,"calss-data":t.calssData}}),a("el-button",{staticClass:"delete-btn",attrs:{type:"text"},on:{click:function(t){return e.deleteSingle(n)}}},[e._v("删除")])],1):a("div",{staticClass:"com-btn btn",on:{click:function(t){return e.selectCom(n)}}},[e._v("选择单品")])])])],1)}))],2),a("div",{staticClass:"btn-info",on:{click:function(t){return e.addBannerList()}}},[e._v("+ 增加Banner")]),a("div",{staticClass:"edit-btn-wrap"},[a("el-button",{staticStyle:{width:"100px"},attrs:{type:"danger",size:"mini"},on:{click:e.reloadData}},[e._v("取消")])],1)])])},s=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"banner-title"},[a("span",{staticClass:"name"},[e._v("Banner跳转页面选择")]),a("span",{staticClass:"size"},[e._v("选择单品或分类")])])}],r=a("e9ff"),i=a("06c4"),c=(a("e186"),a("053b"),a("ea69"),a("e18c"),a("52c1")),o=a("cf95"),l=(a("8ffd"),a("22cd")),u=a("5feb");function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t,a){return t&&p(e.prototype,t),a&&p(e,a),e}a("08ba"),a("96db"),a("af86");var f=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{w:678,h:400};d(this,e);var s={url:"",x:0,y:0},r={type:"image/jpeg",compress:1};return this.canvasOptipns=n,t.forEach((function(e,t,a){a[t]=Object.assign({},s,e)})),this.imgs=t,this.opts=Object.assign({},r,a),this.imgObjs=[],this.createCanvas(),this.outputImg()}return b(e,[{key:"createCanvas",value:function(){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),console.log(this.imgs);var e=this.canvasOptipns,t=e.w,a=e.h;this.canvas.width=t,this.canvas.height=a,this.ctx.fillStyle="#F5F6F6",this.ctx.fillRect(0,0,t,a)}},{key:"drawImg",value:function(e){var t=new Image;return t.src=this.imgs[e].url,t.crossOrigin="Anonymous",this.imgObjs.push(t),new Promise((function(e){t.onload=e}))}},{key:"outputImg",value:function(){var e=this,t=[];return this.imgs.forEach((function(a,n){t.push(e.drawImg(n))})),Promise.all(t).then((function(){return e.imgs.forEach((function(t,a){var n,s=[e.imgObjs[a],e.imgs[a].x,e.imgs[a].y];e.imgs[a].width&&e.imgs[a].height&&s.push(e.imgs[a].width,e.imgs[a].height),(n=e.ctx).drawImage.apply(n,s)})),Promise.resolve(e.ctx.canvas.toDataURL(e.opts.type),e.opts.compress)}))}}]),e}();a("f1a9"),a("c370"),a("e35a"),a("0d7a"),a("f4e3"),a("3e54"),a("8256"),a("ab6e"),a("927c"),a("3c51"),a("db0a"),a("1cc1"),a("ab0f"),a("fc6e"),a("f30b"),a("cfd1"),a("d104"),a("f74a"),a("3598"),a("b497"),a("2909"),a("a7ef"),a("b523"),a("e671"),a("4140"),a("83db"),a("829d"),a("939f"),a("1bb1"),a("c3ba");function h(e,t){var a=e.split(","),n=a[0].match(/:(.*?);/)[1],s=atob(a[1]),r=s.length,i=new Uint8Array(r);while(r--)i[r]=s.charCodeAt(r);return new File([i],t,{type:n})}var m={components:{GroupInfo:l["a"],UpImg:u["a"]},props:{},data:function(){return{mageImg:"",baseHeaderBanner:[],MAX_LENGTH:5,activeIndex:-1}},computed:Object(i["a"])({},Object(c["c"])("bdapp",["appData","appDataCopy"])),watch:{baseHeaderBanner:{handler:function(e){var t=this.appData;t.HeaderBanner=this.baseHeaderBanner,this.$store.commit("bdapp/SET_ZHONGGU_APP_DATA",t)},deep:!0}},created:function(){this.baseHeaderBanner=this.$lodash.cloneDeep(this.appData.HeaderBanner),console.log("🚀 ~ file: edit-header-swiper.vue ~ line 135 ~ created ~ this.appData",this.appData)},beforeDestroy:function(){this.$bus.$off("getActiveClassData")},mounted:function(){var e=this;this.$bus.$on("getActiveClassData",(function(t){e.setBaseData(t)}))},methods:{setBaseData:function(e){var t=e.activeClassData,a=e.checkboxGroup;console.log("🚀 ~ f",t,a),-1!==t.id&&"未分类"!==t.name||a.id?(this.baseHeaderBanner[this.activeIndex]["calssData"]=t,this.baseHeaderBanner[this.activeIndex]["group"]=a):this.$message.error("不能选择"+t.name)},deleteBanner:function(e,t){"banner"===e&&(this.baseHeaderBanner[t]["bannerFileName"]="",this.baseHeaderBanner[t]["bannerSrc"]="",this.baseHeaderBanner[t]["bannerUrl"]=""),"subBanner"===e&&(this.baseHeaderBanner[t]["subBannerFileName"]="",this.baseHeaderBanner[t]["subBannerSrc"]="",this.baseHeaderBanner[t]["subBannerUrl"]="")},deleteBannerData:function(e){this.baseHeaderBanner.splice(e,1)},addBannerList:function(){if(this.baseHeaderBanner.length>this.MAX_LENGTH-1)this.$message.error("最多添加".concat(this.MAX_LENGTH,"条"));else{var e=Object(o["b"])();this.baseHeaderBanner.push(e)}},getFileDetails:function(e,t,a){var n=this;return Object(r["a"])(regeneratorRuntime.mark((function s(){var r,i,c,o,l,u,d,p,b,f,m,g;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(r=e[0],i=r.fileName,c=r.filePath,o=r.fileUrl,"banner"===a&&(n.baseHeaderBanner[t]["bannerFileName"]=i,n.baseHeaderBanner[t]["bannerSrc"]=c,n.baseHeaderBanner[t]["bannerUrl"]=o),"subBanner"===a&&(n.baseHeaderBanner[t]["subBannerFileName"]=i,n.baseHeaderBanner[t]["subBannerSrc"]=c,n.baseHeaderBanner[t]["subBannerUrl"]=o),l=[n.baseHeaderBanner[t]["bannerUrl"],n.baseHeaderBanner[t]["subBannerUrl"]],!l[0]||!l[1]){s.next=17;break}return s.next=7,n.imgMerge(l);case 7:return u=s.sent,d=h(u,"homeHeaderBannerfile"),p=new FormData,p.append("photo",d),s.next=13,n.$post("/admin/util/upload-img",p);case 13:b=s.sent,f=b.err,m=b.res,f?n.$message.error(f.msg):(g=m.data,n.baseHeaderBanner[t]["imgMergeUrl"]=g.file_path,n.baseHeaderBanner[t]["imgMergeFileName"]="homeHeaderBannerfile");case 17:case"end":return s.stop()}}),s)})))()},imgMerge:function(e){return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("🚀 ~ file: edit-header-swiper.vue ~ line 183 ~ imgMerge ~ arr",e),t.abrupt("return",new Promise((function(t,a){var n=new f([{url:e[0],width:678,height:252,x:0,y:148},{url:e[1],width:300,height:400,x:308,y:0}]);n.then((function(e){t(e)}))})));case 2:case"end":return t.stop()}}),t)})))()},selectCom:function(e){this.activeIndex=e,this.$store.commit("bdapp/SHOW_COM_DIALOG",!0)},deleteSingle:function(e){this.baseHeaderBanner[e].group={},this.baseHeaderBanner[e].calssData={}},reloadData:function(){var e=this;this.$confirm("确认恢复到之前数据吗","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.baseHeaderBanner=e.$lodash.cloneDeep(e.appDataCopy.HeaderBanner)}))},save:function(){}}},g=m,v=(a("96fd"),a("cba8")),B=Object(v["a"])(g,n,s,!1,null,"434fc564",null);t["default"]=B.exports},"22cd":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"group-info"},[a("div",{staticClass:"list"},[e.calssData&&e.calssData.name?a("span",[e._v(e._s(e.calssData.name)+" |")]):e._e(),e.group&&e.group.name?a("div",{staticClass:"group"},[a("span",{staticClass:"name"},[e._v(e._s(e.group.name)+" ")]),e._v(" | "),a("span",[e._v("ID: "+e._s(e.group.category_id)+" | ")]),a("span",[e._v("库存: "+e._s(e.group.inventory)+" | ")]),a("span",[e._v("售价： "+e._s(e.group.price))])]):e._e()])])},s=[],r={components:{},props:{calssData:{type:Object,default:function(){}},group:{type:Object,default:function(){}}},data:function(){return{}},computed:{},watch:{},created:function(){},mounted:function(){},methods:{}},i=r,c=(a("a606"),a("cba8")),o=Object(c["a"])(i,n,s,!1,null,"2793981c",null);t["a"]=o.exports},2504:function(e,t,a){},"5feb":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"base-up-image"},[a("BaseUpload",{attrs:{"button-name":e.buttonName},on:{getFileUrl:e.getFileUrl}})],1)},s=[],r=a("e9ff"),i=(a("e186"),a("b4fb"),a("053b"),a("d340")),c={name:"UpImg",components:{},props:{size:{type:Object,default:function(){return{width:0,height:0}}},buttonName:{type:String,default:"点击上传"}},data:function(){return{fileName:""}},computed:{},watch:{},created:function(){},mounted:function(){},methods:{getFileUrl:function(e,t){var a=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){var s,r,c,o,l,u;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Object(i["a"])(e);case 2:s=n.sent,r=s.w,c=s.h,o=a.size,l=o.width,u=o.height,l<1?a.upload(t):r!==l||c!==u?a.$message({message:"请上传尺寸为 ".concat(l,"*").concat(u," 的图片"),type:"warning"}):a.upload(t);case 7:case"end":return n.stop()}}),n)})))()},upload:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var n,s,r,i,c,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=new FormData,n.append("photo",e),a.next=4,t.$post("/admin/util/upload-img",n);case 4:s=a.sent,r=s.err,i=s.res,r?t.$message.error(r.msg):(c=i.data,o={fileName:e.name,filePath:c.file_path,fileUrl:c.url},t.fileName=e.name,t.$emit("getFileDetails",o));case 8:case"end":return a.stop()}}),a)})))()}}},o=c,l=a("cba8"),u=Object(l["a"])(o,n,s,!1,null,"5dc867de",null);t["a"]=u.exports},"8ffd":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"select-com-btn"},[a("el-button",{attrs:{type:"text"},on:{click:e.selectCom}},[e._v("选择单品")])],1)},s=[],r=(a("513c"),{name:"SelectBtn",components:{},props:{dataIndex:{type:Number,default:-1}},data:function(){return{}},computed:{showComDialog:function(){return this.$store.state.bdapp.showComDialog}},watch:{},methods:{selectCom:function(){this.$store.commit("bdapp/SHOW_COM_DIALOG",!0)}}}),i=r,c=a("cba8"),o=Object(c["a"])(i,n,s,!1,null,"66ac26b8",null);o.exports},"96fd":function(e,t,a){"use strict";a("2504")},a606:function(e,t,a){"use strict";a("c629")},c629:function(e,t,a){}}]);