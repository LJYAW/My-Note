(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-097852c2"],{"0e5c":function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));r("e18c");var a=r("eca5"),i=function(e){var t=new FormData;return t.append("photo",e),new Promise((function(e,r){Object(a["c"])("/admin/util/upload-img",t).then((function(t){e(t)})).catch((function(e){return r(e)}))}))}},4634:function(e,t,r){},"6dc8":function(e,t,r){},d266:function(e,t,r){"use strict";r("6dc8")},e52b:function(e,t,r){"use strict";r("4634")},f64c:function(e,t,r){"use strict";var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"new-product-wrap"},[r("div",{staticClass:"product-form"},[r("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,inline:!0}},[r("el-form-item",{attrs:{prop:"name",label:"产品名称"}},[r("el-input",{attrs:{maxlength:20,placeholder:"产品名称最多20个字符"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),r("div",{staticClass:"flex-wrap"},[r("el-form-item",{attrs:{prop:"category_id",label:"产品分类"}},[r("el-select",{model:{value:e.form.category_id,callback:function(t){e.$set(e.form,"category_id",t)},expression:"form.category_id"}},e._l(e.classData,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),r("el-form-item",{attrs:{label:"产品编号"}},[r("el-input",{attrs:{placeholder:"请输入产品编号"},model:{value:e.form.number,callback:function(t){e.$set(e.form,"number",t)},expression:"form.number"}})],1)],1),r("div",{staticClass:"flex-wrap"},[r("el-form-item",{attrs:{prop:"inventory",label:"产品库存"}},[r("el-input-number",{attrs:{min:1,controls:!1,max:999999},model:{value:e.form.inventory,callback:function(t){e.$set(e.form,"inventory",t)},expression:"form.inventory"}})],1),r("el-form-item",{attrs:{prop:"price",label:"产品价格"}},[r("el-input-number",{attrs:{min:1,controls:!1,max:999999},model:{value:e.form.price,callback:function(t){e.$set(e.form,"price",t)},expression:"form.price"}})],1),r("el-form-item",{attrs:{prop:"type",label:"售卖模式"}},[r("el-select",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.saleData,(function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),r("el-form-item",{staticClass:"date-item"},[r("el-radio-group",{model:{value:e.shelfType,callback:function(t){e.shelfType=t},expression:"shelfType"}},[r("el-radio",{attrs:{label:"立即上架"}},[e._v("立即上架")]),r("el-radio",{attrs:{label:"定时上架"}},[e._v("定时上架")])],1),r("el-date-picker",{ref:"datePicker",attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",clearable:!1,"picker-options":e.pickerOptions,placeholder:"选择日期时间"},model:{value:e.form.on_at,callback:function(t){e.$set(e.form,"on_at",t)},expression:"form.on_at"}})],1)],1),"竞拍"==e.form.type?r("div",{staticClass:"flex-wrap"},[r("el-form-item",{attrs:{prop:"max_price",label:"产品封顶价格"}},[r("el-input-number",{attrs:{min:1,controls:!1,max:999999},model:{value:e.form.max_price,callback:function(t){e.$set(e.form,"max_price",t)},expression:"form.max_price"}})],1),r("el-form-item",{attrs:{prop:"end_at",label:"产品售卖时长"}},[r("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":e.endPickerOptions,placeholder:"选择日期时间"},model:{value:e.form.end_at,callback:function(t){e.$set(e.form,"end_at",t)},expression:"form.end_at"}})],1)],1):e._e(),"盲盒"==e.form.type?r("div",[r("div",{staticClass:"flex-wrap blind-wrap"},e._l(e.form.blind_box,(function(t,a){return r("div",{key:a,staticClass:"blind-box"},[r("div",{staticClass:"blind-item"},[r("el-form-item",{attrs:{label:"盲盒单品名称",prop:"blind_box."+a+".name",rules:e.blindRules.name}},[r("el-input",{model:{value:t.name,callback:function(r){e.$set(t,"name",r)},expression:"item.name"}})],1),r("el-form-item",{attrs:{label:"盲盒单品描述",prop:"blind_box."+a+".des",rules:e.blindRules.des}},[r("el-input",{model:{value:t.des,callback:function(r){e.$set(t,"des",r)},expression:"item.des"}})],1)],1),r("el-form-item",{attrs:{label:"盲盒单品图",prop:"blind_box."+a+".img",rules:e.blindRules.img}},[r("p",{staticClass:"tips"},[e._v("尺寸需为140X212px png格式")]),r("div",{staticClass:"blind-image"},[r("p",[e._v(e._s(t.blindFileName))]),r("base-upload",{attrs:{"file-type":"image/png"},on:{getFileUrl:function(t){return e.getBlindSrc(arguments,a)}}})],1)])],1)})),0),r("base-btn",{staticClass:"add-btn",on:{click:e.addBlind}},[e._v("+ 增加盲盒单品")])],1):e._e(),r("div",{staticClass:"flex-wrap"},[r("div",{staticClass:"desc-item"},[r("el-form-item",{attrs:{label:"产品简介",prop:"intro"}},[r("el-input",{attrs:{type:"textarea",maxlength:16,placeholder:"最多16个英文字符"},model:{value:e.form.intro,callback:function(t){e.$set(e.form,"intro",t)},expression:"form.intro"}})],1),r("el-form-item",{attrs:{label:"产品描述",prop:"des"}},[r("el-input",{attrs:{type:"textarea",maxlength:1e3,placeholder:"最多1000个英文字符"},model:{value:e.form.des,callback:function(t){e.$set(e.form,"des",t)},expression:"form.des"}})],1)],1)]),r("el-form-item",{attrs:{label:"产品主图",prop:"main_img"}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.mainImgLoading,expression:"mainImgLoading"}],staticClass:"image-wrap"},[e.form.main_img?r("div",[r("el-image",{staticStyle:{width:"340px",height:"300px"},attrs:{"preview-src-list":[e.BASE_IMG_SRC+e.form.main_img],src:e.BASE_IMG_SRC+e.form.main_img,fit:"contain"}})],1):e._e(),r("base-upload",{staticClass:"btn-wrap",staticStyle:{"margin-bottom":"50px"},attrs:{"button-name":""},on:{getFileUrl:e.getDetailDataBanner}},[r("svg-icon",{staticClass:"upload-icon",attrs:{"icon-class":"file"}}),r("p",{staticClass:"btn-style"},[e._v("点击上传图片")])],1),r("p",{staticClass:"image-size"},[e._v("固定尺寸 750X850px")])],1)]),r("el-form-item",{attrs:{label:"产品详情",prop:"detail"}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.detailImgLoading,expression:"detailImgLoading"}],staticClass:"detail-wrap"},[r("p",{staticClass:"tips"},[e._v("固定尺寸 678X750px")]),e._l(e.form.detail_img,(function(t,a){return r("div",{key:t,staticClass:"detail-item"},[r("el-image",{attrs:{"preview-src-list":[e.BASE_IMG_SRC+t],src:e.BASE_IMG_SRC+t,fit:"contain"}}),r("svg-icon",{staticClass:"el-icon-delete",attrs:{"icon-class":"delete"},on:{click:function(t){return e.deleteImage(a)}}})],1)})),r("base-upload",{staticClass:"btn-wrap",staticStyle:{"margin-bottom":"50px"},attrs:{"button-name":""},on:{getFileUrl:e.getDetailDataImgList}},[r("svg-icon",{staticClass:"upload-icon",staticStyle:{"margin-bottom":"10px"},attrs:{"icon-class":"file"}}),r("p",{staticClass:"btn-style"},[e._v("增加产品详情图片")])],1),r("p",{staticClass:"image-size"},[e._v("固定尺寸 750X850px")])],2)])],1)],1),r("div",{staticClass:"btn-wrap"},[r("base-btn",{attrs:{type:"info"}},[e._v("清空数据")]),r("base-btn",{on:{click:function(t){return e.save("preview")}}},[e._v("预览")]),r("base-btn",{on:{click:function(t){return e.save("submit")}}},[e._v("确认保存")]),r("base-btn",{on:{click:function(t){return e.save("toStore")}}},[e._v("放入仓库")]),r("base-btn",[e._v("返回")])],1),r("base-dialog",{attrs:{show:e.dialogVisible,width:"450px",title:""},on:{"update:show":function(t){e.dialogVisible=t}}},[r("PreviewDialog",{attrs:{"preview-data":e.form}})],1),r("base-dialog",{attrs:{show:e.dialogVisibleImgCutter,width:e.boxWidth+"px",title:""},on:{"update:show":function(t){e.dialogVisibleImgCutter=t}}},[e.dialogVisibleImgCutter?r("ImgCutter",{ref:"imgCutterModal",attrs:{label:"请选择图片","file-type":"png","cross-origin":!0,"cross-origin-header":"*",rate:e.rate,"do-not-display-copyright":!0,"tool-bgc":"none","is-modal":!1,"show-choose-btn":!0,"lock-scroll":!0,"box-width":e.boxWidth,"box-height":e.boxHeight,"cut-width":e.cutWidth,"cut-height":e.cutHeight,"size-change":!0,"move-able":!0,"img-move":!0,"original-graph":!1,"watermark-text":"","small-to-upload":!0,"save-cut-position":!0,"scale-able":!0,"preview-mode":!1,"tool-box-overflow":!0},on:{cutDown:e.cutDown}}):e._e()],1)],1)},i=[],n=r("6d83"),s=r("e9ff"),o=(r("e186"),r("e35a"),r("5e9f"),r("a9af"),r("b4fb"),r("053b"),r("ea69"),r("d340")),l={name:[{required:!0,message:"请输入产品名称",trigger:"blur"}],category_id:[{required:!0,message:"请选择产品分类",trigger:"change"}],inventory:[{required:!0,message:"请输入产品库存",trigger:"blur"}],price:[{required:!0,message:"请输入产品价格",trigger:"blur"}],type:[{required:!0,message:"请选择售卖模式",trigger:"change"}],on_at:[{required:!0,message:"请选择上架日期",trigger:"blur"}],max_price:[{required:!0,message:"请输入产品封顶价格",trigger:"blur"}],end_at:[{required:!0,message:"请输入产品售卖时长",trigger:"blur"}],main_img:[{required:!0,message:"请上传产品主图",trigger:"blur"}],intro:[{required:!0,message:"请输入产品简介",trigger:"blur"}],des:[{required:!0,message:"请输入产品描述",trigger:"blur"}]},c={name:[{required:!0,message:"请输入盲盒单品名称",trigger:"blur"}],des:[{required:!0,message:"请输入盲盒单品描述",trigger:"blur"}],img:[{required:!0,message:"请上传盲盒单品图",trigger:"blur"}]},m=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"preview-dialog-wrap"},[r("base-image",{staticClass:"main-img",attrs:{src:e.previewData.main_img}}),r("div",{staticClass:"preview-main"},[r("div",{staticClass:"preview-main-head"},[r("div",{staticClass:"title-wrap"},[r("p",{staticClass:"name"},[e._v(e._s(e.previewData.name))]),r("p",{staticClass:"intro"},[e._v(e._s(e.previewData.intro))])]),r("div",{staticClass:"price-wrap"},[r("p",{staticClass:"price"},[e._v("￥"+e._s(e.previewData.price)),"竞拍"==e.previewData.type?r("span",[e._v("起")]):e._e()])]),r("div",{staticClass:"buy-wrap"},["竞拍"!==e.previewData.type?r("div",{staticClass:"buy-icon"},[r("svg-icon",{attrs:{"icon-class":"shop-cart"}})],1):e._e(),r("p",{staticClass:"buy-text"},[e._v("立即购买")])])]),r("div",{staticClass:"preview-main-content"},["盲盒"==e.previewData.type?r("div",{staticClass:"blind-wrap"},e._l(e.previewData.blind_box,(function(t,a){return r("div",{key:a,staticClass:"blind-item"},[r("base-image",{attrs:{src:t.img}}),r("p",{staticClass:"name"},[e._v(e._s(t.name))]),r("p",{staticClass:"desc"},[e._v(e._s(t.des))])],1)})),0):e._e(),r("div",{staticClass:"desc-wrap"},[r("p",[e._v(e._s(e.previewData.des))])]),r("div",{staticClass:"detail-wrap"},e._l(e.previewData.detail_img,(function(e,t){return r("div",{key:t,staticClass:"detail-item"},[r("base-image",{attrs:{src:e}})],1)})),0)])])],1)},u=[],d={components:{},props:{previewData:{type:Object,default:function(){return{}}}},data:function(){return{}},computed:{},watch:{},created:function(){},mounted:function(){},methods:{}},p=d,g=(r("d266"),r("cba8")),f=Object(g["a"])(p,m,u,!1,null,"92ce3252",null),b=f.exports,v=r("0e5c"),h=r("f329"),_={components:{PreviewDialog:b,ImgCutter:h["a"]},props:{},data:function(){return{boxWidth:0,boxHeight:0,dialogVisibleImgCutter:!1,cutWidth:"",cutHeight:"",rate:"",activeDataKey:"",activeIndex:null,form:{name:null,category_id:-1,id:null,number:null,inventory:void 0,price:void 0,type:null,on_at:null,max_price:void 0,end_at:null,blind_box:[{name:"",des:"",img:"",blindFileName:""}],detail_img:[],main_img:null,intro:null,des:null},mainImgLoading:!1,detailImgLoading:!1,shelfType:"立即上架",saleData:["单品","盲盒","竞拍"],classData:[],rules:l,blindRules:c,pickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()}},endPickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()}},dialogVisible:!1}},computed:{BASE_IMG_SRC:function(){return this.$store.state.user.fileUrl+"/"}},watch:{},created:function(){this.form.on_at=new Date(+new Date+288e5).toJSON().substr(0,19).replace("T"," "),this.getClassData(),this.$route.query.id&&this.getGoodsDetail()},mounted:function(){},methods:{getDetailDataBanner:function(e,t){var r=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r.mainImgLoading=!0,e.next=3,Object(v["a"])(t);case 3:if(a=e.sent,i=a.err,n=a.res,!i){e.next=9;break}return r.$message.error(i.msg),e.abrupt("return");case 9:r.form.main_img=n.data.file_path,r.mainImgLoading=!1;case 11:case"end":return e.stop()}}),e)})))()},getDetailDataImgList:function(e,t){var r=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r.detailImgLoading=!0,e.next=3,Object(v["a"])(t);case 3:if(a=e.sent,i=a.err,n=a.res,!i){e.next=9;break}return r.$message.error(i.msg),e.abrupt("return");case 9:r.form.detail_img.push(n.data.file_path),r.detailImgLoading=!1;case 11:case"end":return e.stop()}}),e)})))()},cutDown:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,i,n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return console.log("🚀 ~ file: ProductForm.vue ~ line 287 ~ cutDown ~ data",e),a=e.file,r.next=4,Object(v["a"])(a);case 4:if(i=r.sent,n=i.err,s=i.res,!n){r.next=10;break}return t.$message.error(n.msg),r.abrupt("return");case 10:t.activeIndex?t.form[t.activeDataKey].push(s.data.file_path):t.form[t.activeDataKey]=s.data.file_path,t.activeDataKey="",t.activeIndex=null,t.dialogVisibleImgCutter=!1;case 14:case"end":return r.stop()}}),r)})))()},shouImgCut:function(e,t,r){var a=Object(n["a"])(e,2),i=a[0],s=a[1];this.boxWidth=i+400,this.boxHeight=s+100,this.cutHeight=s,this.rate="".concat(i,":").concat(s),this.cutWidth=i,this.activeDataKey=t,this.activeIndex=r,this.dialogVisibleImgCutter=!0},getGoodsDetail:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,a,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$get("/admin/goods",{ids:e.$route.query.id});case 2:if(r=t.sent,a=r.err,i=r.res,!a){t.next=8;break}return e.$message.error(a.msg),t.abrupt("return");case 8:e.form=JSON.parse(JSON.stringify(i.data.list[0])),n=[{name:"",des:"",img:"",blindFileName:""}],e.form.blind_box="盲盒"===e.form.type?e.form.blind_box:n,e.shelfType="已下架"===e.form.status?"立即上架":"定时上架";case 12:case"end":return t.stop()}}),t)})))()},getClassData:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,a,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r={page:1,limit:1e3},t.next=3,e.$get("/admin/categories",r);case 3:if(a=t.sent,i=a.err,n=a.res,!i){t.next=9;break}return e.$message.error(i.msg),t.abrupt("return");case 9:e.classData=n.data.list;case 10:case"end":return t.stop()}}),t)})))()},getFileData:function(e,t){var r=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i,n,s,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(o["a"])(e);case 2:if(i=a.sent,750===i.w&&850===i.h){a.next=6;break}return r.$message.error("请上传尺寸为750X850的图片"),a.abrupt("return");case 6:return a.next=8,Object(v["a"])(t);case 8:if(n=a.sent,s=n.err,l=n.res,!s){a.next=14;break}return r.$message.error(s.msg),a.abrupt("return");case 14:r.form.main_img=l.data.file_path;case 15:case"end":return a.stop()}}),a)})))()},getBlindSrc:function(e,t){var r=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i,n,s,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(o["a"])(e[0]);case 2:if(i=a.sent,140===i.w&&212===i.h){a.next=6;break}return r.$message.error("请上传尺寸为140X212的图片"),a.abrupt("return");case 6:return a.next=8,Object(v["a"])(e[1]);case 8:if(n=a.sent,s=n.err,l=n.res,!s){a.next=14;break}return r.$message.error(s.msg),a.abrupt("return");case 14:r.form.blind_box[t].blindFileName=e[1].name,r.form.blind_box[t].img=l.data.file_path;case 16:case"end":return a.stop()}}),a)})))()},addBlind:function(){this.form.blind_box.push({name:"",des:"",img:"",blindFileName:""})},getDetailData:function(e,t){var r=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i,n,s,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!(r.form.detail_img.length>=10)){a.next=3;break}return r.$message.error("产品详情图不能超过10张"),a.abrupt("return");case 3:return a.next=5,Object(o["a"])(e);case 5:if(i=a.sent,678===i.w&&750===i.h){a.next=9;break}return r.$message.error("请上传尺寸为678X750的图片"),a.abrupt("return");case 9:return a.next=11,Object(v["a"])(t);case 11:if(n=a.sent,s=n.err,l=n.res,!s){a.next=17;break}return r.$message.error(s.msg),a.abrupt("return");case 17:r.form.detail_img.push(l.data.file_path);case 18:case"end":return a.stop()}}),a)})))()},deleteImage:function(e){this.form.detail_img.splice(e,1)},save:function(e){var t=this;this.$refs["ruleForm"].validate((function(r){if(!r)return console.log("error submit!!"),!1;"定时上架"!==t.shelfType||t.form.on_at?"盲盒"!==t.form.type||t.form.blind_box.length?t.form.detail_img.length?"竞拍"===t.form.type&&t.form.price>t.form.max_price?t.$message.error("产品价格不能高于产品封顶价格"):"preview"===e?t.dialogVisible=!0:t.submit(e):t.$message.error("请上传产品详情图"):t.$message.error("请上传盲盒单品"):t.$message.error("请选择上架日期")}))},submit:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,i,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(a=JSON.parse(JSON.stringify(t.form)),a.on_at="立即上架"===t.shelfType?"立即上架":a.on_at,a.blind_box="盲盒"===a.type?a.blind_box:null,"toStore"===e&&(a.on_at="放入仓库"),t.$route.query.id){r.next=10;break}return r.next=7,t.$post("/admin/goods",a);case 7:r.t0=r.sent,r.next=13;break;case 10:return r.next=12,t.$put("/admin/goods/".concat(t.$route.query.id),a);case 12:r.t0=r.sent;case 13:i=r.t0,n=i.err,i.res,n?t.$message.error(n.msg):(t.$message({type:"success",message:"保存成功"}),t.routeGo());case 17:case"end":return r.stop()}}),r)})))()},routeGo:function(){this.$router.push({path:"/product-manage"})}}},x=_,w=(r("e52b"),Object(g["a"])(x,a,i,!1,null,"75663122",null));t["a"]=w.exports}}]);