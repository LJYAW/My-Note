(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-665d5c61"],{"55a0":function(e,t,a){var r=a("fc2f");r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var o=a("499e").default;o("53c5b86b",r,!0,{sourceMap:!1,shadowMode:!1})},c0d5:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"add-task"},[a("h3",[e._v("新增任务")]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,"label-position":"left","label-width":"120px",rules:e.rules}},[a("el-form-item",{attrs:{label:"资源类型",prop:"resourcetype"}},[a("el-radio-group",{model:{value:e.form.resourcetype,callback:function(t){e.$set(e.form,"resourcetype",t)},expression:"form.resourcetype"}},e._l(e.baseData.typeData,(function(t,r){return a("el-radio",{key:t,attrs:{label:r+1}},[e._v(e._s(t))])})),1)],1),a("el-form-item",{attrs:{label:"频道名称",prop:"channel_id"}},[a("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择频道"},model:{value:e.form.channel_id,callback:function(t){e.$set(e.form,"channel_id",t)},expression:"form.channel_id"}},e._l(e.channelData,(function(e){return a("el-option",{key:e.channel_uuid,attrs:{value:e.channel_uuid,label:e.name}})})),1)],1),a("el-form-item",{attrs:{label:"栏目名称",prop:"program_id"}},[a("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择栏目"},model:{value:e.form.program_id,callback:function(t){e.$set(e.form,"program_id",t)},expression:"form.program_id"}},e._l(e.itemData,(function(e){return a("el-option",{key:e.name,attrs:{value:e.item_uuid,label:e.name}})})),1)],1),a("el-form-item",{attrs:{label:"业务",prop:"business"}},[a("el-checkbox-group",{model:{value:e.form.business,callback:function(t){e.$set(e.form,"business",t)},expression:"form.business"}},e._l(e.workData,(function(e){return a("el-checkbox",{key:e,attrs:{label:e}})})),1),a("el-checkbox",{model:{value:e.checkedOther,callback:function(t){e.checkedOther=t},expression:"checkedOther"}},[e._v("其他")]),a("el-input",{staticClass:"other-work",attrs:{placeholder:"请输入业务"},model:{value:e.otherWork,callback:function(t){e.otherWork=t},expression:"otherWork"}})],1),a("el-form-item",{attrs:{label:"是否遮码"}},[a("el-radio-group",{model:{value:e.form.zmflag,callback:function(t){e.$set(e.form,"zmflag",t)},expression:"form.zmflag"}},[a("el-radio",{attrs:{label:1}},[e._v("是")]),a("el-radio",{attrs:{label:2}},[e._v("否")])],1)],1),1==e.form.zmflag?a("el-form-item",{attrs:{label:""}},e._l(e.codeList,(function(t,r){return a("div",{key:r,staticClass:"code-list"},[a("el-radio-group",{staticClass:"codeRadio",model:{value:t.codeType,callback:function(a){e.$set(t,"codeType",a)},expression:"item.codeType"}},[a("el-radio",{attrs:{label:"zmbq"}},[e._v("标清")]),a("el-radio",{attrs:{label:"zmgq"}},[e._v("高清")])],1),a("el-form-item",{staticClass:"code-item",attrs:{label:"左:","label-width":"30"}},[a("el-input",{model:{value:t.coverCode[0],callback:function(a){e.$set(t.coverCode,0,e._n("string"===typeof a?a.trim():a))},expression:"item.coverCode[0]"}})],1),a("el-form-item",{staticClass:"code-item",attrs:{label:"上:","label-width":"30"}},[a("el-input",{model:{value:t.coverCode[1],callback:function(a){e.$set(t.coverCode,1,e._n("string"===typeof a?a.trim():a))},expression:"item.coverCode[1]"}})],1),a("el-form-item",{staticClass:"code-item",attrs:{label:"宽:","label-width":"30"}},[a("el-input",{model:{value:t.coverCode[2],callback:function(a){e.$set(t.coverCode,2,e._n("string"===typeof a?a.trim():a))},expression:"item.coverCode[2]"}})],1),a("el-form-item",{staticClass:"code-item",attrs:{label:"高:","label-width":"30"}},[a("el-input",{model:{value:t.coverCode[3],callback:function(a){e.$set(t.coverCode,3,e._n("string"===typeof a?a.trim():a))},expression:"item.coverCode[3]"}})],1),e.codeList.length<4?a("i",{staticClass:"el-icon-circle-plus-outline",on:{click:function(t){return e.addCode(r)}}}):e._e(),1!==e.codeList.length?a("i",{staticClass:"el-icon-remove-outline",on:{click:function(t){return e.deleteCode(r)}}}):e._e()],1)})),0):e._e(),a("el-form-item",{attrs:{label:"路径来源"}},[a("el-input",{attrs:{placeholder:"请输入路径来源",clearable:""},model:{value:e.form.source,callback:function(t){e.$set(e.form,"source",t)},expression:"form.source"}})],1),a("el-form-item",{attrs:{label:"列表页爬取地址"}},[a("el-input",{attrs:{placeholder:"请输入列表页 URL"},model:{value:e.form.listurl,callback:function(t){e.$set(e.form,"listurl",t)},expression:"form.listurl"}})],1),a("el-form-item",{attrs:{label:"播放页爬取地址"}},[a("el-input",{attrs:{placeholder:"请输入播放页 URL"},model:{value:e.form.playurl,callback:function(t){e.$set(e.form,"playurl",t)},expression:"form.playurl"}})],1),2!==e.form.resourcetype?a("el-form-item",{attrs:{label:"爬取频次"}},[a("el-radio-group",{model:{value:e.frequency_type,callback:function(t){e.frequency_type=t},expression:"frequency_type"}},[a("el-radio",{attrs:{label:1}},[e._v("指定日期")]),a("el-radio",{attrs:{label:2}},[e._v("频次")])],1),1===e.frequency_type?a("div",[a("BroadcastTime",{ref:"broadcastTime"}),a("p",[e._v("默认每日 24 点")])],1):a("div",[a("el-select",{model:{value:e.form.frequency,callback:function(t){e.$set(e.form,"frequency",t)},expression:"form.frequency"}},e._l(23,(function(e){return a("el-option",{key:e,attrs:{label:e+"小时",value:"pc:"+String(e)}})})),1)],1)],1):e._e(),a("el-form-item",{attrs:{label:"数据限制"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.form.programTimeStart,callback:function(t){e.$set(e.form,"programTimeStart",t)},expression:"form.programTimeStart"}}),a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.form.programTimeEnd,callback:function(t){e.$set(e.form,"programTimeEnd",t)},expression:"form.programTimeEnd"}})],1),a("el-form-item",{attrs:{label:"解析说明"}},[a("BaseUpload",{key:"presenters",staticClass:"BaseUploadImg",attrs:{button_name:"上传图片"},on:{getFileUrl:e.getFileUrl}}),e.form.descpic?a("img",{staticClass:"cover-img",attrs:{src:e.form.descpic,alt:""}}):e._e()],1),a("el-form-item",{attrs:{label:"现存视频日期",prop:"lastdate"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.form.lastdate,callback:function(t){e.$set(e.form,"lastdate",t)},expression:"form.lastdate"}})],1)],1),a("base-btn",{on:{click:function(t){return e.submit("ruleForm")}}},[e._v("提交")]),a("base-btn",{attrs:{type:"info"},on:{click:e.backTo}},[e._v("返回")])],1)},o=[],l=a("1da1"),i=a("5530"),n=(a("96cf"),a("4de4"),a("159b"),a("b0c0"),a("a15b"),a("13d5"),a("99af"),a("a434"),a("2f62")),s=a("df14"),c=a("c28f"),d=a("fcd9"),m={components:{BroadcastTime:c["a"]},props:{},data:function(){return{itemData:[],form:{resourcetype:1,channel_id:null,program_id:null,source:null,business:[],listurl:"",playurl:"",frequency:"pc:1",programTimeStart:"",programTimeEnd:"",descpic:"",zmflag:1,lastdate:""},frequency_type:1,codeList:[{codeType:"zmbq",coverCode:[]}],workData:["KG","Feed"],checkedOther:!1,otherWork:"",baseData:d["a"],rules:s["a"],dialogVisible:!1}},computed:Object(i["a"])({},Object(n["b"])(["channelData"])),watch:{"form.channel_id":function(e){e&&this.getItemList(),this.form.program_id=null}},created:function(){!this.channelData.length&&this.$store.dispatch("channel/getChannelData")},mounted:function(){},methods:{getItemList:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var a,r,o,l,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.channelData.filter((function(t){return t.channel_uuid===e.form.channel_id}))[0].channel_id,r={channel_id:a},t.next=4,e.$get("/jobs/programs",r);case 4:if(o=t.sent,l=o.data,i=o.err,!i){t.next=10;break}return e.$message.error(i.msg),t.abrupt("return");case 10:e.itemData=l.data;case 11:case"end":return t.stop()}}),t)})))()},openDialog:function(){this.dialogVisible=!0},close:function(){this.dialogVisible=!1},checkCode:function(){var e="";return this.codeList.forEach((function(t){t.coverCode.length||(e="请输入遮码参数");for(var a=0;a<t.coverCode.length;a++)String(t.coverCode[a])||(e="请输入遮码参数")})),e},submit:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;!t.checkedOther||t.otherWork?1===t.form.zmflag&&t.checkCode()?t.$message({tyep:"warning",message:t.checkCode()}):new Date(t.form.programTimeStart).getTime()>new Date(t.form.programTimeEnd).getTime()?t.$message.error("开始开播时间不能小于结束开播时间"):t.addTask():t.$message.error("请输入其他业务")}))},addTask:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$post("/jobs",e.getAddparams());case 2:a=t.sent,a.data,r=a.err,r?e.$message.error(r.msg):(e.$message({type:"success",message:"新增任务成功"}),e.backTo());case 6:case"end":return t.stop()}}),t)})))()},getAddparams:function(){var e=this,t=JSON.parse(JSON.stringify(this.form));t.programTimeEnd=t.programTimeEnd?t.programTimeEnd:"",t.programTimeStart=t.programTimeStart?t.programTimeStart:"",t.channel_name=this.channelData.filter((function(t){return t.channel_uuid===e.form.channel_id}))[0].name,t.program_name=this.itemData.filter((function(t){return t.item_uuid===e.form.program_id}))[0].name,this.checkedOther&&t.business.push(this.otherWork),t.business=t.business.join("、"),1===this.frequency_type&&(t.frequency=this.setFrequency());var a=this.codeList.reduce((function(e,t){return e[t.codeType]?e[t.codeType].push(t.coverCode.join(":")):e[t.codeType]=[t.coverCode.join(":")],e}),{});for(var r in a)t[r]=a[r].join("|");return t},setFrequency:function(){var e=[];return this.$refs.broadcastTime&&this.$refs.broadcastTime.tableData.length?(this.$refs.broadcastTime.tableData.forEach((function(t){t.time_data.forEach((function(a){a&&e.push("".concat(t.date,":").concat(a))}))})),e.join(",")):""},getFileUrl:function(e,t){this.uploadImg(t)},uploadImg:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){var r,o,l,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=new FormData,r.append("file",e),a.next=4,t.$post("/common/uploadfile",r);case 4:if(o=a.sent,l=o.data,i=o.err,!i){a.next=9;break}return t.$message.error(i.msg),a.abrupt("return");case 9:t.form.descpic=l.data.imgurl;case 10:case"end":return a.stop()}}),a)})))()},backTo:function(){this.$router.push({path:"/task"})},addCode:function(e){this.codeList.splice(e+1,0,{codeType:"zmbq",coverCode:[]})},deleteCode:function(e){this.codeList.splice(e,1)}}},u=m,f=(a("fe6a"),a("2877")),p=Object(f["a"])(u,r,o,!1,null,"b87e6f58",null);t["default"]=p.exports},fc2f:function(e,t,a){var r=a("24fb");t=r(!1),t.push([e.i,".add-task[data-v-b87e6f58]{padding:20px 30px}.add-task .el-form[data-v-b87e6f58]{margin-top:20px}.add-task .el-form .el-input[data-v-b87e6f58],.add-task .el-form .el-select[data-v-b87e6f58]{width:500px}.add-task .el-form .el-date-editor[data-v-b87e6f58]{margin-right:20px}.add-task .el-form .el-checkbox-group[data-v-b87e6f58]{display:inline-block;margin-right:20px}.add-task .el-form .other-work[data-v-b87e6f58]{margin-left:20px;display:inline-block;width:200px}.add-task .el-form .add-btn[data-v-b87e6f58]{margin-left:20px}.add-task .el-form .el-date-editor[data-v-b87e6f58]{width:auto!important}.add-task .el-form .cover-img[data-v-b87e6f58]{border:1px solid #eee;margin-top:20px;width:auto;height:100px;-o-object-fit:contain;object-fit:contain}.add-task .el-form .code-list[data-v-b87e6f58]{margin-bottom:20px}.add-task .el-form .code-list .codeRadio[data-v-b87e6f58]{margin-right:20px}.add-task .el-form .code-list .el-icon-circle-plus-outline[data-v-b87e6f58]{margin-right:10px}.add-task .el-form .code-item[data-v-b87e6f58]{display:inline-block;margin-right:20px}.add-task .el-form .code-item[data-v-b87e6f58]  .el-form-item__content{display:inline-block}.add-task .el-form .code-item .el-input[data-v-b87e6f58]{width:100px}",""]),e.exports=t},fe6a:function(e,t,a){"use strict";a("55a0")}}]);