(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d27d1568"],{"54f0":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"edit-task"},[r("h3",[e._v("编辑任务")]),r("el-form",{ref:"ruleForm",attrs:{model:e.form,"label-position":"left","label-width":"120px",rules:e.rules}},[r("el-form-item",{attrs:{label:"资源类型",prop:"resourcetype"}},[r("el-radio-group",{model:{value:e.form.resourcetype,callback:function(t){e.$set(e.form,"resourcetype",t)},expression:"form.resourcetype"}},e._l(e.baseData.typeData,(function(t,a){return r("el-radio",{key:t,attrs:{label:a+1}},[e._v(e._s(t))])})),1)],1),r("el-form-item",{attrs:{label:"频道名称",prop:"channel_id"}},[r("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择频道"},on:{change:e.handleChange},model:{value:e.form.channel_id,callback:function(t){e.$set(e.form,"channel_id",t)},expression:"form.channel_id"}},e._l(e.channelData,(function(e){return r("el-option",{key:e.channel_uuid,attrs:{value:e.channel_uuid,label:e.name}})})),1)],1),r("el-form-item",{attrs:{label:"栏目名称",prop:"program_id"}},[r("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择栏目"},model:{value:e.form.program_id,callback:function(t){e.$set(e.form,"program_id",t)},expression:"form.program_id"}},e._l(e.itemData,(function(e){return r("el-option",{key:e.name,attrs:{value:e.item_uuid,label:e.name}})})),1)],1),r("el-form-item",{attrs:{label:"业务",prop:"business"}},[r("el-checkbox-group",{model:{value:e.form.business,callback:function(t){e.$set(e.form,"business",t)},expression:"form.business"}},e._l(e.workData,(function(e){return r("el-checkbox",{key:e,attrs:{label:e}})})),1),r("el-checkbox",{model:{value:e.checkedOther,callback:function(t){e.checkedOther=t},expression:"checkedOther"}},[e._v("其他")]),r("el-input",{staticClass:"other-work",attrs:{placeholder:"请输入业务"},model:{value:e.otherWork,callback:function(t){e.otherWork=t},expression:"otherWork"}})],1),r("el-form-item",{attrs:{label:"是否遮码"}},[r("el-radio-group",{model:{value:e.form.zmflag,callback:function(t){e.$set(e.form,"zmflag",t)},expression:"form.zmflag"}},[r("el-radio",{attrs:{label:1}},[e._v("是")]),r("el-radio",{attrs:{label:2}},[e._v("否")])],1)],1),1===e.form.zmflag?r("el-form-item",{attrs:{label:""}},e._l(e.codeList,(function(t,a){return r("div",{key:a,staticClass:"code-list"},[r("el-radio-group",{staticClass:"codeRadio",model:{value:t.codeType,callback:function(r){e.$set(t,"codeType",r)},expression:"item.codeType"}},[r("el-radio",{attrs:{label:"zmbq"}},[e._v("标清")]),r("el-radio",{attrs:{label:"zmgq"}},[e._v("高清")])],1),r("el-form-item",{staticClass:"code-item",attrs:{label:"左:","label-width":"30"}},[r("el-input",{model:{value:t.coverCode[0],callback:function(r){e.$set(t.coverCode,0,e._n("string"===typeof r?r.trim():r))},expression:"item.coverCode[0]"}})],1),r("el-form-item",{staticClass:"code-item",attrs:{label:"上:","label-width":"30"}},[r("el-input",{model:{value:t.coverCode[1],callback:function(r){e.$set(t.coverCode,1,e._n("string"===typeof r?r.trim():r))},expression:"item.coverCode[1]"}})],1),r("el-form-item",{staticClass:"code-item",attrs:{label:"宽:","label-width":"30"}},[r("el-input",{model:{value:t.coverCode[2],callback:function(r){e.$set(t.coverCode,2,e._n("string"===typeof r?r.trim():r))},expression:"item.coverCode[2]"}})],1),r("el-form-item",{staticClass:"code-item",attrs:{label:"高:","label-width":"30"}},[r("el-input",{model:{value:t.coverCode[3],callback:function(r){e.$set(t.coverCode,3,e._n("string"===typeof r?r.trim():r))},expression:"item.coverCode[3]"}})],1),e.codeList.length<4?r("i",{staticClass:"el-icon-circle-plus-outline",on:{click:function(t){return e.addCode(a)}}}):e._e(),1!==e.codeList.length?r("i",{staticClass:"el-icon-remove-outline",on:{click:function(t){return e.deleteCode(a)}}}):e._e()],1)})),0):e._e(),r("el-form-item",{attrs:{label:"路径来源"}},["release"==e.pathStatus?r("div",[r("el-input",{attrs:{placeholder:"请输入路径来源",clearable:""},model:{value:e.form.source,callback:function(t){e.$set(e.form,"source",t)},expression:"form.source"}})],1):r("div",[e._v(" "+e._s(e.form.source)+" "),r("base-btn",{staticClass:"release-btn",on:{click:e.release}},[e._v("释放路径")])],1)]),r("el-form-item",{attrs:{label:"列表页爬取地址"}},[r("el-input",{attrs:{placeholder:"请输入列表页 URL"},model:{value:e.form.listurl,callback:function(t){e.$set(e.form,"listurl",t)},expression:"form.listurl"}})],1),r("el-form-item",{attrs:{label:"播放页爬取地址"}},[r("el-input",{attrs:{placeholder:"请输入列表页 URL"},model:{value:e.form.playurl,callback:function(t){e.$set(e.form,"playurl",t)},expression:"form.playurl"}})],1),2!==e.form.resourcetype?r("el-form-item",{attrs:{label:"爬取频次"}},[r("el-radio-group",{model:{value:e.frequency_type,callback:function(t){e.frequency_type=t},expression:"frequency_type"}},[r("el-radio",{attrs:{label:1}},[e._v("指定日期")]),r("el-radio",{attrs:{label:2}},[e._v("频次")])],1),1===e.frequency_type?r("div",[r("BroadcastTime",{ref:"broadcastTime",attrs:{"broadcast-arr":e.broadcastArr}}),r("p",[e._v("默认每日 24 点")])],1):r("div",[r("el-select",{model:{value:e.frequency_time,callback:function(t){e.frequency_time=t},expression:"frequency_time"}},e._l(23,(function(e){return r("el-option",{key:e,attrs:{label:e+"小时",value:"pc:"+String(e)}})})),1)],1)],1):e._e(),r("el-form-item",{attrs:{label:"数据限制"}},[r("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.form.programTimeStart,callback:function(t){e.$set(e.form,"programTimeStart",t)},expression:"form.programTimeStart"}}),r("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.form.programTimeEnd,callback:function(t){e.$set(e.form,"programTimeEnd",t)},expression:"form.programTimeEnd"}})],1),r("el-form-item",{attrs:{label:"解析说明"}},[r("BaseUpload",{key:"presenters",staticClass:"BaseUploadImg",attrs:{button_name:"上传图片"},on:{getFileUrl:e.getFileUrl}}),e.form.descpic?r("img",{staticClass:"cover-img",attrs:{src:e.form.descpic,alt:""}}):e._e()],1),r("el-form-item",{attrs:{label:"现存视频日期",prop:"lastdate"}},[r("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.form.lastdate,callback:function(t){e.$set(e.form,"lastdate",t)},expression:"form.lastdate"}})],1)],1),r("base-btn",{on:{click:function(t){return e.submit("ruleForm")}}},[e._v("提交")]),r("base-btn",{attrs:{type:"info"},on:{click:e.backTo}},[e._v("返回")])],1)},o=[],i=r("1da1"),n=r("5530"),s=(r("159b"),r("1276"),r("ac1f"),r("4de4"),r("a434"),r("c740"),r("7db0"),r("b0c0"),r("a15b"),r("13d5"),r("99af"),r("96cf"),r("2f62")),c=r("df14"),l=r("c28f"),d=r("fcd9"),m={components:{BroadcastTime:l["a"]},props:{},data:function(){return{typeData:["整档","单集"],workData:["KG","Feed"],form:{business:[]},codeList:[{codeType:"zmbq",coverCode:[]}],itemData:[],checkedOther:!1,otherWork:"",rules:c["a"],pathStatus:"",broadcastArr:[],frequency_type:1,frequency_time:"pc:1",baseData:d["a"],codeType:["zmbq","zmgq"]}},computed:Object(n["a"])({},Object(s["b"])(["channelData"])),watch:{},created:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.t0=!e.channelData.length,!t.t0){t.next=4;break}return t.next=4,e.$store.dispatch("channel/getChannelData");case 4:return t.next=6,e.getTaskDetail();case 6:e.getItemList();case 7:case"end":return t.stop()}}),t)})))()},mounted:function(){},methods:{handleChange:function(e){e&&this.getItemList(),this.form.program_id=null},getTaskDetail:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$get("/jobs/".concat(e.$route.query.id));case 2:if(r=t.sent,a=r.data,o=r.err,!o){t.next=8;break}return e.$message.error(o.msg||o),t.abrupt("return");case 8:e.form=JSON.parse(JSON.stringify(a.data)),1===a.data.zmflag&&(e.codeList=[],e.codeType.forEach((function(t){if(e.form[t]="",a.data[t]){var r=a.data[t].split("|");r.forEach((function(r){e.codeList.push({codeType:t,coverCode:r.split(":")})}))}}))),e.setBusiness(),-1===e.form.frequency.indexOf("pc")?(e.setBroadcastArr(),e.frequency_type=1):(e.frequency_time=e.form.frequency,e.frequency_type=2);case 12:case"end":return t.stop()}}),t)})))()},getItemList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,a,o,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.channelData.filter((function(t){return t.channel_uuid===e.form.channel_id}))[0].channel_id,a={channel_id:r},t.next=4,e.$get("/jobs/programs",a);case 4:if(o=t.sent,i=o.data,n=o.err,!n){t.next=10;break}return e.$message.error(n.msg),t.abrupt("return");case 10:e.itemData=i.data;case 11:case"end":return t.stop()}}),t)})))()},setBusiness:function(){var e=this.form.business.split("、");this.form.business=e.splice(0,2),e.length&&(this.checkedOther=!0,this.otherWork=e[0])},setBroadcastArr:function(){var e=this;if(this.form.frequency){var t=this.form.frequency.split(",");t.forEach((function(t){var r=t.split(":"),a=e.broadcastArr.findIndex((function(e){return e.date===r[0]}));-1!==a?e.broadcastArr[a].time_data.push(r[1]):e.broadcastArr.push({date:r[0],time_data:[r[1]]})}))}},checkCode:function(){var e="";return this.codeList.forEach((function(t){t.coverCode.length||(e="请输入遮码参数");for(var r=0;r<t.coverCode.length;r++)String(t.coverCode[r])||(e="请输入遮码参数")})),e},submit:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;!t.checkedOther||t.otherWork?1===t.form.zmflag&&t.checkCode()?t.$message({tyep:"warning",message:t.checkCode()}):new Date(t.form.programTimeStart).getTime()>new Date(t.form.programTimeEnd).getTime()?t.$message.error("开始开播时间不能小于结束开播时间"):t.editTask():t.$message.error("请输入其他业务")}))},editTask:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$put("/jobs/".concat(e.$route.query.id),e.getEditParams());case 2:r=t.sent,r.data,a=r.err,a?e.$message.error(a.msg):(e.$message({type:"success",message:"编辑任务成功"}),e.backTo());case 6:case"end":return t.stop()}}),t)})))()},getEditParams:function(){var e=this,t=JSON.parse(JSON.stringify(this.form));t.programTimeEnd=t.programTimeEnd?t.programTimeEnd:"",t.programTimeStart=t.programTimeStart?t.programTimeStart:"",this.checkedOther&&t.business.push(this.otherWork);var r=this.channelData.find((function(t){return t.channel_uuid===e.form.channel_id}));t.channel_name=r?r.name:"";var a=this.itemData.find((function(t){return t.item_uuid===e.form.program_id}));if(t.program_name=a?a.name:"",t.business=t.business.join("、"),t.frequency=1===this.frequency_type?this.setFrequency():this.frequency_time,2===t.zmflag)t.zmbq="",t.zmgq="";else{var o=this.codeList.reduce((function(e,t){return e[t.codeType]?e[t.codeType].push(t.coverCode.join(":")):e[t.codeType]=[t.coverCode.join(":")],e}),{});for(var i in o)t[i]=o[i].join("|")}return t},setFrequency:function(){var e=[];return this.$refs.broadcastTime&&this.$refs.broadcastTime.tableData.length?(this.$refs.broadcastTime.tableData.forEach((function(t){t.time_data.forEach((function(r){r&&e.push("".concat(t.date,":").concat(r))}))})),e.join(",")):""},backTo:function(){this.$router.push({path:"/task"})},release:function(){this.pathStatus="release"},getFileUrl:function(e,t){this.uploadImg(t)},uploadImg:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var a,o,i,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=new FormData,a.append("file",e),r.next=4,t.$post("/common/uploadfile",a);case 4:if(o=r.sent,i=o.data,n=o.err,!n){r.next=9;break}return t.$message.error(n.msg),r.abrupt("return");case 9:t.form.descpic=i.data.imgurl;case 10:case"end":return r.stop()}}),r)})))()},addCode:function(e){this.codeList.splice(e+1,0,{codeType:"zmbq",coverCode:[]})},deleteCode:function(e){this.codeList.splice(e,1)}}},u=m,f=(r("a40a"),r("2877")),p=Object(f["a"])(u,a,o,!1,null,"851a2c18",null);t["default"]=p.exports},a40a:function(e,t,r){"use strict";r("cfc6")},b408:function(e,t,r){var a=r("24fb");t=a(!1),t.push([e.i,".edit-task[data-v-851a2c18]{padding:20px 30px}.edit-task .el-form[data-v-851a2c18]{margin-top:20px}.edit-task .el-form .el-input[data-v-851a2c18],.edit-task .el-form .el-select[data-v-851a2c18]{width:500px}.edit-task .el-form .el-date-editor[data-v-851a2c18]{margin-right:20px}.edit-task .el-form .el-checkbox-group[data-v-851a2c18]{display:inline-block;margin-right:20px}.edit-task .el-form .other-work[data-v-851a2c18]{margin-left:20px;display:inline-block;width:200px}.edit-task .el-form .add-btn[data-v-851a2c18]{margin-left:20px}.edit-task .el-form .el-date-editor[data-v-851a2c18]{width:auto!important}.edit-task .el-form .release-btn[data-v-851a2c18]{margin-left:100px}.edit-task .el-form .cover-img[data-v-851a2c18]{border:1px solid #eee;margin-top:20px;width:auto;height:100px;-o-object-fit:contain;object-fit:contain}.edit-task .el-form .code-list[data-v-851a2c18]{margin-bottom:20px}.edit-task .el-form .code-list .codeRadio[data-v-851a2c18]{margin-right:20px}.edit-task .el-form .code-list .el-icon-circle-plus-outline[data-v-851a2c18]{margin-right:10px}.edit-task .el-form .code-item[data-v-851a2c18]{display:inline-block;margin-right:20px}.edit-task .el-form .code-item[data-v-851a2c18]  .el-form-item__content{display:inline-block}.edit-task .el-form .code-item .el-input[data-v-851a2c18]{width:100px}",""]),e.exports=t},cfc6:function(e,t,r){var a=r("b408");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var o=r("499e").default;o("9b39df6a",a,!0,{sourceMap:!1,shadowMode:!1})}}]);